<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <!-- 注意：實際使用USDT穩定幣，但UI顯示使用$符號以提升用戶體驗 -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitX 交易原型</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #0a0b0d;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* 左側導航欄 */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: #111218;
            border-right: 1px solid #1f2937;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #1f2937;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "⚡";
            font-size: 1.2rem;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            display: block;
            padding: 0.875rem 1.5rem;
            color: #9ca3af;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .nav-item:hover {
            background: #1f2937;
            color: #ffffff;
            border-left-color: #3b82f6;
        }

        .nav-item.active {
            background: #1e40af;
            color: #ffffff;
            border-left-color: #3b82f6;
        }

        .nav-icon {
            display: inline-block;
            width: 20px;
            margin-right: 0.75rem;
        }

        /* 主内容区域 */
        .main-layout {
            margin-left: 240px;
            min-height: 100vh;
            display: flex;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            max-width: calc(100vw - 240px - 420px);
        }

        /* 創建頁面特殊佈局 */
        #create .content-area {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 4rem;
            width: calc(100vw - 240px);
        }

        .container {
            max-width: none;
            margin: 0;
            padding: 0;
        }

        /* 右側交易欄 */
        .trading-sidebar {
            width: 420px;
            background: #111218;
            border-left: 1px solid #1f2937;
            padding: 2rem;
            overflow-y: auto;
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            z-index: 50;
        }

        .trading-sidebar.hidden {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .trading-header {
            padding-bottom: 1rem;
            border-bottom: 1px solid #1f2937;
            margin-bottom: 1.5rem;
        }

        .trading-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .trading-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: 1px solid #3b82f6;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: #1f2937;
            color: #d1d5db;
            border: 1px solid #374151;
        }

        .btn-secondary:hover {
            background: #374151;
            color: #ffffff;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: 1px solid #10b981;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: 1px solid #ef4444;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid;
        }

        .btn-outline.btn-success {
            border-color: #16a34a;
            color: #16a34a;
        }

        .btn-outline.btn-success:hover {
            background: rgba(22, 163, 74, 0.1);
        }

        .btn-outline.btn-danger {
            border-color: #dc2626;
            color: #dc2626;
        }

        .btn-outline.btn-danger:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        /* 页面切换 */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* 首頁瀑布流 */
        .waterfall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 1.5rem;
        }

        .topic-card {
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .topic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
        }

        .topic-card:hover {
            transform: translateY(-4px);
            border-color: #3b82f6;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .topic-progress {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #374151;
        }

        .topic-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .topic-avatar {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .topic-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #ffffff;
            line-height: 1.4;
        }

        .topic-category {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .topic-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #2d3748;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* 創建話題頁面 */
        .create-form {
            max-width: 700px;
            margin: 0 auto;
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 2.5rem;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #ffffff;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #374151;
            border-radius: 8px;
            font-size: 1rem;
            background: #111218;
            color: #ffffff;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: #1a1b23;
        }

        .form-input::placeholder {
            color: #6b7280;
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        .pump-notice {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            color: #fbbf24;
        }

        .pump-notice strong {
            color: #f59e0b;
        }

        .options-container {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .option-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .add-option {
            color: #2563eb;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* 話題詳情頁面 */
        .topic-detail-container {
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
        }

        .main-content {
            width: 100%;
        }

        .topic-title {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: #ffffff;
            font-weight: 700;
            line-height: 1.3;
        }

        .topic-meta {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            font-size: 0.875rem;
            color: #9ca3af;
            align-items: center;
        }

        /* 交易界面样式 */
        .betting-interface {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .bet-option {
            border: 2px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #111218;
            position: relative;
            overflow: hidden;
        }

        .bet-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .bet-option:hover {
            transform: translateY(-2px);
            border-color: #4b5563;
        }

        .bet-option.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .bet-option.yes {
            border-color: #059669;
        }

        .bet-option.yes.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .bet-option.yes::before {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
        }

        .bet-option.no {
            border-color: #dc2626;
        }

        .bet-option.no.selected {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .bet-option.no::before {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), transparent);
        }

        .bet-option.selected::before {
            opacity: 1;
        }

        .bet-label {
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
        }

        .bet-option.yes .bet-label {
            color: #10b981;
        }

        .bet-option.no .bet-label {
            color: #ef4444;
        }

        .bet-amount {
            color: #9ca3af;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .amount-input-group {
            display: flex;
            flex-direction: column;
            gap: 1rem;
            margin: 2rem 0;
        }

        .betting-input-row {
            display: flex;
            gap: 0.75rem;
            align-items: stretch;
        }

        .betting-buttons-row {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .amount-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid #374151;
            border-radius: 8px;
            background: #111218;
            color: #ffffff;
            font-size: 1rem;
            min-width: 0; /* 防止flex收縮問題 */
        }

        .amount-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .amount-input::placeholder {
            color: #6b7280;
        }

        /* 右侧交易栏内容样式 */
        .trading-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #ffffff;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title::before {
            content: '';
            width: 3px;
            height: 16px;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            border-radius: 2px;
        }

        .pool-info {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .pool-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .pool-row:last-child {
            margin-bottom: 0;
            font-weight: 700;
            padding-top: 1rem;
            border-top: 1px solid #374151;
            font-size: 1rem;
        }

        .pool-label {
            color: #9ca3af;
        }

        .pool-value {
            color: #ffffff;
            font-weight: 600;
        }

        .pool-row:last-child .pool-value {
            color: #3b82f6;
        }

        .pump-progress {
            margin: 1.5rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(55, 65, 81, 0.5);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #374151;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-top: 0.75rem;
            font-size: 0.875rem;
            color: #9ca3af;
            font-weight: 500;
        }

        .progress-text strong {
            color: #10b981;
        }

        /* LMSR價格卡片样式 */
        .price-card {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .price-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .price-card.yes-price::before {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .price-card.no-price::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .price-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .yes-price .price-label {
            color: #34d399;
        }

        .no-price .price-label {
            color: #f87171;
        }

        .price-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .price-unit {
            font-size: 0.75rem;
            color: #9ca3af;
            opacity: 0.8;
        }

        /* LMSR交易按钮样式 */
        .lmsr-buy-btn {
            position: relative;
            overflow: hidden;
        }

        .lmsr-buy-btn small {
            margin-top: 0.25rem;
        }

        .trading-form {
            margin-top: 1rem;
        }

        /* 獎金池分区样式 */
        .pool-section {
            margin-bottom: 1.5rem;
        }

        .pool-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #374151;
        }

        .pool-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #ffffff;
        }

        .pool-section-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .pool-section-badge:not(.trade) {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .pool-section-badge.trade {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .pool-section-badge.pumped {
            background: rgba(245, 158, 11, 0.1);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-pk {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-trade {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-mixed {
            background: rgba(245, 158, 11, 0.1);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-ended {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* 個人中心樣式 */
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .stat-card h3 {
            color: #9ca3af;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-card.positive .value {
            color: #10b981;
        }

        .stat-card.primary .value {
            color: #3b82f6;
        }

        /* 持仓和交易歷史样式 */
        .position-item, .history-item {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .position-info, .history-info {
            flex: 1;
        }

        .position-title, .history-title {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .position-details, .history-details {
            color: #9ca3af;
            font-size: 0.85rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .position-value, .history-value {
            text-align: right;
        }

        .position-amount, .history-amount {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .position-amount.positive, .history-amount.positive {
            color: #10b981;
        }

        .position-amount.negative, .history-amount.negative {
            color: #ef4444;
        }

        .position-amount.neutral, .history-amount.neutral {
            color: #60a5fa;
        }

        .position-status, .history-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .status-active {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
        }

        .status-won {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
        }

        .status-lost {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* 响应式设计 */
        @media (max-width: 1024px) {
            .main-layout {
                margin-left: 0;
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                order: -1;
                flex-direction: row;
                border-right: none;
                border-bottom: 1px solid #1f2937;
            }
            
            .sidebar-nav {
                display: flex;
                flex-direction: row;
                padding: 0;
            }
            
            .nav-item {
                flex: 1;
                text-align: center;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .nav-item.active,
            .nav-item:hover {
                border-left: none;
                border-bottom-color: #3b82f6;
            }
            
            .trading-sidebar {
                position: relative;
                width: 100%;
                height: auto;
                border-left: none;
                border-top: 1px solid #1f2937;
            }
            
            .content-area {
                max-width: 100%;
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .betting-interface {
                grid-template-columns: 1fr;
            }
            
            .waterfall {
                grid-template-columns: 1fr;
            }
            
            .topic-stats {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .amount-input-group {
                flex-direction: column;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
            }
        }

        /* 模态框 */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        /* 确认和成功弹窗详情样式 */
        .confirm-details, .success-details {
            text-align: left;
            background: rgba(31, 41, 55, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(31, 41, 55, 0.1);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #374151;
        }

        .detail-value {
            font-weight: 600;
            color: #111827;
        }

        /* 选项中的支持比例样式 */
        #confirmRatio, #successRatio {
            font-size: 0.9em;
            color: #6b7280;
            font-weight: 500;
        }

        /* 創建頁面分區樣式 */
        .form-section {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-header {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
            padding-bottom: 1rem;
        }

        .section-title {
            color: #ffffff;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .section-subtitle {
            color: #9ca3af;
            font-size: 0.9rem;
            margin: 0;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(17, 24, 39, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 8px;
            padding: 0.75rem 1rem;
        }

        .input-label {
            color: #9ca3af;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .input-group .form-input {
            flex: 1;
            background: transparent;
            border: none;
            margin: 0;
            padding: 0;
        }

        .input-unit {
            color: #60a5fa;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .pump-explanation {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1rem;
        }

        .explanation-title {
            color: #60a5fa;
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .explanation-list {
            margin: 0;
            padding-left: 1.25rem;
            color: #9ca3af;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .explanation-list li {
            margin-bottom: 0.5rem;
        }

        #pumpSection.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        #pumpSection.disabled::before {
            content: "私密話題不支援Pump功能";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 10;
        }

        #pumpSection {
            position: relative;
        }

        .pool-section-badge.private {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* 選項設置樣式 */
        .option-type-selector {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .radio-label {
            color: #ffffff;
            font-size: 0.9rem;
        }

        .custom-options-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .option-input {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            align-items: center;
        }

        .option-input .form-input {
            flex: 1;
        }

        .option-input .option-number {
            color: #9ca3af;
            font-size: 0.9rem;
            min-width: 60px;
        }

        /* PK對壘界面樣式 */
        .pk-arena {
            display: flex;
            align-items: stretch;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(17, 24, 39, 0.5);
            border-radius: 12px;
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .pk-side {
            flex: 1;
            background: rgba(31, 41, 55, 0.8);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 120px;
        }

        .pk-side:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .pk-side.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .yes-side {
            border-left: 4px solid #10b981;
        }

        .yes-side:hover {
            border-left-color: #059669;
            background: rgba(16, 185, 129, 0.05);
        }

        .no-side {
            border-right: 4px solid #ef4444;
        }

        .no-side:hover {
            border-right-color: #dc2626;
            background: rgba(239, 68, 68, 0.05);
        }

        .pk-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .pk-icon {
            font-size: 1.25rem;
        }

        .pk-label {
            font-weight: 600;
            color: #ffffff;
            font-size: 1rem;
        }

        .pk-stats {
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.15rem;
        }

        .pk-amount {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .pk-percentage {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .pk-participants {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .pk-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            transition: width 0.3s ease;
            width: 0%;
        }

        .yes-side .pk-indicator {
            background: linear-gradient(90deg, transparent, #10b981, transparent);
        }

        .no-side .pk-indicator {
            background: linear-gradient(90deg, transparent, #ef4444, transparent);
        }

        .pk-vs {
            text-align: center;
            color: #ffffff;
            font-weight: bold;
            flex-shrink: 0;
            padding: 0 0.75rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .vs-text {
            font-size: 1.5rem;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }

        .vs-subtitle {
            font-size: 0.65rem;
            color: #9ca3af;
            margin-top: 0.15rem;
        }

        /* 多選項交易界面樣式 */
        .multi-option-trading {
            display: none;
        }

        .multi-option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        /* 多選項二元選擇卡片樣式 */
        .multi-option-binary-card {
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1rem;
            transition: all 0.3s ease;
        }

        .multi-option-binary-card:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .option-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .option-title {
            font-weight: 600;
            color: #ffffff;
            font-size: 0.95rem;
        }

        .option-status {
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.7rem;
            font-weight: 500;
        }

        .option-status.pk {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
            border: 1px solid #fb923c;
        }

        .option-status.pumped {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }

        .binary-choices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.5rem;
            margin-bottom: 1rem;
        }

        .binary-choice {
            background: rgba(17, 24, 39, 0.8);
            border: 2px solid #374151;
            border-radius: 8px;
            padding: 0.75rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .binary-choice:hover {
            transform: translateY(-1px);
            border-color: #4b5563;
        }

        .binary-choice.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .binary-choice.yes.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .binary-choice.no.selected {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }

        .choice-label {
            font-weight: 600;
            font-size: 0.9rem;
            margin-bottom: 0.25rem;
            text-align: center;
        }

        .binary-choice.yes .choice-label {
            color: #10b981;
        }

        .binary-choice.no .choice-label {
            color: #ef4444;
        }

        .choice-amount {
            font-size: 0.8rem;
            color: #d1d5db;
            text-align: center;
            margin-bottom: 0.25rem;
        }

        .choice-percentage {
            font-weight: 600;
            font-size: 0.9rem;
            color: #ffffff;
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .choice-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
            border-radius: 0 0 6px 6px;
            transition: width 0.3s ease;
        }

        .binary-choice.yes .choice-indicator {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .binary-choice.no .choice-indicator {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .option-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.8rem;
            color: #9ca3af;
            padding-top: 0.5rem;
            border-top: 1px solid #374151;
        }

        .pump-progress {
            color: #f59e0b;
        }

        /* 混合狀態界面樣式 */
        .mixed-section {
            margin-bottom: 2rem;
            background: rgba(17, 24, 39, 0.4);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
        }

        .mixed-section-header {
            display: flex;
            flex-direction: column;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #374151;
        }

        .mixed-section-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .mixed-section-subtitle {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        /* 隱藏空的section */
        .mixed-section:empty,
        .mixed-section[style*="display: none"] {
            display: none !important;
        }

        /* 多選項新界面樣式 */
        .option-list {
            margin-bottom: 2rem;
        }

        .option-list-header h4 {
            color: #ffffff;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .option-items {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 0.75rem;
        }

        .option-item-btn {
            background: rgba(31, 41, 55, 0.8);
            border: 2px solid #374151;
            border-radius: 10px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
            color: #ffffff;
            position: relative;
        }

        .option-item-btn:hover {
            border-color: #3b82f6;
            transform: translateY(-2px);
        }

        .option-item-btn.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .option-item-btn.pumped {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .option-item-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: #ffffff;
        }

        .option-item-status {
            font-size: 0.8rem;
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            margin-bottom: 0.5rem;
            display: inline-block;
        }

        .option-item-status.pk {
            background: rgba(249, 115, 22, 0.2);
            color: #fb923c;
        }

        .option-item-status.pumped {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
        }

        .option-item-pool {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        /* 選中選項詳細界面 */
        .selected-option-detail {
            background: rgba(17, 24, 39, 0.6);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
        }

        .option-detail-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
            padding-bottom: 1rem;
            border-bottom: 1px solid #374151;
        }

        .option-detail-header h4 {
            color: #ffffff;
            margin: 0;
            font-size: 1.2rem;
            font-weight: 600;
        }

        .option-status-info {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            align-items: flex-end;
        }

        .pump-progress-text {
            font-size: 0.8rem;
            color: #f59e0b;
        }

        /* 二元PK界面 */
        .binary-pk-interface {
            margin-bottom: 1.5rem;
        }

        .option-pool-info {
            display: flex;
            gap: 2rem;
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #374151;
        }

        .pool-stat {
            display: flex;
            flex-direction: column;
            gap: 0.25rem;
        }

        .pool-stat .pool-label {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        .pool-stat .pool-value {
            font-size: 1rem;
            color: #ffffff;
            font-weight: 600;
        }

        /* 多選項持倉顯示樣式 */
        .option-position-header {
            font-weight: 600;
            border-bottom: 1px solid #374151;
            margin-bottom: 0.25rem;
            padding-bottom: 0.25rem;
        }

        .sub-position {
            font-size: 0.9rem;
            padding-left: 1rem;
            margin-bottom: 0.25rem;
        }

        .sub-position .pool-label {
            color: #9ca3af;
        }

        .yes-position {
            color: #10b981;
        }

        .no-position {
            color: #ef4444;
        }

        .total-row {
            border-top: 1px solid #374151;
            margin-top: 0.5rem;
            padding-top: 0.5rem;
            font-weight: 700;
        }

        /* 中央選項區域樣式 */
        .center-options-container {
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 2rem;
        }

        .section-header {
            text-align: center;
            margin-bottom: 2rem;
        }

        .section-title {
            color: #ffffff;
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .section-subtitle {
            color: #9ca3af;
            font-size: 1rem;
            margin: 0;
        }

        .option-list-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .option-list-item {
            background: rgba(17, 24, 39, 0.8);
            border: 2px solid #374151;
            border-radius: 12px;
            margin-bottom: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .option-list-item:last-child {
            margin-bottom: 0;
        }

        .option-list-item.active {
            border-color: #3b82f6;
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .option-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 1.5rem;
            cursor: pointer;
            background: rgba(31, 41, 55, 0.6);
            transition: background 0.3s ease;
        }

        .option-header:hover {
            background: rgba(31, 41, 55, 0.8);
        }

        .option-header-left {
            flex: 1;
        }

        .option-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .option-meta {
            display: flex;
            gap: 1rem;
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .option-expand-icon {
            font-size: 1.2rem;
            color: #9ca3af;
            transition: transform 0.3s ease;
        }

        .option-list-item.expanded .option-expand-icon {
            transform: rotate(180deg);
        }

        .option-details {
            display: none;
            padding: 0 1.5rem 1.5rem;
            border-top: 1px solid #374151;
        }

        .option-list-item.expanded .option-details {
            display: block;
        }

        .option-pool-display {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .pool-choice {
            background: rgba(31, 41, 55, 0.8);
            border: 2px solid #374151;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .pool-choice:hover {
            border-color: #6b7280;
        }

        .pool-choice.yes {
            border-color: #10b981;
        }

        .pool-choice.yes.selected {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }

        .pool-choice.no {
            border-color: #ef4444;
        }

        .pool-choice.no.selected {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .pool-choice-label {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .pool-choice.yes .pool-choice-label {
            color: #10b981;
        }

        .pool-choice.no .pool-choice-label {
            color: #ef4444;
        }

        .pool-choice-amount {
            font-size: 1.2rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .pool-choice-percentage {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .pool-choice.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            position: relative;
        }

        .pool-choice.disabled:hover {
            border-color: #374151;
            transform: none;
        }

        .disabled-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 0.8rem;
            color: #f59e0b;
            font-weight: 600;
            border-radius: 8px;
        }

        /* 外盤選項樣式 */
        .binary-prices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 0.75rem;
            margin-top: 1rem;
        }

        .price-item {
            background: rgba(31, 41, 55, 0.8);
            border: 2px solid #374151;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .price-item:hover {
            border-color: #6b7280;
            transform: translateY(-2px);
        }

        .price-item.yes {
            border-color: #10b981;
        }

        .price-item.yes.selected {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }

        .price-item.no {
            border-color: #ef4444;
        }

        .price-item.no.selected {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .price-label {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .price-item.yes .price-label {
            color: #10b981;
        }

        .price-item.no .price-label {
            color: #ef4444;
        }

        .price-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
        }

        /* 空狀態樣式 */
        .no-pumped-options {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 2rem;
            text-align: center;
            background: rgba(31, 41, 55, 0.3);
            border: 2px dashed #374151;
            border-radius: 12px;
            min-height: 200px;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .empty-state-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #d1d5db;
            margin-bottom: 0.5rem;
        }

        .empty-state-subtitle {
            font-size: 1rem;
            color: #9ca3af;
        }

        /* Trade選項網格樣式 */
        .trade-option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .trade-option-card {
            background: rgba(17, 24, 39, 0.8);
            border: 2px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .trade-option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .trade-option-card.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .trade-option-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .trade-option-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            line-height: 1.4;
            flex: 1;
            margin-right: 1rem;
        }

        .trade-option-status {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .trade-option-prices {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .trade-price-item {
            background: rgba(31, 41, 55, 0.8);
            border: 2px solid #374151;
            border-radius: 8px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .trade-price-item:hover {
            border-color: #6b7280;
        }

        .trade-price-item.yes {
            border-color: #10b981;
        }

        .trade-price-item.yes.selected {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            box-shadow: 0 0 15px rgba(16, 185, 129, 0.3);
        }

        .trade-price-item.no {
            border-color: #ef4444;
        }

        .trade-price-item.no.selected {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            box-shadow: 0 0 15px rgba(239, 68, 68, 0.3);
        }

        .trade-price-label {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .trade-price-item.yes .trade-price-label {
            color: #10b981;
        }

        .trade-price-item.no .trade-price-label {
            color: #ef4444;
        }

        .trade-price-value {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
        }

        .trade-option-pool {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 8px;
            padding: 0.75rem;
            font-size: 0.9rem;
            color: #9ca3af;
            text-align: center;
        }

        /* 單個選項交易器樣式 */
        .single-option-trader {
            background: rgba(17, 24, 39, 0.8);
            border: 2px solid #3b82f6;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
        }

        .single-option-trader .option-info {
            margin-bottom: 1.5rem;
        }

        .single-option-trader h4 {
            margin: 0 0 0.5rem 0;
            color: #ffffff;
            font-size: 1.1rem;
            font-weight: 600;
        }

        .single-option-trader .selected-choice {
            padding: 0.25rem 0.75rem;
            border-radius: 6px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .single-option-trader .selected-choice.yes {
            background: rgba(16, 185, 129, 0.2);
            color: #10b981;
            border: 1px solid #10b981;
        }

        .single-option-trader .selected-choice.no {
            background: rgba(239, 68, 68, 0.2);
            color: #ef4444;
            border: 1px solid #ef4444;
        }

        .single-option-trader .trading-buttons {
            display: flex;
            flex-direction: column;
            gap: 1rem;
        }

        .single-option-trader .btn {
            padding: 1rem;
            font-size: 1rem;
            font-weight: 600;
        }

        .single-option-trader .cost-estimate,
        .single-option-trader .income-estimate {
            display: block;
            margin-top: 0.5rem;
            font-size: 0.8rem;
            opacity: 0.8;
        }

        .option-progress-section {
            background: rgba(31, 41, 55, 0.5);
            border-radius: 8px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .option-progress-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .option-progress-label {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .option-progress-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #f59e0b;
        }

        .center-option-card {
            background: rgba(17, 24, 39, 0.8);
            border: 2px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .center-option-card:hover {
            border-color: #3b82f6;
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.3);
        }

        .center-option-card.active {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
            box-shadow: 0 0 20px rgba(59, 130, 246, 0.3);
        }

        .center-option-card.pumped {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.1);
        }

        .center-option-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 1rem;
        }

        .center-option-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            line-height: 1.4;
            flex: 1;
            margin-right: 1rem;
        }

        .center-option-stats {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .center-stat-item {
            text-align: center;
            padding: 0.75rem;
            background: rgba(31, 41, 55, 0.8);
            border-radius: 8px;
            border: 1px solid #374151;
        }

        .center-stat-label {
            font-size: 0.8rem;
            color: #9ca3af;
            margin-bottom: 0.25rem;
        }

        .center-stat-value {
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
        }

        .center-option-progress {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #374151;
        }

        .center-progress-info {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .center-progress-label {
            font-size: 0.9rem;
            color: #9ca3af;
        }

        .center-progress-value {
            font-size: 0.9rem;
            font-weight: 600;
            color: #f59e0b;
        }

        .center-progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(55, 65, 81, 0.5);
            border-radius: 3px;
            overflow: hidden;
        }

        .center-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f59e0b, #d97706);
            border-radius: 3px;
            transition: width 0.3s ease;
        }

        /* 無選擇提示樣式 */
        .no-selection-prompt {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 3rem 2rem;
            text-align: center;
            background: rgba(31, 41, 55, 0.3);
            border: 2px dashed #374151;
            border-radius: 12px;
            min-height: 300px;
        }

        .prompt-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.6;
        }

        .prompt-title {
            font-size: 1.2rem;
            font-weight: 600;
            color: #d1d5db;
            margin-bottom: 0.5rem;
        }

        .prompt-subtitle {
            font-size: 1rem;
            color: #9ca3af;
        }

        .option-card {
            background: rgba(31, 41, 55, 0.8);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .option-card.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .option-header {
            text-align: center;
            margin-bottom: 0.75rem;
        }

        .option-name {
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .option-stats {
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .option-amount {
            font-size: 0.9rem;
            font-weight: 600;
            color: #ffffff;
        }

        .option-percentage {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .option-participants {
            font-size: 0.7rem;
            color: #6b7280;
        }

        .option-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            border-radius: 0 0 6px 6px;
            transition: width 0.3s ease;
        }

        /* 多選項Trade LMSR樣式 */
        .multi-lmsr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .lmsr-option-card {
            background: rgba(31, 41, 55, 0.8);
            border-radius: 6px;
            padding: 0.75rem;
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .lmsr-option-header {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .lmsr-option-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .lmsr-option-price {
            font-size: 0.75rem;
            color: #10b981;
            font-weight: 600;
        }

        .lmsr-option-actions {
            display: flex;
            gap: 0.25rem;
        }

        .lmsr-mini-btn {
            flex: 1;
            padding: 0.25rem 0.5rem;
            font-size: 0.7rem;
            border-radius: 4px;
            border: 1px solid;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lmsr-buy-btn {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            color: #10b981;
        }

        .lmsr-buy-btn:hover {
            background: rgba(16, 185, 129, 0.3);
        }

        .lmsr-sell-btn {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            color: #ef4444;
        }

        .lmsr-sell-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* K線圖樣式 */
        .kline-chart-container {
            background: rgba(17, 24, 39, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(75, 85, 99, 0.3);
            overflow: hidden;
        }

        /* 分享卡片樣式 */
        .share-modal {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.8);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 10000;
            backdrop-filter: blur(10px);
        }

        .share-modal.show {
            display: flex;
        }

        .share-card {
            background: linear-gradient(135deg, #1a1b23 0%, #2d1b69 50%, #1a1b23 100%);
            border: 2px solid #3b82f6;
            border-radius: 20px;
            padding: 2.5rem;
            max-width: 500px;
            width: 90%;
            position: relative;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.5);
            animation: shareCardSlideIn 0.5s ease-out;
        }

        @keyframes shareCardSlideIn {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }

        .share-card-header {
            text-align: center;
            margin-bottom: 2rem;
            position: relative;
        }

        .share-card-title {
            font-size: 1.8rem;
            font-weight: bold;
            color: #ffffff;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .share-card-subtitle {
            color: #9ca3af;
            font-size: 1rem;
        }

        .share-card-content {
            background: rgba(31, 41, 55, 0.6);
            border: 1px solid #374151;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            position: relative;
        }

        .trade-summary {
            display: grid;
            gap: 1rem;
        }

        .trade-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid #374151;
        }

        .trade-row:last-child {
            border-bottom: none;
            font-weight: bold;
            color: #10b981;
        }

        .trade-label {
            color: #9ca3af;
            font-size: 0.9rem;
        }

        .trade-value {
            color: #ffffff;
            font-weight: 600;
        }

        .trade-highlight {
            color: #3b82f6;
            font-size: 1.1rem;
            font-weight: bold;
        }

        .share-buttons {
            display: flex;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .share-btn {
            flex: 1;
            padding: 1rem;
            border: none;
            border-radius: 12px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .share-btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: 1px solid #3b82f6;
        }

        .share-btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(59, 130, 246, 0.3);
        }

        .share-btn-secondary {
            background: rgba(31, 41, 55, 0.8);
            color: #d1d5db;
            border: 1px solid #374151;
        }

        .share-btn-secondary:hover {
            background: #374151;
            transform: translateY(-2px);
        }

        .share-close-btn {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(239, 68, 68, 0.2);
            border: 1px solid #ef4444;
            color: #ef4444;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            transition: all 0.3s ease;
        }

        .share-close-btn:hover {
            background: rgba(239, 68, 68, 0.3);
            transform: scale(1.1);
        }

        .share-watermark {
            position: absolute;
            bottom: 1rem;
            right: 1.5rem;
            color: #6b7280;
            font-size: 0.8rem;
            opacity: 0.7;
        }

        .celebration-emoji {
            position: absolute;
            font-size: 2rem;
            animation: celebrationFloat 2s ease-in-out infinite;
        }

        @keyframes celebrationFloat {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-10px) rotate(10deg); }
        }

        .profit-indicator {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            padding: 0.25rem 0.75rem;
            background: rgba(16, 185, 129, 0.2);
            border: 1px solid #10b981;
            border-radius: 20px;
            font-size: 0.8rem;
            color: #10b981;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(31, 41, 55, 0.5);
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        }

        .chart-title {
            color: #ffffff;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-btn {
            padding: 0.25rem 0.5rem;
            background: transparent;
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #9ca3af;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chart-btn:hover {
            background: rgba(75, 85, 99, 0.3);
            color: #ffffff;
        }

        .chart-btn.active {
            background: #3b82f6;
            color: #ffffff;
            border-color: #3b82f6;
        }

        .kline-chart, .line-chart {
            height: 280px;
            position: relative;
            padding: 1rem;
            background: rgba(17, 24, 39, 0.5);
        }

        /* 折线图样式 */
        .line-chart {
            position: relative;
            padding: 1rem;
        }

        .line-chart svg {
            width: 100%;
            height: 100%;
        }

        .line-chart-label {
            position: absolute;
            bottom: 0;
            font-size: 0.7rem;
            color: #9ca3af;
            white-space: nowrap;
        }

        .price-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(17, 24, 39, 0.9);
            color: #ffffff;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .kline-bar {
            position: absolute;
            bottom: 1rem;
            width: 8px;
            border-radius: 1px;
            transition: all 0.3s;
        }

        .kline-bar.up {
            background: linear-gradient(180deg, #10b981, #059669);
            border: 1px solid #10b981;
        }

        .kline-bar.down {
            background: linear-gradient(180deg, #ef4444, #dc2626);
            border: 1px solid #ef4444;
        }

        .price-indicator {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(59, 130, 246, 0.8);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .chart-tooltip {
            position: absolute;
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 4px;
            padding: 0.5rem;
            font-size: 0.75rem;
            color: #ffffff;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 100;
        }

        /* 快速下單按鈕樣式 */
        .quick-amount-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: space-between;
        }

        .quick-btn {
            flex: 1;
            padding: 0.5rem 0.75rem;
            background: rgba(75, 85, 99, 0.3);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #d1d5db;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            color: #60a5fa;
        }

        .quick-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: #ffffff;
        }

        /* 餘額顯示樣式 */
        .input-with-balance {
            position: relative;
        }

        .balance-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(17, 24, 39, 0.8);
            border-radius: 6px;
            border: 1px solid rgba(75, 85, 99, 0.3);
            min-width: 140px;
            white-space: nowrap;
        }
        
        .betting-input-row .balance-display {
            margin-top: 0;
            margin-left: 0.75rem;
        }

        .balance-label {
            color: #9ca3af;
            font-size: 0.8rem;
        }

        .balance-amount {
            color: #10b981;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .balance-amount.insufficient {
            color: #ef4444;
        }

        /* 充值按鈕樣式 */
        .recharge-btn {
            background: linear-gradient(45deg, #8b5cf6, #06b6d4);
            border: none;
            color: #ffffff;
            font-weight: 600;
            transition: all 0.3s;
        }

        .recharge-btn:hover {
            background: linear-gradient(45deg, #7c3aed, #0891b2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body>
    <!-- 左側導航欄 -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">BitX 交易原型</div>
        </div>
        <div class="sidebar-nav">
            <a href="#" class="nav-item active" onclick="showPage('home')">
                <span class="nav-icon">🏠</span>熱門話題
            </a>
            <a href="#" class="nav-item" onclick="showPage('inner')">
                <span class="nav-icon">📊</span>PK話題(演示)
            </a>
            <a href="#" class="nav-item" onclick="showPage('create')">
                <span class="nav-icon">➕</span>創建話題
            </a>
            <a href="#" class="nav-item" onclick="showPage('profile')">
                <span class="nav-icon">👤</span>個人中心
            </a>
        </div>
    </nav>

    <!-- 主布局容器 -->
    <div class="main-layout">
        <!-- 首頁/瀑布流 -->
        <div id="home" class="page active">
            <div class="content-area">
                <h1 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 2rem;">熱門話題</h1>
                <div class="waterfall" id="topicWaterfall">
                    <!-- 話題卡片將通過JavaScript動態生成 -->
                </div>
            </div>
        </div>

        <!-- PK話題頁面 -->
        <div id="inner" class="page">
            <div class="content-area">
                <h1 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 2rem;">PK話題</h1>
                <div class="waterfall" id="innerTopicWaterfall">
                    <!-- PK話題卡片將通過JavaScript動態生成 -->
                </div>
            </div>
        </div>

        <!-- 創建話題頁面 -->
        <div id="create" class="page">
            <div class="content-area">
                <div class="create-form">
                    <h2 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 1.75rem;">創建新話題</h2>
                
                    <form id="createTopicForm">
                        <!-- 第一部分：話題設定 -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">📝 話題設定</h3>
                                <p class="section-subtitle">設定話題的基本資訊</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">話題內容 *</label>
                                <textarea class="form-input form-textarea" name="content" placeholder="請輸入您要预测的話題內容..." required></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">話題頭像</label>
                                <input type="file" class="form-input" name="avatar" accept="image/*">
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">支援 JPG、PNG、GIF 格式，建議尺寸 200x200 像素</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">話題類別 *</label>
                                <select class="form-input" name="category" required>
                                    <option value="">請選擇類別</option>
                                    <option value="sports">體育賽事</option>
                                    <option value="politics">政治選舉</option>
                                    <option value="crypto">加密貨幣</option>
                                    <option value="economy">經濟預測</option>
                                    <option value="entertainment">娛樂八卦</option>
                                    <option value="technology">科技發展</option>
                                    <option value="other">其他</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="isPrivate" name="isPrivate" onchange="togglePumpSettings()">
                                    <label for="isPrivate" class="form-label" style="margin-bottom: 0;">私密話題</label>
                                </div>
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">私密話題不會出現在瀑布流中，也不會觸發Pump轉Trade</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">選項設置</label>
                                <div class="options-container">
                                    <div class="option-type-selector">
                                        <label class="radio-option">
                                            <input type="radio" name="optionType" value="binary" checked onchange="toggleOptionType()">
                                            <span class="radio-label">YES/NO 二元選擇</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="optionType" value="custom" onchange="toggleOptionType()">
                                            <span class="radio-label">多個獨立預測（每個都有YES/NO）</span>
                                        </label>
                                    </div>
                                    
                                    <div id="customOptions" style="display: none; margin-top: 1rem;">
                                        <div class="custom-options-header">
                                            <span style="color: #9ca3af; font-size: 0.9rem;">創建多個獨立預測：</span>
                                            <button type="button" class="btn btn-outline btn-sm" onclick="addOption()">+ 添加預測</button>
                                        </div>
                                        <div id="optionsList">
                                            <!-- 動態生成的選項輸入框 -->
                                        </div>
                                        <div class="option-notice" style="color: #6b7280; font-size: 0.85rem; margin-top: 0.5rem;">
                                            每個預測都是獨立的二元選擇（YES/NO），最少2個，最多8個
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- 第二部分：Pump設定 -->
                        <div class="form-section" id="pumpSection">
                            <div class="section-header">
                                <h3 class="section-title">🚀 Pump設定</h3>
                                <p class="section-subtitle">設定PK轉Trade的條件</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Pump觸發條件 *</label>
                                <div class="input-group">
                                    <span class="input-label">資金池達到</span>
                                    <input type="number" class="form-input" name="pumpCondition" value="1000" min="1000" step="100" required>
                                    <span class="input-unit">$</span>
                                </div>
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">最小值為1000$，建議設定為100的倍數</small>
                            </div>

                            <div class="pump-explanation">
                                <div class="explanation-title">💡 PK–Pump–Trade 機制說明</div>
                                <ul class="explanation-list">
                                    <li><strong>PK階段：</strong>一開始是PK模式，玩家選「是」或「否」，互相比拼支持力度</li>
                                    <li><strong>Pump階段：</strong>當PK資金達到目標，系統自動Pump升級，把部分資金注入下一階段市場</li>
                                    <li><strong>Trade階段：</strong>話題升級為公開交易市場，任何人都能參與，價格由演算法自動調整</li>
                                    <li><strong>回饋機制：</strong>公開交易的手續費中，40%會持續回饋給PK階段的玩家</li>
                                </ul>
                            </div>
                        </div>

                        <!-- 第三部分：時間設定 -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">⏰ 時間設定</h3>
                                <p class="section-subtitle">設定話題的生命週期時間</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">PK結束時間 *</label>
                                <input type="datetime-local" class="form-input" name="tradingEndTime" required onchange="updateAdvancedSettings()">
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">在此時間內可以進行PK對決，可觸發Pump轉Trade</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">話題結束時間 *</label>
                                <input type="datetime-local" class="form-input" name="topicEndTime" required onchange="updateAdvancedSettings()">
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">話題結束後所有交易停止並進行結算，需大於PK結束時間</small>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="showAdvanced" onchange="toggleAdvancedSettings()">
                                    <label for="showAdvanced" class="form-label" style="margin-bottom: 0;">顯示高級設定</label>
                                </div>
                            </div>

                            <div id="advancedSettings" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">Trade結束時間</label>
                                    <input type="datetime-local" class="form-input" name="outerTradingEndTime">
                                    <small style="color: #6b7280; margin-top: 0.5rem; display: block;">留空則與話題結束時間相同。設定後，Trade將在此時間停止交易但話題繼續至結束時間</small>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 3rem;">
                            <button type="button" class="btn btn-secondary" onclick="showPage('home')">取消</button>
                            <button type="submit" class="btn btn-primary">創建話題</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- 話題詳情页面 -->
        <div id="detail" class="page">
            <div class="content-area">
                <div class="topic-detail-container">
                    <div class="topic-header">
                        <div class="topic-avatar" id="detailAvatar">A</div>
                        <div class="topic-info">
                            <h1 class="topic-title" id="detailTitle">话题标题</h1>
                            <div class="topic-meta">
                                <span class="topic-category" id="detailCategory">类别</span>
                                <span class="status-badge status-pk" id="detailStatus">PK交易</span>
                                <span id="detailEndTime">結束時間：2024-12-31 23:59</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem; color: #9ca3af; line-height: 1.6;" id="detailDescription">
                        这里显示话题的详细描述内容...
                    </div>



                    <!-- 多選項PK選項列表區域 -->
                    <div id="centerOptionsSection" style="margin-top: 2rem; display: none;">
                        <div class="center-options-container">
                            <div class="section-header">
                                <h3 class="section-title">🎯 多項獨立預測</h3>
                                <p class="section-subtitle">選擇要預測的項目，每個項目都是獨立的二元選擇</p>
                            </div>
                            <div class="option-list-container" id="optionListContainer">
                                <!-- 動態生成選項列表 -->
                            </div>
                        </div>
                    </div>

                    <!-- 多選項Trade選項列表區域 -->
                    <div id="centerTradeOptionsSection" style="margin-top: 2rem; display: none;">
                        <div class="center-options-container">
                            <div class="section-header">
                                <h3 class="section-title">📈 多項Trade交易</h3>
                                <p class="section-subtitle">選擇要交易的選項，所有選項都已進入外盤交易</p>
                            </div>
                            <div class="trade-option-grid" id="tradeOptionGrid">
                                <!-- 動態生成Trade選項卡片 -->
                            </div>
                        </div>
                    </div>

                    <!-- 獎金池状态详情 -->
                    <div style="margin-top: 2rem;" id="poolDetailsSection">
                        <!-- 獎金池信息将通过JavaScript动态生成 -->
                    </div>
                </div>
            </div>
        </div>

        <!-- 個人中心页面 -->
        <div id="profile" class="page">
            <div class="content-area">
                <h1 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 1.75rem;">個人中心</h1>
                
                <div class="profile-stats">
                    <div class="stat-card primary">
                        <h3>持倉價值</h3>
                        <div class="value" id="totalAssets">1,234.56 U</div>
                    </div>
                    <div class="stat-card positive">
                        <h3>總盈虧</h3>
                        <div class="value" id="totalProfit">+234.56 U</div>
                    </div>
                    <div class="stat-card">
                        <h3>參與話題</h3>
                        <div class="value" style="color: #60a5fa;" id="totalTopics">8</div>
                    </div>
                    <div class="stat-card">
                        <h3>總交易量</h3>
                        <div class="value" style="color: #34d399;" id="totalTrades">30M U</div>
                    </div>
                </div>

                <!-- 持仓记录 -->
                <div class="topic-detail-container" style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1.5rem; color: #ffffff; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #3b82f6;">📊</span> 當前持倉
                    </h3>
                    <div id="currentPositions">
                        <!-- 持仓数据将通过JavaScript生成 -->
                    </div>
                </div>

                <!-- 交易歷史 -->
                <div class="topic-detail-container">
                    <h3 style="margin-bottom: 1.5rem; color: #ffffff; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #10b981;">📈</span> 交易歷史
                    </h3>
                    <div id="tradingHistory">
                        <!-- 交易歷史将通过JavaScript生成 -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- 右侧交易栏 -->
    <div class="trading-sidebar hidden" id="tradingSidebar">
        <div class="trading-header">
            <div class="trading-title" id="tradingTitle">交易面板</div>
            <div class="trading-subtitle" id="tradingSubtitle">選擇您的预测并下注</div>
        </div>

        <!-- PK交易界面 -->
        <div id="innerTrading" class="trading-section">
            <div class="section-title">陣營對決 - 選擇立場</div>
            
            <!-- PK對戰界面 -->
            <div class="pk-arena">
                <div class="pk-side yes-side" onclick="selectOption('yes')">
                    <div class="pk-header">
                        <div class="pk-icon">👍</div>
                        <div class="pk-label">YES陣營</div>
                    </div>
                    <div class="pk-stats">
                        <div class="pk-amount" id="yesAmount">0$</div>
                        <div class="pk-percentage" id="yesPercentage">0%</div>
                        <div class="pk-participants" id="yesParticipants">0人</div>
                    </div>
                    <div class="pk-indicator" id="yesIndicator"></div>
                </div>
                
                <div class="pk-vs">
                    <div class="vs-text">VS</div>
                    <div class="vs-subtitle">立場對決</div>
                </div>
                
                <div class="pk-side no-side" onclick="selectOption('no')">
                    <div class="pk-header">
                        <div class="pk-icon">👎</div>
                        <div class="pk-label">NO陣營</div>
                    </div>
                    <div class="pk-stats">
                        <div class="pk-amount" id="noAmount">0$</div>
                        <div class="pk-percentage" id="noPercentage">0%</div>
                        <div class="pk-participants" id="noParticipants">0人</div>
                    </div>
                    <div class="pk-indicator" id="noIndicator"></div>
                </div>
            </div>

            <div class="amount-input-group">
                <!-- 第一行：快捷按鈕 -->
                <div class="quick-amount-buttons">
                    <button class="quick-btn" onclick="setQuickAmount(100)">100</button>
                    <button class="quick-btn" onclick="setQuickAmount(500)">500</button>
                    <button class="quick-btn" onclick="setQuickAmount(1000)">1K</button>
                    <button class="quick-btn" onclick="setQuickAmount(5000)">5K</button>
                </div>
                
                <!-- 第二行：輸入框和餘額 -->
                <div class="betting-input-row">
                    <input type="number" class="amount-input" id="betAmount" placeholder="輸入下注金額" min="1" step="1" oninput="checkInnerBalance()">
                    <div class="balance-display">
                        <span class="balance-label">餘額:</span>
                        <span class="balance-amount" id="userBalance">10,000$</span>
                    </div>
                </div>
                
                <!-- 第三行：確認按鈕 -->
                <div class="betting-buttons-row">
                    <button class="btn btn-success" onclick="placeBet()" style="width: 100%;">加入陣營</button>
                    <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; display: none;" id="rechargeBtn">💰 充值</button>
                </div>
            </div>
        </div>

        <!-- 多選項PK交易界面 -->
        <div id="multiOptionTrading" class="trading-section multi-option-trading">
            <!-- 未選擇時的提示 -->
            <div id="noOptionSelected" class="no-selection-prompt">
                <div class="prompt-icon">🎯</div>
                <div class="prompt-title">選擇要預測的項目</div>
                <div class="prompt-subtitle">點擊左側的選項開始預測</div>
            </div>

            <!-- 選中選項的詳細界面 -->
            <div id="selectedOptionDetail" class="selected-option-detail" style="display: none;">
                <div class="option-detail-header">
                    <h4 id="selectedOptionTitle">選項標題</h4>
                    <div class="option-status-info">
                        <span id="selectedOptionStatus" class="option-status pk">PK中</span>
                        <span id="pumpProgress" class="pump-progress-text">距離上線: 200$</span>
                    </div>
                </div>
                
                <!-- YES/NO選擇界面 -->
                <div class="binary-pk-interface">
                    <div class="binary-choices">
                        <div class="binary-choice yes" onclick="selectOptionBinary('yes')" id="yesChoice">
                            <div class="choice-label">YES</div>
                            <div class="choice-amount" id="yesAmount">0 $</div>
                            <div class="choice-percentage" id="yesPercentage">50.0%</div>
                            <div class="choice-indicator" id="yesIndicator"></div>
                        </div>
                        <div class="binary-choice no" onclick="selectOptionBinary('no')" id="noChoice">
                            <div class="choice-label">NO</div>
                            <div class="choice-amount" id="noAmount">0 $</div>
                            <div class="choice-percentage" id="noPercentage">50.0%</div>
                            <div class="choice-indicator" id="noIndicator"></div>
                        </div>
                    </div>
                    
                    <div class="option-pool-info">
                        <div class="pool-stat">
                            <span class="pool-label">總資金池:</span>
                            <span class="pool-value" id="optionTotalPool">0 $</span>
                        </div>
                        <div class="pool-stat">
                            <span class="pool-label">參與人數:</span>
                            <span class="pool-value" id="optionParticipants">0 人</span>
                        </div>
                    </div>
                </div>

                <!-- 下注界面 -->
                <div class="amount-input-group">
                    <!-- 第一行：快捷按鈕 -->
                    <div class="quick-amount-buttons">
                        <button class="quick-btn" onclick="setMultiOptionQuickAmount(100)">100</button>
                        <button class="quick-btn" onclick="setMultiOptionQuickAmount(500)">500</button>
                        <button class="quick-btn" onclick="setMultiOptionQuickAmount(1000)">1K</button>
                        <button class="quick-btn" onclick="setMultiOptionQuickAmount(5000)">5K</button>
                    </div>
                    
                    <!-- 第二行：輸入框和餘額 -->
                    <div class="betting-input-row">
                        <input type="number" class="amount-input" id="multiOptionAmount" placeholder="輸入下注金額" min="1" step="1" oninput="checkInnerBalance()">
                        <div class="balance-display">
                            <span class="balance-label">餘額:</span>
                            <span class="balance-amount" id="multiUserBalance">10,000$</span>
                        </div>
                    </div>
                    
                    <!-- 第三行：確認按鈕 -->
                    <div class="betting-buttons-row">
                        <button class="btn btn-success" onclick="placeBet()" style="width: 100%;">確認下注</button>
                        <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; display: none;" id="multiRechargeBtn">💰 充值</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- 多選項混合狀態界面 -->
        <div id="multiOptionMixed" class="trading-section multi-option-trading">
            <div class="section-title">多項獨立預測 - 混合交易</div>
            
            <!-- PK階段選項 -->
            <div id="pkSectionMulti" class="mixed-section">
                <div class="mixed-section-header">
                    <span class="mixed-section-title">🎯 PK階段預測</span>
                    <span class="mixed-section-subtitle">選擇YES/NO下注</span>
                </div>
                <div class="multi-option-grid" id="mixedPkGrid">
                    <!-- 動態生成PK中的選項 -->
                </div>
                <div class="amount-input-group" id="pkAmountGroup">
                    <div class="quick-amount-buttons">
                        <button class="quick-btn" onclick="setMultiOptionQuickAmount(100)">100</button>
                        <button class="quick-btn" onclick="setMultiOptionQuickAmount(500)">500</button>
                        <button class="quick-btn" onclick="setMultiOptionQuickAmount(1000)">1K</button>
                    </div>
                    <div class="input-with-balance">
                        <input type="number" class="amount-input" id="mixedPkAmount" placeholder="輸入下注金額" min="1" step="1">
                        <div class="balance-display">
                            <span class="balance-label">餘額:</span>
                            <span class="balance-amount" id="mixedPkBalance">10,000$</span>
                        </div>
                    </div>
                    <button class="btn btn-success" onclick="placeMixedBet('pk')" style="width: 100%;">確認PK下注</button>
                </div>
            </div>
            
            <!-- Trade階段選項 -->
            <div id="tradeSectionMulti" class="mixed-section">
                <div class="mixed-section-header">
                    <span class="mixed-section-title">📈 Trade階段預測</span>
                    <span class="mixed-section-subtitle">基於市場價格交易</span>
                </div>
                <div class="multi-lmsr-grid" id="mixedTradeGrid">
                    <!-- 動態生成Trade中的選項 -->
                </div>
                <div class="amount-input-group" id="tradeAmountGroup">
                    <div class="quick-amount-buttons">
                        <button class="quick-btn" onclick="setMixedTradeQuickAmount(10)">10</button>
                        <button class="quick-btn" onclick="setMixedTradeQuickAmount(50)">50</button>
                        <button class="quick-btn" onclick="setMixedTradeQuickAmount(100)">100</button>
                    </div>
                    <div class="input-with-balance">
                        <input type="number" class="amount-input" id="mixedTradeAmount" placeholder="輸入交易數量" min="1" step="1">
                        <div class="balance-display">
                            <span class="balance-label">餘額:</span>
                            <span class="balance-amount" id="mixedTradeBalance">10,000$</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 多選項Trade交易界面 -->
        <div id="multiOptionOuter" class="trading-section multi-option-trading">
            <div class="section-title">多項獨立預測交易</div>
            
            <!-- 交易數量輸入 -->
            <div class="amount-input-group">
                <div class="quick-amount-buttons">
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(10)">10</button>
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(50)">50</button>
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(100)">100</button>
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(500)">500</button>
                </div>
                <div class="input-with-balance">
                    <input type="number" class="amount-input" id="multiLmsrAmount" placeholder="輸入交易數量" min="0.1" step="0.1" oninput="checkLMSRBalance()">
                    <div class="balance-display">
                        <span class="balance-label">餘額:</span>
                        <span class="balance-amount" id="multiOuterUserBalance">10,000$</span>
                    </div>
                </div>
            </div>

            <!-- 多選項LMSR網格 -->
            <div class="multi-lmsr-grid" id="multiLmsrGrid">
                <!-- 動態生成LMSR選項卡片 -->
            </div>
            
            <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; margin-top: 1rem; display: none;" id="multiOuterRechargeBtn">💰 充值</button>
        </div>

        <!-- Trade交易界面 -->
        <div id="outerTrading" class="trading-section" style="display: none;">
            <div class="section-title">LMSR交易</div>
            
            <!-- 價格显示区域 -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.5rem;">
                <div class="price-card yes-price">
                    <div class="price-label">YES</div>
                    <div class="price-value" id="yesPriceDisplay">50.0%</div>
                    <div class="price-unit">價格</div>
                </div>
                <div class="price-card no-price">
                    <div class="price-label">NO</div>
                    <div class="price-value" id="noPriceDisplay">50.0%</div>
                    <div class="price-unit">價格</div>
                </div>
            </div>

            <!-- 交易表单 -->
            <div class="trading-form">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #9ca3af; font-size: 0.85rem;">交易數量</label>
                    <div class="quick-amount-buttons">
                        <button class="quick-btn" onclick="setLMSRQuickAmount(10)">10</button>
                        <button class="quick-btn" onclick="setLMSRQuickAmount(50)">50</button>
                        <button class="quick-btn" onclick="setLMSRQuickAmount(100)">100</button>
                        <button class="quick-btn" onclick="setLMSRQuickAmount(500)">500</button>
                    </div>
                    <div class="input-with-balance">
                        <input type="number" class="amount-input" id="lmsrAmount" placeholder="輸入交易數量" min="0.1" step="0.1" oninput="checkLMSRBalance()">
                        <div class="balance-display">
                            <span class="balance-label">餘額:</span>
                            <span class="balance-amount" id="outerUserBalance">10,000$</span>
                        </div>
                    </div>
                </div>
                
                <div class="trading-buttons">
                    <div style="margin-bottom: 1rem;">
                        <div style="text-align: center; margin-bottom: 0.5rem; color: #9ca3af; font-size: 0.85rem;">買入</div>
                        <button class="btn btn-success lmsr-buy-btn" onclick="buyLMSR('yes')" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>買入 YES</span>
                            <small id="yesBuyInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">預計花費: 0$</small>
                        </button>
                        <button class="btn btn-danger lmsr-buy-btn" onclick="buyLMSR('no')" style="width: 100%;">
                            <span>買入 NO</span>
                            <small id="noBuyInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">預計花費: 0$</small>
                        </button>
                    </div>
                    
                    <div>
                        <div style="text-align: center; margin-bottom: 0.5rem; color: #9ca3af; font-size: 0.85rem;">賣出</div>
                        <button class="btn btn-outline btn-success" onclick="sellLMSR('yes')" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>賣出 YES</span>
                            <small id="yesSellInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">預計收入: 0$</small>
                        </button>
                        <button class="btn btn-outline btn-danger" onclick="sellLMSR('no')" style="width: 100%;">
                            <span>賣出 NO</span>
                            <small id="noSellInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">預計收入: 0$</small>
                        </button>
                    </div>
                </div>
                
                <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; margin-top: 1rem; display: none;" id="outerRechargeBtn">💰 充值</button>
            </div>
        </div>



                    <!-- 我的持仓 -->
            <div class="trading-section">
                <div class="section-title">我的持仓</div>
                
                <!-- Trade持倉 -->
                <div class="pool-section" id="myOuterPositions" style="display: none;">
                    <div class="pool-section-header">
                        <span class="pool-section-title">Trade持倉</span>
                        <span class="pool-section-badge trade">LMSR代幣</span>
                    </div>
                    <div class="pool-info">
                        <!-- 动态生成Trade持仓信息 -->
                    </div>
                </div>

                <!-- PK持倉 -->
                <div class="pool-section" id="myInnerPositions">
                    <div class="pool-section-header">
                        <span class="pool-section-title">PK持倉</span>
                        <span class="pool-section-badge">原始下注</span>
                    </div>
                    <div class="pool-info">
                        <!-- 动态生成PK持仓信息 -->
                    </div>
                </div>
            </div>

        <!-- 分享按钮 -->
        <div class="trading-section">
            <button class="btn btn-secondary" style="width: 100%;" onclick="shareLink()">
                📤 分享連結
            </button>
        </div>
    </div>



    <!-- 確認模态框 -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">確認下注</div>
            <div class="confirm-details">
                <div class="detail-row">
                    <span class="detail-label">選項：</span>
                    <span class="detail-value" id="confirmOption">YES <span id="confirmRatio">(65%)</span></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">下注額：</span>
                    <span class="detail-value" id="confirmNetAmount">95.00$</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">手續費：</span>
                    <span class="detail-value" id="confirmFee">5.00$ (5%)</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">總資金池：</span>
                    <span class="detail-value" id="confirmTotalPool">1,000$</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">取消</button>
                <button class="btn btn-primary" onclick="confirmBet()">確認</button>
            </div>
        </div>
    </div>

    <!-- 下单成功模态框 -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">✅ 下注成功！</div>
            <div class="success-details">
                <div class="detail-row">
                    <span class="detail-label">選項：</span>
                    <span class="detail-value" id="successOption">YES <span id="successRatio">(65%)</span></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">下注額：</span>
                    <span class="detail-value" id="successNetAmount">95.00$</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">手續費：</span>
                    <span class="detail-value" id="successFee">5.00$</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">總資金池：</span>
                    <span class="detail-value" id="successTotalPool">1,000$</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeSuccessModal()">確定</button>
            </div>
        </div>
    </div>

    <!-- Pump通知模态框 -->
    <div id="pumpModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">🎉 Pump成功！</div>
                            <div>恭喜！话题已成功从PK转换为Trade，现在可以进行LMSR交易了！</div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closePumpModal()">查看Trade</button>
            </div>
        </div>
    </div>

    <!-- 分享卡片模態框 -->
    <div id="shareModal" class="share-modal">
        <div class="share-card">
            <button class="share-close-btn" onclick="closeShareModal()">&times;</button>
            
            <!-- 慶祝動畫表情符號 -->
            <div class="celebration-emoji" style="top: 1rem; left: 2rem;">🎉</div>
            <div class="celebration-emoji" style="top: 2rem; right: 3rem; animation-delay: 0.5s;">🚀</div>
            <div class="celebration-emoji" style="top: 3rem; left: 4rem; animation-delay: 1s;">💰</div>
            
            <div class="share-card-header">
                <div class="share-card-title">交易成功！</div>
                <div class="share-card-subtitle">恭喜你完成了一筆精彩的交易</div>
            </div>
            
            <div class="share-card-content">
                <div class="trade-summary" id="tradeSummary">
                    <!-- 交易詳情將由JavaScript動態填充 -->
                </div>
            </div>
            
            <div class="share-buttons">
                <button class="share-btn share-btn-primary" onclick="shareToSocial('twitter')">
                    🐦 分享到 Twitter
                </button>
                <button class="share-btn share-btn-primary" onclick="shareToSocial('facebook')">
                    📘 分享到 Facebook
                </button>
            </div>
            
            <div class="share-buttons">
                <button class="share-btn share-btn-secondary" onclick="copyShareLink()">
                    📋 複製分享連結
                </button>
                <button class="share-btn share-btn-secondary" onclick="downloadShareCard()">
                    💾 下載卡片圖片
                </button>
            </div>
            
            <div class="share-watermark">BitX 交易平台</div>
        </div>
    </div>

    <script>
        // 全局状态管理
        let currentPage = 'home';
        let selectedOption = null;
        let topics = [];
        let currentTopic = null;

        // 模拟数据
        const sampleTopics = [
            {
                id: 1,
                title: "比特幣價格在2025年底能否突破15萬美元？",
                category: "crypto",
                categoryName: "加密貨幣",
                avatar: "₿",
                // PK数据（Pump前的原始下注）
                innerPool: {
                    yesAmount: 600,
                    noAmount: 400,
                    totalAmount: 1000
                },
                // Trade数据（LMSR底池 + 交易）
                outerPool: {
                    basePool: 200, // 从PK小方50%转入的底池
                    yesAmount: 320, // Trade YES交易量
                    noAmount: 280,  // Trade NO交易量
                    totalAmount: 600, // 当前资金池
                    totalVolume: 1500, // 总流水（所有交易的累计金额）
                    tradingFeeToInner: 12 // Trade交易手續費转入PK的金额
                },
                isOuter: true,
                endTime: "2025-12-31",
                status: "outer",
                description: "隨著比特幣ETF獲批和機構採用增加，比特幣價格是否能在2025年底突破歷史新高15萬美元？",
                isPrivate: false,
                pumpCondition: 1000, // 自定義Pump條件
                outerTradingEndTime: "2025-12-31", // Trade交易結束時間
                // PK持倉（原始下注）
                myInnerYes: 100,
                myInnerNo: 0,
                // Trade持倉（LMSR代幣）
                myOuterYes: 15,
                myOuterNo: 0,
                // 平均價格記錄
                myOuterYesAvgPrice: 0.65,
                myOuterNoAvgPrice: 0.0
            },
            {
                id: 2,
                title: "2024年美國總統大選結果預測",
                category: "politics", 
                categoryName: "政治选举",
                avatar: "🗳",
                innerPool: {
                    yesAmount: 800,
                    noAmount: 1200,
                    totalAmount: 2000
                },
                outerPool: {
                    basePool: 400, // 从PK小方(YES)50%转入
                    yesAmount: 600,
                    noAmount: 800,
                    totalAmount: 1400,
                    totalVolume: 2800, // 总流水
                    tradingFeeToInner: 28
                },
                isOuter: true,
                endTime: "2024-11-05",
                status: "outer",
                description: "預測2024年美國總統大選的結果，YES代表共和黨獲勝，NO代表民主黨獲勝。",
                myInnerYes: 50,
                myInnerNo: 200,
                myOuterYes: 0,
                myOuterNo: 25
            },
            {
                id: 3,
                title: "OpenAI GPT-5是否會在2024年發布？",
                category: "technology",
                categoryName: "科技发展", 
                avatar: "🤖",
                innerPool: {
                    yesAmount: 200,
                    noAmount: 150,
                    totalAmount: 350
                },
                outerPool: null, // 还未Pump
                isOuter: false,
                endTime: "2024-12-31",
                status: "inner",
                description: "OpenAI是否會在2024年内發布GPT-5模型？基于当前的技術发展进度和公司公告进行预测。",
                myInnerYes: 0,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            },
            {
                id: 4,
                title: "以太坊2025年價格預測",
                category: "crypto",
                categoryName: "加密貨幣",
                avatar: "⧫",
                options: ["突破8000美元", "達到10000美元", "創歷史新高", "回調至3000美元"],
                // 所有選項都已完全Pump到外盤，不再有innerPools
                // 外盤池（所有選項都已Pump）
                outerPools: [
                    { // 突破8000美元
                        yesAmount: 400,
                        noAmount: 200,
                        totalAmount: 600,
                        tradingFeeToInner: 8
                    },
                    { // 達到10000美元
                        yesAmount: 300,
                        noAmount: 300,
                        totalAmount: 600,
                        tradingFeeToInner: 12
                    },
                    { // 創歷史新高
                        yesAmount: 250,
                        noAmount: 350,
                        totalAmount: 600,
                        tradingFeeToInner: 15
                    },
                    { // 回調至3000美元
                        yesAmount: 150,
                        noAmount: 450,
                        totalAmount: 600,
                        tradingFeeToInner: 20
                    }
                ],
                endTime: "2025-12-31",
                status: "outer", // 完全Trade狀態：所有選項都已Pump
                description: "2025年以太坊價格的多項預測，分析市場趨勢和技術發展對價格的影響。",
                isPrivate: false,
                pumpCondition: 200, // 每個選項的Pump門檻
                // 我在各選項Trade的持倉 [YES, NO]
                myOuterPositions: [
                    [8, 2],   // 突破8000美元：YES 8份, NO 2份
                    [5, 5],   // 達到10000美元：YES 5份, NO 5份
                    [3, 7],   // 創歷史新高：YES 3份, NO 7份
                    [0, 10]   // 回調至3000美元：YES 0份, NO 10份
                ]
            },
            {
                id: 5,
                title: "AI技術發展預測",
                category: "tech",
                categoryName: "科技創新",
                avatar: "🤖",
                options: ["GPT-5會在2025年發布", "自動駕駛全面普及", "量子計算突破", "腦機接口商用化"],
                // 部分選項已Pump，部分還在PK
                innerPools: [
                    null, // GPT-5會在2025年發布 - 已Pump
                    { // 自動駕駛全面普及 - 未Pump
                        yesAmount: 120,
                        noAmount: 80,
                        totalAmount: 200
                    },
                    { // 量子計算突破 - 未Pump
                        yesAmount: 90,
                        noAmount: 60,
                        totalAmount: 150
                    },
                    null // 腦機接口商用化 - 已Pump
                ],
                outerPools: [
                    { // GPT-5會在2025年發布 - 已Pump
                        yesAmount: 300,
                        noAmount: 300,
                        totalAmount: 600,
                        tradingFeeToInner: 12
                    },
                    null, // 自動駕駛全面普及 - 未Pump
                    null, // 量子計算突破 - 未Pump
                    { // 腦機接口商用化 - 已Pump
                        yesAmount: 150,
                        noAmount: 450,
                        totalAmount: 600,
                        tradingFeeToInner: 15
                    }
                ],
                endTime: "2025-12-31",
                status: "mixed", // 混合狀態
                description: "AI技術在未來幾年的發展預測，包含多個技術方向的獨立判斷。",
                isPrivate: false,
                pumpCondition: 200,
                // 我在各選項PK的持倉 [YES, NO]
                myInnerPositions: [
                    [0, 0],   // GPT-5會在2025年發布：已Pump
                    [15, 5],  // 自動駕駛全面普及：YES 15, NO 5
                    [10, 0],  // 量子計算突破：YES 10, NO 0
                    [0, 0]    // 腦機接口商用化：已Pump
                ],
                // 我在各選項Trade的持倉 [YES, NO]
                myOuterPositions: [
                    [5, 5],   // GPT-5會在2025年發布：YES 5份, NO 5份
                    [0, 0],   // 自動駕駛全面普及：未Pump
                    [0, 0],   // 量子計算突破：未Pump
                    [0, 8]    // 腦機接口商用化：YES 0份, NO 8份
                ]
            },
            {
                id: 7,
                title: "2024年奧斯卡最佳影片獎預測",
                category: "entertainment",
                categoryName: "娛樂藝術",
                avatar: "🏆",
                options: ["沙丘2", "奧本海默", "花月殺手", "貧民窟百萬富翁重製版", "其他"],
                innerPool: {
                    option0Amount: 150,  // 沙丘2
                    option1Amount: 200,  // 奧本海默
                    option2Amount: 120,  // 花月殺手
                    option3Amount: 80,   // 貧民窟百萬富翁重製版
                    option4Amount: 50,   // 其他
                    totalAmount: 600
                },
                outerPool: null, // 還未Pump
                isOuter: false,
                endTime: "2024-03-10",
                status: "inner",
                description: "2024年第96屆奧斯卡金像獎最佳影片獎花落誰家？基於影片質量、票房表現和學院偏好進行預測。",
                isPrivate: false,
                pumpCondition: 1000,
                // PK多選項持倉
                myOption0: 30,  // 我在沙丘2的投注
                myOption1: 0,   // 我在奧本海默的投注
                myOption2: 20,  // 我在花月殺手的投注
                myOption3: 0,   // 我在貧民窟百萬富翁重製版的投注
                myOption4: 0    // 我在其他的投注
            },
            {
                id: 6,
                title: "特斯拉股價能否在2024年超過300美元？",
                category: "economy",
                categoryName: "經濟预测",
                avatar: "🚗",
                innerPool: {
                    yesAmount: 80,
                    noAmount: 120,
                    totalAmount: 200
                },
                outerPool: null,
                isOuter: false,
                endTime: "2024-12-31",
                status: "inner",
                description: "考慮到電動車市場競爭和特斯拉的業務發展，其股價是否能在2024年突破300美元？",
                myInnerYes: 50,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            }
        ];

        // 页面切换
        function showPage(pageId) {
            // 更新页面显示
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // 更新导航状态
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // 根据页面设置对应的导航项为活跃状态
            const navMap = {
                'home': 0,
                'inner': 1,
                'create': 2,
                'profile': 3
            };
            if (navMap[pageId] !== undefined) {
                document.querySelectorAll('.nav-item')[navMap[pageId]].classList.add('active');
            }
            
            currentPage = pageId;

            // 控制交易栏显示
            const tradingSidebar = document.getElementById('tradingSidebar');
            if (pageId === 'detail') {
                tradingSidebar.classList.remove('hidden');
            } else {
                tradingSidebar.classList.add('hidden');
            }

            if (pageId === 'home') {
                renderTopics();
            } else if (pageId === 'inner') {
                renderInnerTopics();
            } else if (pageId === 'profile') {
                renderProfileData();
            }
        }

        // 渲染话题瀑布流
        function renderTopics() {
            const waterfall = document.getElementById('topicWaterfall');
            waterfall.innerHTML = '';

            sampleTopics.filter(topic => topic.status === 'outer' || topic.status === 'mixed').forEach(topic => {
                const card = document.createElement('div');
                card.className = 'topic-card';
                card.onclick = () => showTopicDetail(topic.id);
                
                // 计算Trade总獎金池
                const isMultiOption = topic.options && topic.options.length > 2;
                let outerTotalPool = 0;
                
                // 計算領先選項
                let leadingOption = 'YES';
                let leadingPercentage = '50.0';
                
                if (isMultiOption && topic.status === 'mixed') {
                    // 多選項混合狀態：計算所有已Pump選項的總池
                    if (topic.outerPools) {
                        topic.outerPools.forEach((pool, index) => {
                            if (pool) {
                                outerTotalPool += pool.totalAmount || 0;
                            }
                        });
                    }
                    
                    // 找出資金最多的已Pump選項
                    let maxPool = 0;
                    let maxOptionIndex = 0;
                    topic.outerPools?.forEach((pool, index) => {
                        if (pool && pool.totalAmount > maxPool) {
                            maxPool = pool.totalAmount;
                            maxOptionIndex = index;
                        }
                    });
                    
                    if (maxPool > 0) {
                        leadingOption = topic.options[maxOptionIndex];
                        const maxPoolData = topic.outerPools[maxOptionIndex];
                        const yesAmount = maxPoolData.yesAmount || 0;
                        const totalAmount = maxPoolData.totalAmount || 1;
                        leadingPercentage = ((yesAmount / totalAmount) * 100).toFixed(1);
                        if (yesAmount < (maxPoolData.noAmount || 0)) {
                            leadingPercentage = (((maxPoolData.noAmount || 0) / totalAmount) * 100).toFixed(1);
                        }
                    }
                } else if (isMultiOption && topic.status === 'outer') {
                    // 多選項完全Trade狀態
                    if (topic.outerPools) {
                        topic.outerPools.forEach((pool) => {
                            if (pool) {
                                outerTotalPool += pool.totalAmount || 0;
                            }
                        });
                    }
                    leadingOption = topic.options[0] || '選項1';
                    leadingPercentage = '25.0';  // 簡單平均
                } else {
                    // 二元選項
                    outerTotalPool = (topic.outerPool?.basePool || 0) + (topic.outerPool?.totalAmount || 0);
                    const yesAmount = topic.outerPool?.yesAmount || 0;
                    const totalAmount = topic.outerPool?.totalAmount || 1;
                    leadingPercentage = ((yesAmount / totalAmount) * 100).toFixed(1);
                    if (yesAmount < (topic.outerPool?.noAmount || 0)) {
                        leadingOption = 'NO';
                        leadingPercentage = (((topic.outerPool?.noAmount || 0) / totalAmount) * 100).toFixed(1);
                    }
                }
                
                card.innerHTML = `
                    <div class="topic-header">
                        <div class="topic-avatar">${topic.avatar}</div>
                        <div class="topic-info">
                            <h3>${topic.title}</h3>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="topic-category">${topic.categoryName}</div>
                                ${isMultiOption ? '<span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 500;">多選項</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="topic-stats">
                        <div class="stat">
                            <div class="stat-value">${outerTotalPool}</div>
                            <div class="stat-label">Trade总池($)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${leadingPercentage}%</div>
                            <div class="stat-label">${leadingOption}領先</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${topic.endTime}</div>
                            <div class="stat-label">結束時間</div>
                        </div>
                    </div>
                `;
                

                waterfall.appendChild(card);
            });
            

        }

        // 渲染PK話題瀑布流
        function renderInnerTopics() {
            const waterfall = document.getElementById('innerTopicWaterfall');
            waterfall.innerHTML = '';

            const pkTopics = sampleTopics.filter(topic => topic.status === 'inner');

            pkTopics.forEach(topic => {
                const card = document.createElement('div');
                card.className = 'topic-card';
                card.onclick = () => showTopicDetail(topic.id);
                
                // 計算PK資金池信息
                const pkTotalPool = topic.innerPool.totalAmount;
                const isMultiOption = topic.options && topic.options.length > 2;
                const pumpThreshold = topic.pumpCondition || 1000;
                const pumpProgress = Math.min((pkTotalPool / pumpThreshold) * 100, 100).toFixed(1);
                
                // 計算到Pump還需多少
                const pumpRemaining = Math.max(pumpThreshold - pkTotalPool, 0);
                
                // 計算最受歡迎的選項
                let leadingOption = 'YES';
                let leadingPercentage = '50.0';
                
                if (isMultiOption) {
                    let maxAmount = 0;
                    let maxIndex = 0;
                    for (let i = 0; i < topic.options.length; i++) {
                        const amount = topic.innerPool[`option${i}Amount`] || 0;
                        if (amount > maxAmount) {
                            maxAmount = amount;
                            maxIndex = i;
                        }
                    }
                    leadingOption = topic.options[maxIndex] || '選項1';
                    leadingPercentage = pkTotalPool > 0 ? ((maxAmount / pkTotalPool) * 100).toFixed(1) : '0.0';
                } else {
                    const yesAmount = topic.innerPool.yesAmount || 0;
                    leadingPercentage = pkTotalPool > 0 ? ((yesAmount / pkTotalPool) * 100).toFixed(1) : '50.0';
                    if (yesAmount < (topic.innerPool.noAmount || 0)) {
                        leadingOption = 'NO';
                        leadingPercentage = pkTotalPool > 0 ? (((topic.innerPool.noAmount || 0) / pkTotalPool) * 100).toFixed(1) : '50.0';
                    }
                }
                
                card.innerHTML = `
                    <div class="topic-header">
                        <div class="topic-avatar">${topic.avatar}</div>
                        <div class="topic-info">
                            <h3>${topic.title}</h3>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="topic-category">${topic.categoryName}</div>
                                ${isMultiOption ? '<span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 500;">多選項</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="topic-stats">
                        <div class="stat">
                            <div class="stat-value">${pkTotalPool}</div>
                            <div class="stat-label">PK總池($)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${leadingPercentage}%</div>
                            <div class="stat-label">${leadingOption}領先</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${pumpProgress}%</div>
                            <div class="stat-label">Pump進度</div>
                        </div>
                    </div>
                    <div class="topic-progress">
                        <div style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 0.5rem;">
                            距離Pump還需: <strong style="color: #f59e0b;">${pumpRemaining}$</strong>
                        </div>
                        <div style="background: #374151; border-radius: 4px; height: 6px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #10b981, #059669); height: 100%; width: ${pumpProgress}%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                `;
                
                waterfall.appendChild(card);
            });

            // 如果沒有PK話題，顯示空狀態
            if (waterfall.children.length === 0) {
                waterfall.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #6b7280;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">📊</div>
                        <h3 style="margin-bottom: 0.5rem;">暫無PK話題</h3>
                        <p>所有話題都已進入Trade階段，或創建新話題開始交易</p>
                    </div>
                `;
            }
        }

        // 显示話題詳情
        function showTopicDetail(topicId) {
            currentTopic = sampleTopics.find(t => t.id === topicId) || {
                id: topicId,
                title: "新话题",
                category: "other",
                categoryName: "其他",
                avatar: "💡",
                innerPool: {
                    yesAmount: 0,
                    noAmount: 0,
                    totalAmount: 0
                },
                outerPool: null,
                isOuter: false,
                endTime: "2024-12-31",
                status: "inner",
                description: "这是一个新创建的话题",
                myInnerYes: 0,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            };

            // 更新页面内容
            document.getElementById('detailTitle').textContent = currentTopic.title;
            document.getElementById('detailCategory').textContent = currentTopic.categoryName;
            document.getElementById('detailAvatar').textContent = currentTopic.avatar;
            document.getElementById('detailEndTime').textContent = `結束時間：${currentTopic.endTime}`;
            document.getElementById('detailDescription').textContent = currentTopic.description || currentTopic.title;
            
            // 根据话题状态更新交易栏
            updateTradingInterface();
            updatePoolDisplay();
            showPage('detail');
        }

        // 更新交易界面
        function updateTradingInterface() {
            if (!currentTopic) return;
            
            const isOuter = currentTopic.status === 'outer' || currentTopic.status === 'mixed';
            const tradingTitle = document.getElementById('tradingTitle');
            const tradingSubtitle = document.getElementById('tradingSubtitle');
            const statusBadge = document.getElementById('detailStatus');
            const innerTrading = document.getElementById('innerTrading');
            const outerTrading = document.getElementById('outerTrading');
            const multiOptionTrading = document.getElementById('multiOptionTrading');
            const multiOptionOuter = document.getElementById('multiOptionOuter');
            const multiOptionMixed = document.getElementById('multiOptionMixed');
            const centerKlineSection = document.getElementById('centerKlineSection');
            const centerOptionsSection = document.getElementById('centerOptionsSection');
            const centerTradeOptionsSection = document.getElementById('centerTradeOptionsSection');
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;

            // 隱藏所有交易界面和中央區域
            innerTrading.style.display = 'none';
            outerTrading.style.display = 'none';
            if (multiOptionTrading) multiOptionTrading.style.display = 'none';
            if (multiOptionOuter) multiOptionOuter.style.display = 'none';
            if (multiOptionMixed) multiOptionMixed.style.display = 'none';
            if (centerKlineSection) centerKlineSection.style.display = 'none';
            if (centerOptionsSection) centerOptionsSection.style.display = 'none';
            if (centerTradeOptionsSection) centerTradeOptionsSection.style.display = 'none';

            if (isOuter) {
                // Trade状态
                tradingTitle.textContent = 'LMSR交易';
                tradingSubtitle.textContent = '基于市场價格的预测市场交易';
                statusBadge.textContent = 'Trade交易';
                statusBadge.className = 'status-badge status-trade';
                
                if (isMultiOption) {
                    // 檢查多選項的狀態
                    const status = getMultiOptionStatus();
                    if (status === 'mixed') {
                        // 混合狀態：表現得像完全Trade狀態，但只顯示已Pump選項
                        tradingTitle.textContent = 'LMSR交易';
                        tradingSubtitle.textContent = '基于市场價格的预测市场交易';
                        statusBadge.textContent = 'Trade';
                        statusBadge.className = 'status-badge status-trade';
                        if (centerTradeOptionsSection) centerTradeOptionsSection.style.display = 'block';
                        if (multiOptionOuter) multiOptionOuter.style.display = 'block';
                        updateTradeOptionsInterface(); // 這會過濾掉未Pump選項
                        updateMultiLMSRInterface();
                    } else {
                        // 全部已Trade - 顯示中央選項區域和右側交易器
                        if (centerTradeOptionsSection) centerTradeOptionsSection.style.display = 'block';
                        if (multiOptionOuter) multiOptionOuter.style.display = 'block';
                        updateTradeOptionsInterface();
                        updateMultiLMSRInterface();
                    }
                } else {
                    outerTrading.style.display = 'block';
                    updateLMSRPrices();
                }
                
                // 顯示中間區域的K線圖
                if (centerKlineSection) {
                    centerKlineSection.style.display = 'block';
                }
                
                // 更新LMSR價格显示
                updateLMSRPrices();
                
                // 初始化價格走勢圖
                setTimeout(() => {
                    initKlineChart();
                }, 100);
            } else {
                // PK状态
                statusBadge.textContent = 'PK交易';
                statusBadge.className = 'status-badge status-pk';
                
                if (isMultiOption) {
                    tradingTitle.textContent = '多項獨立預測';
                    tradingSubtitle.textContent = '每項都可選擇YES/NO';
                    // 顯示中央選項區域和右側交易器
                    if (centerOptionsSection) centerOptionsSection.style.display = 'block';
                    if (multiOptionTrading) multiOptionTrading.style.display = 'block';
                    // 隱藏右側的獎金池詳情，因為每個選項都是獨立的
                    const poolDetailsSection = document.getElementById('poolDetailsSection');
                    if (poolDetailsSection) poolDetailsSection.style.display = 'none';
                    updateMultiOptionInterface();
                } else {
                    tradingTitle.textContent = '預測對決';
                    tradingSubtitle.textContent = '選擇立場，預見未來';
                    innerTrading.style.display = 'block';
                    // 顯示右側的獎金池詳情
                    const poolDetailsSection = document.getElementById('poolDetailsSection');
                    if (poolDetailsSection) poolDetailsSection.style.display = 'block';
                    updatePKInterface();
                }
                
                // 隱藏中間區域的K線圖
                if (centerKlineSection) {
                    centerKlineSection.style.display = 'none';
                }
                
                // 更新PK界面數據
                updatePKInterface();
                
                // 检查是否接近Pump条件
                if (currentTopic.totalPool >= 800) {
                    tradingSubtitle.textContent = '即将达到Pump条件！';
                    tradingSubtitle.style.color = '#f59e0b';
                } else {
                    tradingSubtitle.style.color = '#6b7280';
                }
            }
        }

        // 更新LMSR價格显示
        function updateLMSRPrices() {
            if (!currentTopic || currentTopic.status !== 'outer' || !currentTopic.outerPool) return;

                            // 使用Trade数据计算LMSR價格
                const tradePool = currentTopic.outerPool;
                const totalAmount = tradePool.totalAmount;
                const yesAmount = tradePool.yesAmount;
                const noAmount = tradePool.noAmount;
                
                // 基本價格计算（基于Trade獎金池比例）
                const yesPrice = yesAmount / totalAmount;
                const noPrice = noAmount / totalAmount;

            // 更新價格显示（百分比格式）
            document.getElementById('yesPriceDisplay').textContent = `${(yesPrice * 100).toFixed(1)}%`;
            document.getElementById('noPriceDisplay').textContent = `${(noPrice * 100).toFixed(1)}%`;

            // 监听数量輸入变化，更新預計花費和收入
            const amountInput = document.getElementById('lmsrAmount');
            const updateCostInfo = () => {
                const amount = parseFloat(amountInput.value) || 0;
                const yesCostBase = amount * yesPrice;
                const noCostBase = amount * noPrice;
                
                // 包含5%手續費的总成本（買入）
                const yesCostTotal = (yesCostBase * 1.05).toFixed(2);
                const noCostTotal = (noCostBase * 1.05).toFixed(2);
                
                // 扣除5%手續費的净收入（賣出）
                const yesRevenueTotal = (yesCostBase * 0.95).toFixed(2);
                const noRevenueTotal = (noCostBase * 0.95).toFixed(2);
                
                // 更新買入信息
                document.getElementById('yesBuyInfo').textContent = `預計花費: ${yesCostTotal}$ `;
                document.getElementById('noBuyInfo').textContent = `預計花費: ${noCostTotal}$ `;
                
                // 更新賣出信息
                document.getElementById('yesSellInfo').textContent = `預計收入: ${yesRevenueTotal}$`;
                document.getElementById('noSellInfo').textContent = `預計收入: ${noRevenueTotal}$`;
            };

            // 绑定輸入事件
            amountInput.removeEventListener('input', updateCostInfo);
            amountInput.addEventListener('input', updateCostInfo);
            
            // 初始更新
            updateCostInfo();
        }

        // LMSR買入功能
        function buyLMSR(option) {
                    if (!currentTopic || currentTopic.status !== 'outer' || !currentTopic.outerPool) {
            alert('只能在Trade状态下进行LMSR交易');
            return;
        }

            const amount = parseFloat(document.getElementById('lmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('請輸入有效的交易數量');
                return;
            }

            // 計算交易成本
            const yesPrice = currentTopic.outerPool.yesAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount) || 0.5;
            const noPrice = 1 - yesPrice;
            const priceBase = option === 'yes' ? yesPrice : noPrice;
            const cost = amount * priceBase * 1.05; // 包含5%手續費

            // 檢查餘額
            if (cost > userBalance) {
                const shortage = cost - userBalance;
                const shouldRecharge = confirm(`💰 餘額不足，無法完成交易\n\n需要金額: ${cost.toFixed(2)} $\n當前餘額: ${userBalance.toFixed(2)} $\n不足金額: ${shortage.toFixed(2)} $\n\n是否立即充值？`);
                
                if (shouldRecharge) {
                    showRecharge();
                } else {
                    // 顯示充值按鈕
                    const outerRechargeBtn = document.getElementById('outerRechargeBtn');
                    if (outerRechargeBtn) outerRechargeBtn.style.display = 'block';
                }
                
                return;
            }

            // 计算5%手續費
            const tradingFee = cost * 0.05;
            const netCost = cost - tradingFee;

            // 計算平均價格（不包含手續費）
            const averagePrice = netCost / amount;
            
            // 計算潛在收益（購買的代幣如果贏了能獲得的總金額）
            const potentialProfit = amount; // 如果赢了，每个代币价值1 $，所以总收益是代币数量
            
            // 確認交易
            if (confirm(`確認買入 ${amount} 个 ${option.toUpperCase()} 代幣？\n平均價格: ${(averagePrice * 100).toFixed(1)}%\n總花費: ${cost.toFixed(2)} $\n手續費: ${tradingFee.toFixed(2)} $\n潛在收益: ${potentialProfit.toFixed(2)} $`)) {
                
                // 扣除餘額
                userBalance -= cost;
                // 更新Trade持倉和平均價格
                if (option === 'yes') {
                    const currentYes = currentTopic.myOuterYes || 0;
                    const currentYesAvg = currentTopic.myOuterYesAvgPrice || 0;
                    const newTotal = currentYes + amount;
                    // 計算新的平均價格
                    currentTopic.myOuterYesAvgPrice = currentYes > 0 ? 
                        ((currentYes * currentYesAvg) + (amount * priceBase)) / newTotal : priceBase;
                    currentTopic.myOuterYes = newTotal;
                } else {
                    const currentNo = currentTopic.myOuterNo || 0;
                    const currentNoAvg = currentTopic.myOuterNoAvgPrice || 0;
                    const newTotal = currentNo + amount;
                    // 計算新的平均價格
                    currentTopic.myOuterNoAvgPrice = currentNo > 0 ? 
                        ((currentNo * currentNoAvg) + (amount * priceBase)) / newTotal : priceBase;
                    currentTopic.myOuterNo = newTotal;
                }

                // 更新Trade獎金池和总流水
                currentTopic.outerPool.totalAmount += netCost;
                currentTopic.outerPool.totalVolume = (currentTopic.outerPool.totalVolume || 0) + cost; // 总流水包含手续费
                if (option === 'yes') {
                    currentTopic.outerPool.yesAmount += netCost;
                } else {
                    currentTopic.outerPool.noAmount += netCost;
                }

                // 手續費的40%回流到PK
                const feeToPK = tradingFee * 0.4;
                currentTopic.outerPool.tradingFeeToInner += feeToPK;

                // 更新sampleTopics中的数据
                const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
                if (topicIndex !== -1) {
                    sampleTopics[topicIndex] = {...currentTopic};
                }

                // 更新显示
                updateLMSRPrices();
                updatePoolDisplay();

                // 清空輸入
                document.getElementById('lmsrAmount').value = '';

                // 更新餘額顯示
                updateBalanceDisplay();

                // 顯示分享卡片而不是簡單的alert
                const tradeData = {
                    type: 'buy',
                    topicTitle: currentTopic.title,
                    option: option.toUpperCase(),
                    amount: amount,
                    averagePrice: averagePrice,
                    cost: cost,
                    fee: tradingFee,
                    potentialProfit: potentialProfit
                };
                showShareModal(tradeData);
            }
        }

        // LMSR賣出函數
        function sellLMSR(option) {
                    if (!currentTopic || currentTopic.status !== 'outer' || !currentTopic.outerPool) {
            alert('只能在Trade狀態下進行LMSR交易');
            return;
        }

            const amount = parseFloat(document.getElementById('lmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('請輸入有效的交易數量');
                return;
            }

            // 檢查持倉是否足夠
            const currentHolding = option === 'yes' ? (currentTopic.myOuterYes || 0) : (currentTopic.myOuterNo || 0);
            if (amount > currentHolding) {
                alert(`持倉不足！您目前持有 ${currentHolding} 個 ${option.toUpperCase()} 代幣`);
                return;
            }

            // 計算賣出收入（从数据源获取价格而不是显示文本）
            const yesPrice = currentTopic.outerPool.yesAmount / currentTopic.outerPool.totalAmount;
            const noPrice = currentTopic.outerPool.noAmount / currentTopic.outerPool.totalAmount;
            const revenue = option === 'yes' ? amount * yesPrice : amount * noPrice;

            // 計算2%手續費
            const tradingFee = revenue * 0.05;
            const netRevenue = revenue - tradingFee;

            // 計算平均價格（不包含手續費）
            const averagePrice = netRevenue / amount;
            
            // 計算當前價格用於顯示
            const currentPrice = option === 'yes' ? 
                currentTopic.outerPool.yesAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount) :
                currentTopic.outerPool.noAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount);
            
            // 確認交易
            if (confirm(`確認賣出 ${amount} 個 ${option.toUpperCase()} 代幣？\n平均價格: ${(averagePrice * 100).toFixed(1)}%\n當前價格: ${(currentPrice * 100).toFixed(1)}%\n總收入: ${revenue.toFixed(2)} $\n手續費: ${tradingFee.toFixed(2)} $`)) {
                // 更新Trade持倉
                if (option === 'yes') {
                    currentTopic.myOuterYes = (currentTopic.myOuterYes || 0) - amount;
                } else {
                    currentTopic.myOuterNo = (currentTopic.myOuterNo || 0) - amount;
                }

                // 更新Trade資金池（從池中取出資金）和总流水
                currentTopic.outerPool.totalAmount -= netRevenue;
                currentTopic.outerPool.totalVolume = (currentTopic.outerPool.totalVolume || 0) + revenue; // 总流水包含手续费
                if (option === 'yes') {
                    currentTopic.outerPool.yesAmount -= netRevenue;
                } else {
                    currentTopic.outerPool.noAmount -= netRevenue;
                }

                // 手續費的40%回流到PK
                const feeToPK = tradingFee * 0.4;
                currentTopic.outerPool.tradingFeeToInner += feeToPK;

                // 更新sampleTopics中的數據
                const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
                if (topicIndex !== -1) {
                    sampleTopics[topicIndex] = {...currentTopic};
                }

                // 更新顯示
                updateLMSRPrices();
                updatePoolDisplay();

                // 清空輸入
                document.getElementById('lmsrAmount').value = '';

                // 增加餘額（賣出收入）
                userBalance += netRevenue;
                updateBalanceDisplay();

                // 顯示分享卡片而不是簡單的alert
                const tradeData = {
                    type: 'sell',
                    topicTitle: currentTopic.title,
                    option: option.toUpperCase(),
                    amount: amount,
                    averagePrice: averagePrice,
                    cost: revenue,
                    fee: tradingFee
                };
                showShareModal(tradeData);
            }
        }

        // 更新多選項PK界面 - 顯示中央選項列表
        function updateMultiOptionInterface() {
            if (!currentTopic || !currentTopic.options) return;
            
            // 更新中央選項列表區域
            const listContainer = document.getElementById('optionListContainer');
            if (listContainer) {
                listContainer.innerHTML = '';
                
                currentTopic.options.forEach((option, index) => {
                    // 獲取該選項的資金池數據
                    const pool = currentTopic.innerPools ? currentTopic.innerPools[index] : null;
                    const yesAmount = pool ? pool.yesAmount : 0;
                    const noAmount = pool ? pool.noAmount : 0;
                    const totalAmount = pool ? pool.totalAmount : 0;
                    
                    const yesPercentage = totalAmount > 0 ? ((yesAmount / totalAmount) * 100).toFixed(1) : '50.0';
                    const noPercentage = totalAmount > 0 ? ((noAmount / totalAmount) * 100).toFixed(1) : '50.0';
                    
                    // 檢查該選項是否已Pump
                    const isPumped = currentTopic.outerPools && currentTopic.outerPools[index];
                    const statusText = isPumped ? '已Pump' : 'PK中';
                    
                    // 計算Pump進度
                    const pumpThreshold = currentTopic.pumpCondition || 200;
                    const pumpProgress = Math.min((totalAmount / pumpThreshold) * 100, 100);
                    const remainingAmount = Math.max(0, pumpThreshold - totalAmount);
                    
                    const listItem = document.createElement('div');
                    listItem.className = 'option-list-item';
                    listItem.setAttribute('data-option-index', index);
                    
                    listItem.innerHTML = `
                        <div class="option-header" onclick="toggleOptionExpand(${index})">
                            <div class="option-header-left">
                                <div class="option-title">${option}</div>
                                <div class="option-meta">
                                    <span>總池: ${totalAmount}$</span>
                                    <span>狀態: ${statusText}</span>
                                </div>
                            </div>
                            <div class="option-expand-icon">▼</div>
                        </div>
                        <div class="option-details">
                            <div class="option-pool-display">
                                <div class="pool-choice yes ${isPumped ? 'disabled' : ''}" data-choice="yes" onclick="${isPumped ? '' : `selectOptionChoice(${index}, 'yes')`}">
                                    <div class="pool-choice-label">YES</div>
                                    <div class="pool-choice-amount">${yesAmount}$</div>
                                    <div class="pool-choice-percentage">${yesPercentage}%</div>
                                    ${isPumped ? '<div class="disabled-overlay">已Pump</div>' : ''}
                                </div>
                                <div class="pool-choice no ${isPumped ? 'disabled' : ''}" data-choice="no" onclick="${isPumped ? '' : `selectOptionChoice(${index}, 'no')`}">
                                    <div class="pool-choice-label">NO</div>
                                    <div class="pool-choice-amount">${noAmount}$</div>
                                    <div class="pool-choice-percentage">${noPercentage}%</div>
                                    ${isPumped ? '<div class="disabled-overlay">已Pump</div>' : ''}
                                </div>
                            </div>
                            <div class="option-progress-section">
                                <div class="option-progress-header">
                                    <span class="option-progress-label">Pump進度</span>
                                    <span class="option-progress-value">${isPumped ? '已Pump' : `還需 ${remainingAmount}$`}</span>
                                </div>
                                <div class="center-progress-bar">
                                    <div class="center-progress-fill" style="width: ${pumpProgress}%"></div>
                                </div>
                            </div>
                        </div>
                    `;
                    listContainer.appendChild(listItem);
                });
            }
            
            // 默認選中第一個選項的YES並展開
            if (currentTopic.options && currentTopic.options.length > 0) {
                setTimeout(() => {
                    toggleOptionExpand(0);
                    selectOptionChoice(0, 'yes');
                }, 100);
            } else {
                // 重置右側交易器為無選擇狀態
                resetRightTrader();
            }
        }

        // 切換選項展開/收起
        function toggleOptionExpand(optionIndex) {
            const listItem = document.querySelector(`[data-option-index="${optionIndex}"]`);
            if (listItem) {
                const isExpanded = listItem.classList.contains('expanded');
                
                // 收起所有其他選項
                document.querySelectorAll('.option-list-item').forEach(item => {
                    item.classList.remove('expanded');
                });
                
                // 展開當前選項
                if (!isExpanded) {
                    listItem.classList.add('expanded');
                }
            }
        }
        
        // 選擇選項的YES/NO
        function selectOptionChoice(optionIndex, choice) {
            // 檢查選項是否已Pump
            const isPumped = currentTopic.outerPools && currentTopic.outerPools[optionIndex];
            if (isPumped) {
                alert('該選項已Pump，無法在內盤下注。請到外盤進行交易。');
                return;
            }
            
            selectedMultiOption = optionIndex;
            selectedBinaryChoice = choice;
            
            // 更新選項列表中的選擇狀態
            document.querySelectorAll('.pool-choice').forEach(choiceEl => {
                choiceEl.classList.remove('selected');
            });
            
            const selectedChoice = document.querySelector(`[data-option-index="${optionIndex}"] .pool-choice.${choice}`);
            if (selectedChoice) {
                selectedChoice.classList.add('selected');
            }
            
            // 更新右側交易器
            updateRightTrader(optionIndex, choice);
        }
        
        // 更新右側交易器
        function updateRightTrader(optionIndex, choice) {
            const option = currentTopic.options[optionIndex];
            const pool = currentTopic.innerPools ? currentTopic.innerPools[optionIndex] : null;
            const yesAmount = pool ? pool.yesAmount : 0;
            const noAmount = pool ? pool.noAmount : 0;
            const totalAmount = pool ? pool.totalAmount : 0;
            
            const yesPercentage = totalAmount > 0 ? ((yesAmount / totalAmount) * 100).toFixed(1) : '50.0';
            const noPercentage = totalAmount > 0 ? ((noAmount / totalAmount) * 100).toFixed(1) : '50.0';
            
            // 檢查該選項是否已Pump
            const isPumped = currentTopic.outerPools && currentTopic.outerPools[optionIndex];
            const statusClass = isPumped ? 'pumped' : 'pk';
            const statusText = isPumped ? '已上線' : 'PK中';
            
            // 更新右側詳細界面內容
            document.getElementById('selectedOptionTitle').textContent = option;
            document.getElementById('selectedOptionStatus').className = `option-status ${statusClass}`;
            document.getElementById('selectedOptionStatus').textContent = statusText;
            document.getElementById('pumpProgress').textContent = 
                `距離上線: ${Math.max(0, currentTopic.pumpCondition - totalAmount)} $`;
            
            // 更新YES/NO數據
            document.getElementById('yesAmount').textContent = `${yesAmount} $`;
            document.getElementById('yesPercentage').textContent = `${yesPercentage}%`;
            document.getElementById('yesIndicator').style.width = `${yesPercentage}%`;
            
            document.getElementById('noAmount').textContent = `${noAmount} $`;
            document.getElementById('noPercentage').textContent = `${noPercentage}%`;
            document.getElementById('noIndicator').style.width = `${noPercentage}%`;
            
            // 更新資金池信息
            document.getElementById('optionTotalPool').textContent = `${totalAmount} $`;
            const participants = Math.floor(totalAmount / 50) + Math.floor(Math.random() * 5);
            document.getElementById('optionParticipants').textContent = `${participants} 人`;
            
            // 設置YES/NO選擇狀態
            document.querySelectorAll('#selectedOptionDetail .binary-choice').forEach(choiceEl => {
                choiceEl.classList.remove('selected');
            });
            
            if (choice === 'yes') {
                document.getElementById('yesChoice').classList.add('selected');
            } else if (choice === 'no') {
                document.getElementById('noChoice').classList.add('selected');
            }
            
            // 顯示右側詳細界面
            document.getElementById('noOptionSelected').style.display = 'none';
            document.getElementById('selectedOptionDetail').style.display = 'block';
        }

        // 重置右側交易器
        function resetRightTrader() {
            const noSelectionDiv = document.getElementById('noOptionSelected');
            const detailDiv = document.getElementById('selectedOptionDetail');
            
            if (noSelectionDiv) noSelectionDiv.style.display = 'flex';
            if (detailDiv) detailDiv.style.display = 'none';
            
            // 重置選擇狀態
            selectedMultiOption = null;
            selectedBinaryChoice = null;
        }

        // 選擇中央選項 - 顯示該選項的詳細界面
        function selectCenterOption(optionIndex) {
            selectedMultiOption = optionIndex;
            
            // 更新中央選項卡片的active狀態
            const centerCards = document.querySelectorAll('.center-option-card');
            centerCards.forEach((card, index) => {
                if (index === optionIndex) {
                    card.classList.add('active');
                } else {
                    card.classList.remove('active');
                }
            });
            
            // 顯示右側選項詳情
            showOptionDetail(optionIndex);
        }

        // 選擇多選項 - 顯示該選項的詳細界面
        function selectMultiOption(optionIndex) {
            selectedMultiOption = optionIndex;
            selectedBinaryChoice = null;
            
            // 更新選項按鈕狀態
            document.querySelectorAll('.option-item-btn').forEach((btn, index) => {
                if (index === optionIndex) {
                    btn.classList.add('active');
                } else {
                    btn.classList.remove('active');
                }
            });
            
            // 顯示詳細界面
            showOptionDetail(optionIndex);
        }

        // 顯示選項詳細界面
        function showOptionDetail(optionIndex) {
            const option = currentTopic.options[optionIndex];
            const pool = currentTopic.innerPools ? currentTopic.innerPools[optionIndex] : null;
            const yesAmount = pool ? pool.yesAmount : 0;
            const noAmount = pool ? pool.noAmount : 0;
            const totalAmount = pool ? pool.totalAmount : 0;
            
            const yesPercentage = totalAmount > 0 ? ((yesAmount / totalAmount) * 100).toFixed(1) : '50.0';
            const noPercentage = totalAmount > 0 ? ((noAmount / totalAmount) * 100).toFixed(1) : '50.0';
            
            // 檢查該選項是否已Pump
            const isPumped = currentTopic.outerPools && currentTopic.outerPools[optionIndex];
            const statusClass = isPumped ? 'pumped' : 'pk';
            const statusText = isPumped ? '已上線' : 'PK中';
            
            // 更新詳細界面內容
            document.getElementById('selectedOptionTitle').textContent = option;
            document.getElementById('selectedOptionStatus').className = `option-status ${statusClass}`;
            document.getElementById('selectedOptionStatus').textContent = statusText;
            document.getElementById('pumpProgress').textContent = 
                `距離上線: ${Math.max(0, currentTopic.pumpCondition - totalAmount)} $`;
            
            // 更新YES/NO數據
            document.getElementById('yesAmount').textContent = `${yesAmount} $`;
            document.getElementById('yesPercentage').textContent = `${yesPercentage}%`;
            document.getElementById('yesIndicator').style.width = `${yesPercentage}%`;
            
            document.getElementById('noAmount').textContent = `${noAmount} $`;
            document.getElementById('noPercentage').textContent = `${noPercentage}%`;
            document.getElementById('noIndicator').style.width = `${noPercentage}%`;
            
            // 更新資金池信息
            document.getElementById('optionTotalPool').textContent = `${totalAmount} $`;
            const participants = Math.floor(totalAmount / 50) + Math.floor(Math.random() * 5);
            document.getElementById('optionParticipants').textContent = `${participants} 人`;
            
            // 隱藏無選擇提示，顯示詳細界面
            document.getElementById('noOptionSelected').style.display = 'none';
            document.getElementById('selectedOptionDetail').style.display = 'block';
            
            // 清除選擇狀態
            document.querySelectorAll('#selectedOptionDetail .binary-choice').forEach(choice => {
                choice.classList.remove('selected');
            });
        }

        // 選擇YES/NO
        function selectOptionBinary(choice) {
            selectedBinaryChoice = choice;
            
            // 更新UI
            document.querySelectorAll('#selectedOptionDetail .binary-choice').forEach(element => {
                element.classList.remove('selected');
            });
            
            const selectedElement = document.getElementById(choice + 'Choice');
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
        }

        // 獲取多選項狀態
        function getMultiOptionStatus() {
            if (!currentTopic || !currentTopic.options || !currentTopic.outerPools) {
                return 'inner'; // 全部在PK
            }
            
            let pumpedCount = 0;
            let totalCount = currentTopic.options.length;
            
            currentTopic.outerPools.forEach(pool => {
                if (pool !== null) pumpedCount++;
            });
            
            if (pumpedCount === 0) return 'inner';  // 全部PK
            if (pumpedCount === totalCount) return 'outer'; // 全部Trade
            return 'mixed'; // 混合狀態
        }

        // 更新混合界面
        function updateMixedInterface() {
            if (!currentTopic || !currentTopic.options) return;
            
            const pkGrid = document.getElementById('mixedPkGrid');
            const tradeGrid = document.getElementById('mixedTradeGrid');
            const pkSection = document.getElementById('pkSectionMulti');
            const tradeSection = document.getElementById('tradeSectionMulti');
            
            if (!pkGrid || !tradeGrid) return;
            
            pkGrid.innerHTML = '';
            tradeGrid.innerHTML = '';
            
            let hasPkOptions = false;
            let hasTradeOptions = false;
            
            currentTopic.options.forEach((option, index) => {
                const isPumped = currentTopic.outerPools && currentTopic.outerPools[index];
                
                if (isPumped) {
                    // Trade選項
                    hasTradeOptions = true;
                    const outerPool = currentTopic.outerPools[index];
                    const yesPrice = outerPool.yesAmount / (outerPool.yesAmount + outerPool.noAmount);
                    const noPrice = 1 - yesPrice;
                    
                    const tradeCard = document.createElement('div');
                    tradeCard.className = 'lmsr-option-card';
                    tradeCard.innerHTML = `
                        <div class="option-header">
                            <div class="option-title">${option}</div>
                            <span class="option-status pumped">已Pump</span>
                        </div>
                        <div class="binary-prices">
                            <div class="price-item yes" onclick="tradeMixedOption(${index}, 'yes')">
                                <div class="price-label">YES</div>
                                <div class="price-value">${(yesPrice * 100).toFixed(1)}%</div>
                                <button class="trade-btn yes">買入</button>
                            </div>
                            <div class="price-item no" onclick="tradeMixedOption(${index}, 'no')">
                                <div class="price-label">NO</div>
                                <div class="price-value">${(noPrice * 100).toFixed(1)}%</div>
                                <button class="trade-btn no">買入</button>
                            </div>
                        </div>
                    `;
                    tradeGrid.appendChild(tradeCard);
                } else {
                    // PK選項
                    hasPkOptions = true;
                    const pool = currentTopic.innerPools ? currentTopic.innerPools[index] : null;
                    const yesAmount = pool ? pool.yesAmount : 0;
                    const noAmount = pool ? pool.noAmount : 0;
                    const totalAmount = pool ? pool.totalAmount : 0;
                    
                    const yesPercentage = totalAmount > 0 ? ((yesAmount / totalAmount) * 100).toFixed(1) : '50.0';
                    const noPercentage = totalAmount > 0 ? ((noAmount / totalAmount) * 100).toFixed(1) : '50.0';
                    
                    const pkCard = document.createElement('div');
                    pkCard.className = 'multi-option-binary-card';
                    pkCard.innerHTML = `
                        <div class="option-header">
                            <div class="option-title">${option}</div>
                            <span class="option-status pk">PK中</span>
                        </div>
                        <div class="binary-choices">
                            <div class="binary-choice yes ${selectedMultiOption === index && selectedBinaryChoice === 'yes' ? 'selected' : ''}" 
                                 onclick="selectMixedBinary(${index}, 'yes')">
                                <div class="choice-label">YES</div>
                                <div class="choice-amount">${yesAmount} $</div>
                                <div class="choice-percentage">${yesPercentage}%</div>
                                <div class="choice-indicator" style="width: ${yesPercentage}%"></div>
                            </div>
                            <div class="binary-choice no ${selectedMultiOption === index && selectedBinaryChoice === 'no' ? 'selected' : ''}" 
                                 onclick="selectMixedBinary(${index}, 'no')">
                                <div class="choice-label">NO</div>
                                <div class="choice-amount">${noAmount} $</div>
                                <div class="choice-percentage">${noPercentage}%</div>
                                <div class="choice-indicator" style="width: ${noPercentage}%"></div>
                            </div>
                        </div>
                        <div class="option-footer">
                            <span class="total-pool">總池: ${totalAmount} $</span>
                            <span class="pump-progress">距離上線: ${Math.max(0, currentTopic.pumpCondition - totalAmount)} $</span>
                        </div>
                    `;
                    pkGrid.appendChild(pkCard);
                }
            });
            
            // 顯示/隱藏相應section
            if (pkSection) pkSection.style.display = hasPkOptions ? 'block' : 'none';
            if (tradeSection) tradeSection.style.display = hasTradeOptions ? 'block' : 'none';
        }

        // 混合界面的選擇函數
        function selectMixedBinary(optionIndex, choice) {
            selectedMultiOption = optionIndex;
            selectedBinaryChoice = choice;
            
            // 更新UI
            document.querySelectorAll('#mixedPkGrid .binary-choice').forEach(element => {
                element.classList.remove('selected');
            });
            
            const selectedElement = document.querySelector(
                `#mixedPkGrid .binary-choice.${choice}[onclick*="selectMixedBinary(${optionIndex}"]`
            );
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
        }

        // 更新Trade選項界面 - 顯示中央選項卡片
        function updateTradeOptionsInterface() {
            if (!currentTopic || !currentTopic.options || !currentTopic.outerPools) return;
            
            const grid = document.getElementById('tradeOptionGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            // 只顯示已Pump的選項
            currentTopic.options.forEach((option, index) => {
                const outerPool = currentTopic.outerPools[index];
                
                if (!outerPool) return; // 跳過未Pump的選項
                
                // 計算YES和NO的價格百分比
                const totalYes = outerPool.yesAmount || 0;
                const totalNo = outerPool.noAmount || 0;
                const totalPool = totalYes + totalNo;
                
                const yesPrice = totalPool > 0 ? (totalYes / totalPool) : 0.5;
                const noPrice = totalPool > 0 ? (totalNo / totalPool) : 0.5;
                
                const card = document.createElement('div');
                card.className = 'trade-option-card';
                card.setAttribute('data-option-index', index);
                card.onclick = () => selectTradeOption(index);
                
                card.innerHTML = `
                    <div class="trade-option-header">
                        <div class="trade-option-title">${option}</div>
                        <span class="trade-option-status">已Pump</span>
                    </div>
                    <div class="trade-option-prices">
                        <div class="trade-price-item yes" onclick="selectTradeChoice(${index}, 'yes', event)">
                            <div class="trade-price-label">YES</div>
                            <div class="trade-price-value">${(yesPrice * 100).toFixed(1)}%</div>
                        </div>
                        <div class="trade-price-item no" onclick="selectTradeChoice(${index}, 'no', event)">
                            <div class="trade-price-label">NO</div>
                            <div class="trade-price-value">${(noPrice * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                    <div class="trade-option-pool">
                        總池: ${totalPool.toFixed(0)}$ | YES: ${totalYes.toFixed(0)}$ | NO: ${totalNo.toFixed(0)}$
                    </div>
                `;
                grid.appendChild(card);
            });
            
            // 默認選中第一個已Pump的選項
            const firstPumpedIndex = currentTopic.outerPools.findIndex(pool => pool !== null);
            if (firstPumpedIndex >= 0) {
                // 為混合狀態設置默認選擇
                if (currentTopic.status === 'mixed') {
                    selectedMultiOption = firstPumpedIndex;
                    selectedBinaryChoice = 'yes';
                }
                
                setTimeout(() => {
                    selectTradeOption(firstPumpedIndex);
                    selectTradeChoice(firstPumpedIndex, 'yes');
                }, 100);
            }
        }
        
        // 選擇Trade選項
        function selectTradeOption(optionIndex) {
            // 更新選項卡片選中狀態
            document.querySelectorAll('.trade-option-card').forEach(card => {
                card.classList.remove('selected');
            });
            
            const selectedCard = document.querySelector(`[data-option-index="${optionIndex}"]`);
            if (selectedCard) {
                selectedCard.classList.add('selected');
            }
        }
        
        // 選擇Trade選項的YES/NO
        function selectTradeChoice(optionIndex, choice, event) {
            if (event) event.stopPropagation(); // 防止觸發卡片點擊
            
            selectedMultiOption = optionIndex;
            selectedBinaryChoice = choice;
            
            // 更新選擇狀態
            document.querySelectorAll('.trade-price-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            const selectedItem = document.querySelector(`[data-option-index="${optionIndex}"] .trade-price-item.${choice}`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }
            
            // 選中對應的卡片
            selectTradeOption(optionIndex);
            
            // 更新右側交易器
            updateMultiLMSRInterface();
        }

        // 更新多選項Trade LMSR界面
        function updateMultiLMSRInterface() {
            if (!currentTopic || !currentTopic.options) return;
            
            const grid = document.getElementById('multiLmsrGrid');
            const sectionTitle = document.querySelector('#multiOptionOuter .section-title');
            if (!grid) return;
            
            // 檢查是否為混合狀態
            const isMixed = currentTopic.status === 'mixed';
            
            if (isMixed && selectedMultiOption !== undefined && selectedBinaryChoice) {
                // 混合狀態下，只顯示選中選項的單個交易器
                const optionIndex = selectedMultiOption;
                const choice = selectedBinaryChoice;
                const option = currentTopic.options[optionIndex];
                const outerPool = currentTopic.outerPools[optionIndex];
                
                if (outerPool) {
                    if (sectionTitle) sectionTitle.textContent = `交易: ${option} - ${choice.toUpperCase()}`;
                    
                    // 單個選項的交易界面
                    grid.innerHTML = `
                        <div class="single-option-trader">
                            <div class="option-info">
                                <h4>${option}</h4>
                                <span class="selected-choice ${choice}">${choice.toUpperCase()}</span>
                            </div>
                            <div class="trading-buttons">
                                <button class="btn btn-success" onclick="buyMultiLMSR(${optionIndex}, '${choice}')">
                                    買入 ${choice.toUpperCase()}
                                    <small class="cost-estimate" id="buyCostEstimate">預計花費: 0$</small>
                                </button>
                                <button class="btn btn-outline btn-success" onclick="sellMultiLMSR(${optionIndex}, '${choice}')">
                                    賣出 ${choice.toUpperCase()}
                                    <small class="income-estimate" id="sellIncomeEstimate">預計收入: 0$</small>
                                </button>
                            </div>
                        </div>
                    `;
                    return;
                }
            }
            
            grid.innerHTML = '';
            
            // 只顯示已Pump的選項
            currentTopic.options.forEach((option, index) => {
                const isPumped = currentTopic.outerPools && currentTopic.outerPools[index];
                
                if (!isPumped) return; // 跳過未Pump的選項
                
                const outerPool = currentTopic.outerPools[index];
                
                // 計算YES和NO的價格
                const totalYes = outerPool.yesAmount || 0;
                const totalNo = outerPool.noAmount || 0;
                const totalPool = totalYes + totalNo;
                
                const yesPrice = totalPool > 0 ? totalYes / totalPool : 0.5;
                const noPrice = totalPool > 0 ? totalNo / totalPool : 0.5;
                
                const card = document.createElement('div');
                card.className = 'lmsr-option-card';
                card.innerHTML = `
                    <div class="lmsr-option-header">
                        <div class="lmsr-option-name">${option}</div>
                        <span class="option-status pumped">已Pump</span>
                    </div>
                    <div class="binary-prices">
                        <div class="price-item yes" onclick="selectMultiLMSRChoice(${index}, 'yes')">
                            <div class="price-label">YES</div>
                            <div class="price-value">${(yesPrice * 100).toFixed(1)}%</div>
                        </div>
                        <div class="price-item no" onclick="selectMultiLMSRChoice(${index}, 'no')">
                            <div class="price-label">NO</div>
                            <div class="price-value">${(noPrice * 100).toFixed(1)}%</div>
                        </div>
                    </div>
                `;
                grid.appendChild(card);
            });
            
            // 如果沒有已Pump的選項，顯示提示
            if (grid.children.length === 0) {
                grid.innerHTML = `
                    <div class="no-pumped-options">
                        <div class="empty-state-icon">📊</div>
                        <div class="empty-state-title">暫無可交易選項</div>
                        <div class="empty-state-subtitle">該話題的選項尚未Pump到外盤</div>
                    </div>
                `;
            }
        }

        // 選擇多選項LMSR的YES/NO
        function selectMultiLMSRChoice(optionIndex, choice) {
            selectedMultiOption = optionIndex;
            selectedBinaryChoice = choice;
            
            // 更新選擇狀態
            document.querySelectorAll('.price-item').forEach(item => {
                item.classList.remove('selected');
            });
            
            const selectedItem = document.querySelector(`[onclick="selectMultiLMSRChoice(${optionIndex}, '${choice}')"]`);
            if (selectedItem) {
                selectedItem.classList.add('selected');
            }
            
            // 更新選項標題顯示
            const optionName = currentTopic.options[optionIndex];
            const choiceText = choice.toUpperCase();
            document.querySelector('#multiOptionOuter .section-title').textContent = 
                `交易: ${optionName} - ${choiceText}`;
        }

        // 多選項二元選擇變量
        let selectedMultiOption = null;
        let selectedBinaryChoice = null;

        // 選擇多選項的二元選擇
        function selectMultiBinary(optionIndex, choice) {
            selectedMultiOption = optionIndex;
            selectedBinaryChoice = choice;
            
            // 更新UI - 清除所有選擇
            document.querySelectorAll('.binary-choice').forEach(element => {
                element.classList.remove('selected');
            });
            
            // 高亮當前選擇
            const selectedElement = document.querySelector(
                `.binary-choice.${choice}[onclick*="selectMultiBinary(${optionIndex}"]`
            );
            if (selectedElement) {
                selectedElement.classList.add('selected');
            }
        }

        // 保留舊的選擇函數以兼容性
        function selectMultiOption(optionIndex) {
            selectedMultiOption = optionIndex;
            
            // 更新視覺狀態
            document.querySelectorAll('.option-card').forEach((card, index) => {
                if (index === optionIndex) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        // 多選項LMSR交易函數
        function buyMultiLMSR(optionIndex) {
            const amount = parseFloat(document.getElementById('multiLmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('請輸入有效的交易數量');
                return;
            }
            
            // 簡單的成本計算
            const cost = amount * (1 / currentTopic.options.length) * 1.05;
            
            if (cost > userBalance) {
                const shortage = cost - userBalance;
                const shouldRecharge = confirm(`💰 餘額不足，無法完成交易\n\n需要金額: ${cost.toFixed(2)} $\n當前餘額: ${userBalance.toFixed(2)} $\n不足金額: ${shortage.toFixed(2)} $\n\n是否立即充值？`);
                
                if (shouldRecharge) {
                    showRecharge();
                }
                return;
            }
            
            if (confirm(`確認買入 ${amount} 個 ${currentTopic.options[optionIndex]} 代幣？\n總花費: ${cost.toFixed(2)} $`)) {
                userBalance -= cost;
                
                // 更新持倉
                const holdingKey = `myMultiOption${optionIndex}`;
                currentTopic[holdingKey] = (currentTopic[holdingKey] || 0) + amount;
                
                updateBalanceDisplay();
                document.getElementById('multiLmsrAmount').value = '';
                // 顯示分享卡片而不是簡單的alert
                const tradeData = {
                    type: 'buy',
                    topicTitle: currentTopic.title,
                    option: currentTopic.options[optionIndex],
                    amount: amount,
                    cost: amount * (1 / currentTopic.options.length),
                    fee: 0
                };
                showShareModal(tradeData);
            }
        }

        function sellMultiLMSR(optionIndex) {
            const amount = parseFloat(document.getElementById('multiLmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('請輸入有效的交易數量');
                return;
            }
            
            const holdingKey = `myMultiOption${optionIndex}`;
            const currentHolding = currentTopic[holdingKey] || 0;
            
            if (amount > currentHolding) {
                alert(`持倉不足！您目前持有 ${currentHolding} 個 ${currentTopic.options[optionIndex]} 代幣`);
                return;
            }
            
            // 簡單的收入計算
            const revenue = amount * (1 / currentTopic.options.length) * 0.95;
            
            if (confirm(`確認賣出 ${amount} 個 ${currentTopic.options[optionIndex]} 代幣？\n預計收入: ${revenue.toFixed(2)} $`)) {
                userBalance += revenue;
                currentTopic[holdingKey] -= amount;
                
                updateBalanceDisplay();
                document.getElementById('multiLmsrAmount').value = '';
                // 顯示分享卡片而不是簡單的alert
                const tradeData = {
                    type: 'sell',
                    topicTitle: currentTopic.title,
                    option: currentTopic.options[optionIndex],
                    amount: amount,
                    cost: revenue,
                    fee: 0
                };
                showShareModal(tradeData);
            }
        }

        // 更新獎金池显示
        function updatePoolDisplay() {
            if (!currentTopic) return;

            const isOuter = currentTopic.status === 'outer';
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            
            // 更新PK交易界面的显示（只對二元選項）
            if (currentTopic.innerPool && !isMultiOption) {
                const yesAmountEl = document.getElementById('yesAmount');
                const noAmountEl = document.getElementById('noAmount');
                if (yesAmountEl) yesAmountEl.textContent = `${currentTopic.innerPool.yesAmount || 0} $`;
                if (noAmountEl) noAmountEl.textContent = `${currentTopic.innerPool.noAmount || 0} $`;
            }

            // 更新多選項PK界面數據
            if (isMultiOption && !isOuter) {
                updatePKInterface();
            }

            // 更新我的持仓
            updateMyPositions();

            // 更新中间区域的獎金池详情
            updatePoolDetailsSection();
        }

        // 更新中间区域的獎金池详情显示
        function updatePoolDetailsSection() {
            if (!currentTopic) return;

            const poolDetailsSection = document.getElementById('poolDetailsSection');
            const isOuter = currentTopic.status === 'outer';

            const outerDataExists = currentTopic.outerPool || (currentTopic.outerPools && currentTopic.outerPools.some(pool => pool !== null));
            
            if (isOuter && outerDataExists) {
                const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
                let outerPoolRowsHTML = '';
                
                if (isMultiOption && currentTopic.outerPools) {
                    // 多選項Trade資金池顯示
                    currentTopic.options.forEach((option, index) => {
                        const pool = currentTopic.outerPools[index];
                        if (pool) {
                            outerPoolRowsHTML += `
                                <div class="pool-row">
                                    <span class="pool-label">${option}獎池：</span>
                                    <span class="pool-value">${pool.totalAmount} $</span>
                                </div>
                            `;
                        }
                    });
                } else {
                    // 二元選項Trade資金池顯示
                    outerPoolRowsHTML = `
                        <div class="pool-row">
                            <span class="pool-label">YES獎池：</span>
                            <span class="pool-value">${currentTopic.outerPool.yesAmount} $</span>
                        </div>
                        <div class="pool-row">
                            <span class="pool-label">NO獎池：</span>
                            <span class="pool-value">${currentTopic.outerPool.noAmount} $</span>
                        </div>
                    `;
                }
                
                // Trade状态 - 显示市场信息和价格走势
                if (currentTopic.outerPool) {
                    // 單選項話題顯示詳細信息
                    poolDetailsSection.innerHTML = `
                            <!-- Trade信息 -->
                            <div class="pool-section">
                                <div class="pool-section-header">
                                    <span class="pool-section-title">Trade信息</span>
                                    <span class="pool-section-badge trade">LMSR</span>
                                </div>
                                <div class="pool-info">
                                    <div class="pool-row">
                                        <span class="pool-label">总流水：</span>
                                        <span class="pool-value">${currentTopic.outerPool.totalVolume || 0} $</span>
                                    </div>
                                    <div class="pool-row">
                                        <span class="pool-label">市場流動性：</span>
                                        <span class="pool-value">${currentTopic.outerPool.totalAmount} $</span>
                                    </div>
                                    <div class="pool-row">
                                        <span class="pool-label">当前YES价格：</span>
                                        <span class="pool-value" style="color: #10b981;">${((currentTopic.outerPool.yesAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount)) * 100).toFixed(1)}%</span>
                                    </div>
                                    <div class="pool-row">
                                        <span class="pool-label">当前NO价格：</span>
                                        <span class="pool-value" style="color: #ef4444;">${((currentTopic.outerPool.noAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount)) * 100).toFixed(1)}%</span>
                                    </div>
                                </div>
                            </div>

                    <!-- PK獎金池 -->
                    <div class="pool-section">
                        <div class="pool-section-header">
                            <span class="pool-section-title">PK獎金池</span>
                            <span class="pool-section-badge pumped">已Pump</span>
                        </div>
                        <div class="pool-info">
                            ${(() => {
                                if (isMultiOption) {
                                    // 多選項顯示
                                    return currentTopic.options.map((option, index) => {
                                        const amount = currentTopic.innerPool[`option${index}Amount`] || 0;
                                        return `
                                            <div class="pool-row">
                                                <span class="pool-label">原始${option}投注：</span>
                                                <span class="pool-value">${amount} $</span>
                                            </div>
                                        `;
                                    }).join('');
                                } else {
                                    // 二元選項顯示
                                    return `
                                        <div class="pool-row">
                                            <span class="pool-label">原始YES投注：</span>
                                            <span class="pool-value">${currentTopic.innerPool?.yesAmount || 0} $</span>
                                        </div>
                                        <div class="pool-row">
                                            <span class="pool-label">原始NO投注：</span>
                                            <span class="pool-value">${currentTopic.innerPool?.noAmount || 0} $</span>
                                        </div>
                                    `;
                                }
                            })()}
                            <div class="pool-row" style="color: #ef4444;">
                                <span class="pool-label">转出Trade底池：</span>
                                <span class="pool-value">-${currentTopic.outerPool.basePool} $</span>
                            </div>
                            <div class="pool-row" style="color: #10b981;">
                                <span class="pool-label">手續費回流：</span>
                                <span class="pool-value">+${currentTopic.outerPool.tradingFeeToInner || 0} $</span>
                            </div>
                            <div class="pool-row">
                                <span class="pool-label">PK当前总额：</span>
                                <span class="pool-value">${((currentTopic.innerPool?.totalAmount || 0) - currentTopic.outerPool.basePool + (currentTopic.outerPool.tradingFeeToInner || 0)).toFixed(2)} $</span>
                            </div>
                        </div>
                    </div>

                    <!-- Pump机制说明 -->
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #fbbf24;">
                        <strong>💡 Pump机制说明：</strong><br>
                        • PK达到1000U时触发Pump<br>
                        • 小方的50%转入Trade底池<br>
                        • Trade交易手續費的40%持续回流PK
                    </div>
                `;
                } else {
                    // 多選項話題的簡化顯示
                    poolDetailsSection.innerHTML = `
                        <div class="pool-details-container" style="display: block;">
                            <div class="pool-section-header">
                                <span class="pool-section-title">多選項Trade</span>
                                <span class="pool-section-badge trade">LMSR</span>
                            </div>
                            <div class="pool-info">
                                <div class="pool-row">
                                    <span class="pool-label">已Pump選項：</span>
                                    <span class="pool-value">${currentTopic.outerPools ? currentTopic.outerPools.filter(pool => pool !== null).length : 0} 個</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">總選項數：</span>
                                    <span class="pool-value">${currentTopic.options ? currentTopic.options.length : 0} 個</span>
                                </div>
                                ${outerPoolRowsHTML}
                            </div>
                        </div>
                    `;
                }
            } else {
                // PK状态 - 显示当前状态和Pump进度
                const innerTotal = currentTopic.innerPool?.totalAmount || 0;
                const isPrivate = currentTopic.isPrivate;
                const pumpThreshold = currentTopic.pumpCondition || 1000;
                
                let progressSection = '';
                let conditionSection = '';
                
                if (!isPrivate) {
                    // 非私密話題顯示Pump進度
                    const progress = Math.min(innerTotal / pumpThreshold * 100, 100);
                    const remaining = Math.max(pumpThreshold - innerTotal, 0);
                    
                    progressSection = `
                        <div class="pump-progress" style="margin: 1.5rem 0;">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%;"></div>
                            </div>
                            <div class="progress-text">
                                距离Pump还需 <strong style="color: #10b981;">${remaining}</strong> $
                            </div>
                        </div>
                    `;
                    
                    conditionSection = `
                        <!-- Pump条件说明 -->
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #60a5fa;">
                            <strong>⚡ Pump条件：</strong><br>
                            • PK獎金池达到${pumpThreshold} $时自动触发Pump<br>
                            • PK交易收取5%手續費<br>
                            • 下注金額较小一方的50%将转为Trade LMSR底池<br>
                            • 转为Trade后可在瀑布流中展示和交易
                        </div>
                        
                        <!-- 收益說明 -->
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #10b981;">
                            <strong>💰 收益機會：</strong><br>
                            • <strong>PK勝利</strong>：瓜分對方陣營的全部資金<br>
                            • <strong>Trade交易</strong>：可在LMSR市場進行價格交易獲利<br>
• <strong>手續費分紅</strong>：PK參與者享受Trade交易手續費的40%回流<br>
                            • <strong>早期參與優勢</strong>：越早參與，潛在收益倍數越高
                        </div>
                    `;
                } else {
                    // 私密話題顯示私密說明
                    conditionSection = `
                        <!-- 私密話題说明 -->
                        <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #f87171;">
                            <strong>🔒 私密話題：</strong><br>
                            • 此話題為私密話題，不會出現在瀑布流中<br>
                            • 私密話題不支援Pump功能，不會轉為Trade<br>
                            • PK交易收取5%手續費<br>
• 話題結束後直接進行PK結算
                        </div>
                    `;
                }

                const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
                let poolRowsHTML = '';
                
                if (isMultiOption) {
                    // 多選項話題顯示
                    currentTopic.options.forEach((option, index) => {
                        let amount = 0;
                        if (currentTopic.innerPools && currentTopic.innerPools[index]) {
                            amount = currentTopic.innerPools[index].totalAmount || 0;
                        } else if (currentTopic.innerPool) {
                            // 兼容舊數據結構
                            amount = currentTopic.innerPool[`option${index}Amount`] || 0;
                        }
                        poolRowsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">${option}：</span>
                                <span class="pool-value">${amount} $</span>
                            </div>
                        `;
                    });
                } else {
                    // 二元選項話題顯示
                    poolRowsHTML = `
                        <div class="pool-row">
                            <span class="pool-label">YES投注：</span>
                            <span class="pool-value">${currentTopic.innerPool?.yesAmount || 0} $</span>
                        </div>
                        <div class="pool-row">
                            <span class="pool-label">NO投注：</span>
                            <span class="pool-value">${currentTopic.innerPool?.noAmount || 0} $</span>
                        </div>
                    `;
                }

                poolDetailsSection.innerHTML = `
                                            <!-- PK獎金池 -->
                    <div class="pool-section">
                        <div class="pool-section-header">
                            <span class="pool-section-title">PK獎金池</span>
                            <span class="pool-section-badge ${isPrivate ? 'private' : ''}">${isPrivate ? '私密' : '活躍'}</span>
                        </div>
                        <div class="pool-info">
                            ${poolRowsHTML}
                            <div class="pool-row">
                                <span class="pool-label">PK獎金總額：</span>
                                <span class="pool-value">${innerTotal} $</span>
                            </div>
                        </div>
                        ${progressSection}
                    </div>
                    ${conditionSection}
                `;
            }
        }

        // 更新PK界面數據
        function updatePKInterface() {
            if (!currentTopic || !currentTopic.innerPool) return;
            
            const { yesAmount, noAmount, totalAmount } = currentTopic.innerPool;
            
            // 計算百分比
            const yesPercentage = totalAmount > 0 ? Math.round((yesAmount / totalAmount) * 100) : 0;
            const noPercentage = totalAmount > 0 ? Math.round((noAmount / totalAmount) * 100) : 0;
            
            // 模擬參與人數（實際項目中需要從後端獲取）
            const yesParticipants = Math.floor(yesAmount / 50) + Math.floor(Math.random() * 5);
            const noParticipants = Math.floor(noAmount / 50) + Math.floor(Math.random() * 5);
            
            // 更新YES陣營數據
            document.getElementById('yesAmount').textContent = `${yesAmount} $`;
            document.getElementById('yesPercentage').textContent = `${yesPercentage}%`;
            document.getElementById('yesParticipants').textContent = `${yesParticipants}人`;
            
            // 更新NO陣營數據
            document.getElementById('noAmount').textContent = `${noAmount} $`;
            document.getElementById('noPercentage').textContent = `${noPercentage}%`;
            document.getElementById('noParticipants').textContent = `${noParticipants}人`;
            
            // 更新進度指示器
            const yesIndicator = document.getElementById('yesIndicator');
            const noIndicator = document.getElementById('noIndicator');
            
            if (yesIndicator) yesIndicator.style.width = `${yesPercentage}%`;
            if (noIndicator) noIndicator.style.width = `${noPercentage}%`;
            
            // 更新選中狀態
            const yesSide = document.querySelector('.yes-side');
            const noSide = document.querySelector('.no-side');
            
            if (selectedOption === 'yes') {
                yesSide?.classList.add('selected');
                noSide?.classList.remove('selected');
            } else if (selectedOption === 'no') {
                noSide?.classList.add('selected');
                yesSide?.classList.remove('selected');
            } else {
                yesSide?.classList.remove('selected');
                noSide?.classList.remove('selected');
            }
        }

        // 更新我的持仓显示
        function updateMyPositions() {
            if (!currentTopic) return;

            const isOuter = currentTopic.status === 'outer';
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            const myInnerPositions = document.getElementById('myInnerPositions');
            const myOuterPositions = document.getElementById('myOuterPositions');

            // 更新PK持倉
            if (isMultiOption) {
                // 多選項PK持倉 - 按新的YES/NO結構顯示
                const innerPositionsContent = document.querySelector('#myInnerPositions .pool-info');
                if (innerPositionsContent) {
                    let positionsHTML = '';
                    let totalInnerValue = 0;
                    
                    currentTopic.options.forEach((option, index) => {
                        // 使用新的持倉結構 myInnerPositions[index] = [yes, no]
                        const positions = currentTopic.myInnerPositions ? currentTopic.myInnerPositions[index] : [0, 0];
                        const yesPosition = positions[0] || 0;
                        const noPosition = positions[1] || 0;
                        const optionTotal = yesPosition + noPosition;
                        
                        if (optionTotal > 0) {
                            totalInnerValue += optionTotal;
                            positionsHTML += `
                                <div class="pool-row option-position-header">
                                    <span class="pool-label">${option}：</span>
                                    <span class="pool-value">${optionTotal} $</span>
                                </div>
                            `;
                            
                            if (yesPosition > 0) {
                                positionsHTML += `
                                    <div class="pool-row sub-position">
                                        <span class="pool-label">　└ YES：</span>
                                        <span class="pool-value yes-position">${yesPosition} $</span>
                                    </div>
                                `;
                            }
                            
                            if (noPosition > 0) {
                                positionsHTML += `
                                    <div class="pool-row sub-position">
                                        <span class="pool-label">　└ NO：</span>
                                        <span class="pool-value no-position">${noPosition} $</span>
                                    </div>
                                `;
                            }
                        }
                    });
                    
                    if (totalInnerValue > 0) {
                        positionsHTML += `
                            <div class="pool-row total-row">
                                <span class="pool-label">總計：</span>
                                <span class="pool-value">${totalInnerValue} $</span>
                            </div>
                        `;
                    } else {
                        positionsHTML = `
                            <div class="pool-row" style="text-align: center; color: #9ca3af; padding: 1rem;">
                                <span>暂无PK持仓</span>
                            </div>
                        `;
                    }
                    
                    innerPositionsContent.innerHTML = positionsHTML;
                }
            } else {
                // 二元選項PK持倉
                const myInnerYes = currentTopic.myInnerYes || 0;
                const myInnerNo = currentTopic.myInnerNo || 0;
                
                // 动态生成PK持仓显示
                const innerPositionsContent = document.querySelector('#myInnerPositions .pool-info');
                if (innerPositionsContent) {
                    let positionsHTML = '';
                    let totalValue = 0;
                    
                    // 只显示有持仓的选项
                    if (myInnerYes > 0) {
                        totalValue += myInnerYes;
                        positionsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">YES持仓：</span>
                                <span class="pool-value">${myInnerYes} $</span>
                            </div>
                        `;
                    }
                    
                    if (myInnerNo > 0) {
                        totalValue += myInnerNo;
                        positionsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">NO持仓：</span>
                                <span class="pool-value">${myInnerNo} $</span>
                            </div>
                        `;
                    }
                    
                    // 如果有任何持仓，显示总计
                    if (myInnerYes > 0 || myInnerNo > 0) {
                        positionsHTML += `
                            <div class="pool-row" style="border-top: 1px solid #374151; margin-top: 0.5rem; padding-top: 0.5rem; font-weight: 700;">
                                <span class="pool-label">總計：</span>
                                <span class="pool-value">${totalValue} $</span>
                            </div>
                        `;
                    } else {
                        // 如果没有持仓，显示提示信息
                        positionsHTML = `
                            <div class="pool-row" style="text-align: center; color: #9ca3af; padding: 1rem;">
                                <span>暂无PK持仓</span>
                            </div>
                        `;
                    }
                    
                    innerPositionsContent.innerHTML = positionsHTML;
                }
            }

            // 根据状态显示/隐藏Trade持倉
            if (isOuter && currentTopic.outerPool) {
                myOuterPositions.style.display = 'block';
                
                if (isMultiOption) {
                    // 多選項Trade持倉 - 動態生成內容
                    const outerPositionsContent = document.querySelector('#myOuterPositions .pool-info');
                    if (outerPositionsContent) {
                        let positionsHTML = '';
                        let totalOuterValue = 0;
                        
                        currentTopic.options.forEach((option, index) => {
                            const tokens = currentTopic[`myOuterOption${index}`] || 0;
                            // 簡化的價格計算（基於份額比例）
                            const optionAmount = currentTopic.outerPool[`option${index}Amount`] || 0;
                            const price = currentTopic.outerPool.totalAmount > 0 ? 
                                optionAmount / currentTopic.outerPool.totalAmount : 0;
                            const value = tokens * price;
                            totalOuterValue += value;
                            
                            positionsHTML += `
                                <div class="pool-row">
                                    <span class="pool-label">${option}代幣：</span>
                                    <span class="pool-value">${tokens} 個</span>
                                </div>
                            `;
                        });
                        
                        positionsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">估值：</span>
                                <span class="pool-value">${totalOuterValue.toFixed(2)} $</span>
                            </div>
                        `;
                        
                        outerPositionsContent.innerHTML = positionsHTML;
                    }
                } else {
                    // 二元選項Trade持倉
                    const myOuterYes = currentTopic.myOuterYes || 0;
                    const myOuterNo = currentTopic.myOuterNo || 0;
                    const myOuterYesAvgPrice = currentTopic.myOuterYesAvgPrice || 0;
                    const myOuterNoAvgPrice = currentTopic.myOuterNoAvgPrice || 0;
                    
                    // 动态生成持仓显示
                    const outerPositionsContent = document.querySelector('#myOuterPositions .pool-info');
                    if (outerPositionsContent) {
                        let positionsHTML = '';
                        let totalValue = 0;
                        
                        // 计算当前价格
                        const yesCurrentPrice = currentTopic.outerPool.totalAmount > 0 ? 
                            currentTopic.outerPool.yesAmount / currentTopic.outerPool.totalAmount : 0;
                        const noCurrentPrice = currentTopic.outerPool.totalAmount > 0 ? 
                            currentTopic.outerPool.noAmount / currentTopic.outerPool.totalAmount : 0;
                        
                        // 只显示有持仓的代币
                        if (myOuterYes > 0) {
                            const yesValue = (myOuterYes * yesCurrentPrice);
                            totalValue += yesValue;
                            positionsHTML += `
                                <div class="pool-row">
                                    <span class="pool-label">YES代幣：</span>
                                    <span class="pool-value">${myOuterYes} 个</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">平均購買價格：</span>
                                    <span class="pool-value">${(myOuterYesAvgPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">當前價格：</span>
                                    <span class="pool-value">${(yesCurrentPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">當前估值：</span>
                                    <span class="pool-value">${yesValue.toFixed(2)} $</span>
                                </div>
                            `;
                        }
                        
                        if (myOuterNo > 0) {
                            const noValue = (myOuterNo * noCurrentPrice);
                            totalValue += noValue;
                            
                            // 如果有YES持仓，添加分隔线
                            if (myOuterYes > 0) {
                                positionsHTML += `<div class="pool-row" style="border-top: 1px solid #374151; margin-top: 0.5rem; padding-top: 0.5rem;">`;
                            } else {
                                positionsHTML += `<div class="pool-row">`;
                            }
                            
                            positionsHTML += `
                                    <span class="pool-label">NO代幣：</span>
                                    <span class="pool-value">${myOuterNo} 个</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">平均購買價格：</span>
                                    <span class="pool-value">${(myOuterNoAvgPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">當前價格：</span>
                                    <span class="pool-value">${(noCurrentPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">當前估值：</span>
                                    <span class="pool-value">${noValue.toFixed(2)} $</span>
                                </div>
                            `;
                        }
                        
                        // 如果有任何持仓，显示总估值
                        if (myOuterYes > 0 || myOuterNo > 0) {
                            positionsHTML += `
                                <div class="pool-row" style="border-top: 1px solid #374151; margin-top: 0.5rem; padding-top: 0.5rem; font-weight: 700;">
                                    <span class="pool-label">總估值：</span>
                                    <span class="pool-value">${totalValue.toFixed(2)} $</span>
                                </div>
                            `;
                        } else {
                            // 如果没有持仓，显示提示信息
                            positionsHTML = `
                                <div class="pool-row" style="text-align: center; color: #9ca3af; padding: 1rem;">
                                    <span>暂无Trade持仓</span>
                                </div>
                            `;
                        }
                        
                        outerPositionsContent.innerHTML = positionsHTML;
                    }
                }
            } else {
                myOuterPositions.style.display = 'none';
            }
        }

        // 選擇下注選項
        function selectOption(option) {
            selectedOption = option;
            document.querySelectorAll('.bet-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.bet-option.${option}`).classList.add('selected');
        }

        // 下注
        function placeBet() {
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            
            if (isMultiOption) {
                // 多選項邏輯
                if (selectedMultiOption === null) {
                    alert('請先選擇一個選項');
                    return;
                }

                const amount = parseInt(document.getElementById('multiOptionAmount').value);
                if (!amount || amount <= 0) {
                    alert('請輸入有效的下注金額');
                    return;
                }

                // 计算手续费和净下注额
                const fee = amount * 0.05;
                const netAmount = amount - fee;
                
                // 计算当前选项的支持比例
                const selectedPool = currentTopic.innerPools ? currentTopic.innerPools[selectedMultiOption] : null;
                const totalPool = selectedPool ? selectedPool.totalAmount : 0;
                const optionAmount = selectedBinaryChoice === 'yes' ? 
                    (selectedPool ? selectedPool.yesAmount : 0) : 
                    (selectedPool ? selectedPool.noAmount : 0);
                const supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '50.0';
                
                // 显示確認模态框
                const choiceText = selectedBinaryChoice ? selectedBinaryChoice.toUpperCase() : 'YES';
                document.getElementById('confirmOption').innerHTML = `${currentTopic.options[selectedMultiOption]} - ${choiceText} <span id="confirmRatio">(${supportRatio}%)</span>`;
                document.getElementById('confirmNetAmount').textContent = `${netAmount.toFixed(2)} $`;
                document.getElementById('confirmFee').textContent = `${fee.toFixed(2)} $ (5%)`;
                document.getElementById('confirmTotalPool').textContent = `${totalPool.toFixed(2)} $`;
                document.getElementById('confirmModal').classList.add('active');
            } else {
                // 二元選項邏輯
                if (!selectedOption) {
                    alert('请先選擇YES或NO');
                    return;
                }

                const amount = parseInt(document.getElementById('betAmount').value);
                if (!amount || amount <= 0) {
                    alert('請輸入有效的下注金額');
                    return;
                }

                // 计算手续费和净下注额
                const fee = amount * 0.05;
                const netAmount = amount - fee;
                
                // 计算当前选项的支持比例
                const totalPool = currentTopic.innerPool?.totalAmount || 0;
                const optionAmount = selectedOption === 'yes' ? 
                    (currentTopic.innerPool?.yesAmount || 0) : 
                    (currentTopic.innerPool?.noAmount || 0);
                const supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '0.0';
                
                // 显示確認模态框
                document.getElementById('confirmOption').innerHTML = `${selectedOption.toUpperCase()} <span id="confirmRatio">(${supportRatio}%)</span>`;
                document.getElementById('confirmNetAmount').textContent = `${netAmount.toFixed(2)} $`;
                document.getElementById('confirmFee').textContent = `${fee.toFixed(2)} $ (5%)`;
                document.getElementById('confirmTotalPool').textContent = `${totalPool.toFixed(2)} $`;
                document.getElementById('confirmModal').classList.add('active');
            }
        }



        // 確認下注
        function confirmBet() {
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            const inputAmount = parseInt(document.getElementById(isMultiOption ? 'multiOptionAmount' : 'betAmount').value);
            
            // 檢查餘額
            if (inputAmount > userBalance) {
                const shortage = inputAmount - userBalance;
                const shouldRecharge = confirm(`💰 餘額不足，無法完成交易\n\n需要金額: ${inputAmount} $\n當前餘額: ${userBalance} $\n不足金額: ${shortage} $\n\n是否立即充值？`);
                
                if (shouldRecharge) {
                    showRecharge();
                } else {
                    checkInnerBalance(); // 顯示充值按鈕
                }
                return;
            }
            
            // 計算5%手續費
            const fee = inputAmount * 0.05;
            const netAmount = inputAmount - fee;
            
            // 扣除餘額
            userBalance -= inputAmount;
            
            // 确保PK数据结构存在并更新数据
            if (isMultiOption) {
                // 多选项逻辑 - 使用新的独立YES/NO池结构
                if (!currentTopic.innerPools) {
                    currentTopic.innerPools = [];
                    for (let i = 0; i < currentTopic.options.length; i++) {
                        currentTopic.innerPools[i] = { yesAmount: 0, noAmount: 0, totalAmount: 0 };
                    }
                }
                
                if (!currentTopic.myInnerPositions) {
                    currentTopic.myInnerPositions = [];
                    for (let i = 0; i < currentTopic.options.length; i++) {
                        currentTopic.myInnerPositions[i] = [0, 0]; // [yes, no]
                    }
                }
                
                // 更新选中选项的资金池
                const selectedPool = currentTopic.innerPools[selectedMultiOption];
                if (selectedBinaryChoice === 'yes') {
                    selectedPool.yesAmount += netAmount;
                    currentTopic.myInnerPositions[selectedMultiOption][0] += netAmount;
                } else {
                    selectedPool.noAmount += netAmount;
                    currentTopic.myInnerPositions[selectedMultiOption][1] += netAmount;
                }
                selectedPool.totalAmount += netAmount;
            } else {
                // 二元选项逻辑
                if (!currentTopic.innerPool) {
                    currentTopic.innerPool = { yesAmount: 0, noAmount: 0, totalAmount: 0 };
                }
                
                if (selectedOption === 'yes') {
                    currentTopic.innerPool.yesAmount += netAmount;
                    currentTopic.myInnerYes = (currentTopic.myInnerYes || 0) + netAmount;
                } else {
                    currentTopic.innerPool.noAmount += netAmount;
                    currentTopic.myInnerNo = (currentTopic.myInnerNo || 0) + netAmount;
                }
                currentTopic.innerPool.totalAmount += netAmount;
            }

            // 更新sampleTopics中的数据
            const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
            if (topicIndex !== -1) {
                sampleTopics[topicIndex] = {...currentTopic};
            }

            // 检查是否触发Pump
            if (isMultiOption) {
                // 多选项：检查当前选项是否达到Pump条件
                const pumpThreshold = currentTopic.pumpCondition || 1000;
                const selectedPool = currentTopic.innerPools[selectedMultiOption];
                
                if (selectedPool.totalAmount >= pumpThreshold && 
                    currentTopic.status !== 'ended' && 
                    !currentTopic.isPrivate) {
                    triggerMultiOptionPump(selectedMultiOption);
                } else {
                    updateTradingInterface();
                }
            } else {
                // 二元选项：原逻辑
                const pumpThreshold = currentTopic.pumpCondition || 1000;
                if (currentTopic.innerPool.totalAmount >= pumpThreshold && 
                    currentTopic.status === 'inner' && 
                    !currentTopic.isPrivate) {
                    triggerPump();
                } else {
                    updateTradingInterface();
                }
            }

            updatePoolDisplay();
            closeModal();
            
            // 计算下注选项的支持比例并显示成功弹窗
            let totalPool, optionAmount, optionText, supportRatio;
            
            if (isMultiOption) {
                const selectedPool = currentTopic.innerPools[selectedMultiOption];
                totalPool = selectedPool.totalAmount;
                optionAmount = selectedBinaryChoice === 'yes' ? selectedPool.yesAmount : selectedPool.noAmount;
                optionText = `${currentTopic.options[selectedMultiOption]} - ${selectedBinaryChoice.toUpperCase()}`;
                supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '50.0';
            } else {
                totalPool = currentTopic.innerPool.totalAmount;
                optionAmount = selectedOption === 'yes' ? currentTopic.innerPool.yesAmount : currentTopic.innerPool.noAmount;
                optionText = selectedOption.toUpperCase();
                supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '0.0';
            }
            
            // 显示成功弹窗
            document.getElementById('successOption').innerHTML = `${optionText} <span id="successRatio">(${supportRatio}%)</span>`;
            document.getElementById('successNetAmount').textContent = `${netAmount.toFixed(2)} $`;
            document.getElementById('successFee').textContent = `${fee.toFixed(2)} $`;
            document.getElementById('successTotalPool').textContent = `${totalPool.toFixed(2)} $`;
            document.getElementById('successModal').classList.add('active');
            
            // 計算PK下注的潛在收益
            let potentialProfit = 0;
            if (totalPool > 0) {
                // 如果用戶選擇的選項獲勝，潛在收益 = 總獎池 * (1 - 支持比例)
                const winProbability = 1 - (optionAmount / totalPool);
                potentialProfit = totalPool * winProbability * 0.95; // 扣除5%手續費
            }
            
            // 顯示分享卡片
            const tradeData = {
                type: 'bet',
                topicTitle: currentTopic.title,
                option: optionText,
                amount: netAmount,
                cost: inputAmount,
                fee: fee,
                supportRatio: supportRatio,
                totalPool: totalPool,
                potentialProfit: potentialProfit
            };
            showShareModal(tradeData);
            
            // 更新餘額顯示
            updateBalanceDisplay();
            
            // 清空輸入
            if (isMultiOption) {
                document.getElementById('multiOptionAmount').value = '';
                selectedMultiOption = null;
                document.querySelectorAll('.option-card').forEach(el => {
                    el.classList.remove('selected');
                });
            } else {
                document.getElementById('betAmount').value = '';
                selectedOption = null;
                document.querySelectorAll('.bet-option').forEach(el => {
                    el.classList.remove('selected');
                });
            }
        }

        // 触发Pump机制
        function triggerPump() {
            const inner = currentTopic.innerPool;
            
            // 找出下注金額较小的一方
            const smallerSide = inner.yesAmount < inner.noAmount ? 'yes' : 'no';
            const smallerAmount = Math.min(inner.yesAmount, inner.noAmount);
            
            // 小方的50%作为Trade底池
            const basePool = smallerAmount * 0.5;
            
            // 根据PK獎金比例设置初始虚拟流动性
            const yesRatio = inner.yesAmount / inner.totalAmount;
            const noRatio = inner.noAmount / inner.totalAmount;
            
            // 创建Trade数据结构
            currentTopic.outerPool = {
                basePool: basePool,
                yesAmount: yesRatio * basePool * 2, // 初始虚拟流动性
                noAmount: noRatio * basePool * 2,
                totalAmount: basePool * 2,
                tradingFeeToInner: 0
            };
            
            // 更新状态
            currentTopic.status = 'outer';
            currentTopic.isOuter = true;
            
            // 更新sampleTopics中的数据
            const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
            if (topicIndex !== -1) {
                sampleTopics[topicIndex] = {...currentTopic};
            }
            
            // 更新交易界面
            updateTradingInterface();
            
            // 显示Pump通知
            setTimeout(() => {
                document.getElementById('pumpModal').classList.add('active');
            }, 500);
        }

        // 触发多选项Pump机制（单个选项）
        function triggerMultiOptionPump(optionIndex) {
            if (!currentTopic || !currentTopic.innerPools) return;
            
            const option = currentTopic.options[optionIndex];
            const innerPool = currentTopic.innerPools[optionIndex];
            
            // 找出下注金額較小的一方
            const smallerAmount = Math.min(innerPool.yesAmount, innerPool.noAmount);
            const basePool = smallerAmount * 0.5;
            
            // 根据PK獎金比例设置初始虚拟流动性
            const yesRatio = innerPool.yesAmount / innerPool.totalAmount;
            const noRatio = innerPool.noAmount / innerPool.totalAmount;
            
            // 初始化外盘池数组（如果不存在）
            if (!currentTopic.outerPools) {
                currentTopic.outerPools = new Array(currentTopic.options.length).fill(null);
            }
            
            // 为该选项创建外盘流动性
            currentTopic.outerPools[optionIndex] = {
                basePool: basePool,
                yesAmount: yesRatio * basePool * 2,
                noAmount: noRatio * basePool * 2,
                totalAmount: basePool * 2,
                tradingFeeToInner: 0
            };
            
            // 如果有任何选项已Pump，更新话题状态
            const hasAnyPumped = currentTopic.outerPools.some(pool => pool !== null);
            if (hasAnyPumped) {
                const allPumped = currentTopic.outerPools.every(pool => pool !== null);
                currentTopic.status = allPumped ? 'outer' : 'mixed'; // 全部Pump为outer，部分Pump为mixed
            }
            
            // 更新sampleTopics中的数据
            const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
            if (topicIndex !== -1) {
                sampleTopics[topicIndex] = {...currentTopic};
            }
            
            // 更新交易界面
            updateTradingInterface();
            
            // 显示选项Pump成功提示
            setTimeout(() => {
                alert(`🎉 "${option}"已成功上线到Trade市场！\n\n您可以：\n• 继续在其他选项进行PK\n• 在Trade市场进行LMSR交易`);
            }, 500);
        }

        // 关闭模态框
        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        function closePumpModal() {
            document.getElementById('pumpModal').classList.remove('active');
            // 切换到Trade交易界面
            document.getElementById('innerTrading').style.display = 'none';
            document.getElementById('outerTrading').style.display = 'block';
            document.getElementById('tradingTitle').textContent = 'LMSR交易';
            document.getElementById('tradingSubtitle').textContent = '基于市场價格交易';
        }

        // 分享卡片相關函數
        function showShareModal(tradeData) {
            const modal = document.getElementById('shareModal');
            const summaryDiv = document.getElementById('tradeSummary');
            
            // 生成交易摘要HTML
            let summaryHTML = '';
            
            // 添加話題信息
            summaryHTML += `
                <div class="trade-row">
                    <span class="trade-label">📊 交易話題</span>
                    <span class="trade-value">${tradeData.topicTitle}</span>
                </div>
            `;
            
            // 添加交易類型和選項
            let typeLabel = '';
            if (tradeData.type === 'buy') {
                typeLabel = '📈 買入';
            } else if (tradeData.type === 'sell') {
                typeLabel = '📉 賣出';
            } else if (tradeData.type === 'bet') {
                typeLabel = '🎯 下注';
            }
            
            summaryHTML += `
                <div class="trade-row">
                    <span class="trade-label">${typeLabel}</span>
                    <span class="trade-value trade-highlight">${tradeData.option}</span>
                </div>
            `;
            
            // 添加交易數量/下注金額
            const amountLabel = tradeData.type === 'bet' ? '💰 下注金額' : '💎 交易數量';
            const amountValue = tradeData.type === 'bet' ? `$${tradeData.cost.toFixed(2)}` : `${tradeData.amount} 份`;
            summaryHTML += `
                <div class="trade-row">
                    <span class="trade-label">${amountLabel}</span>
                    <span class="trade-value">${amountValue}</span>
                </div>
            `;
            
            // 添加價格信息或總獎池
            if (tradeData.type === 'bet' && tradeData.totalPool) {
                summaryHTML += `
                    <div class="trade-row">
                        <span class="trade-label">🏆 總獎池</span>
                        <span class="trade-value">$${tradeData.totalPool.toFixed(2)}</span>
                    </div>
                `;
            } else if (tradeData.averagePrice) {
                summaryHTML += `
                    <div class="trade-row">
                        <span class="trade-label">💰 平均價格</span>
                        <span class="trade-value">${(tradeData.averagePrice * 100).toFixed(1)}%</span>
                    </div>
                `;
            }
            
            // 添加成本/收入或支持比例
            if (tradeData.type === 'bet' && tradeData.supportRatio) {
                summaryHTML += `
                    <div class="trade-row">
                        <span class="trade-label">📊 支持比例</span>
                        <span class="trade-value trade-highlight">${tradeData.supportRatio}%</span>
                    </div>
                `;
            } else {
                summaryHTML += `
                    <div class="trade-row">
                        <span class="trade-label">${tradeData.type === 'buy' ? '💸 總花費' : '💵 總收入'}</span>
                        <span class="trade-value">$${tradeData.cost.toFixed(2)}</span>
                    </div>
                `;
            }
            
            // 手續費不顯示在分享卡片中
            
            // 添加潛在收益（買入或PK下注時顯示）
            if ((tradeData.type === 'buy' || tradeData.type === 'bet') && tradeData.potentialProfit) {
                summaryHTML += `
                    <div class="trade-row">
                        <span class="trade-label">🎯 潛在收益</span>
                        <span class="trade-value">
                            $${tradeData.potentialProfit.toFixed(2)}
                            <span class="profit-indicator">
                                📈 +${((tradeData.potentialProfit / tradeData.cost) * 100).toFixed(1)}%
                            </span>
                        </span>
                    </div>
                `;
            }
            
            summaryDiv.innerHTML = summaryHTML;
            modal.classList.add('show');
            
            // 自動隱藏慶祝表情符號
            setTimeout(() => {
                const emojis = modal.querySelectorAll('.celebration-emoji');
                emojis.forEach(emoji => {
                    emoji.style.opacity = '0.3';
                });
            }, 3000);
        }

        function closeShareModal() {
            const modal = document.getElementById('shareModal');
            modal.classList.remove('show');
        }

        // 監聽鍵盤事件以便用ESC關閉分享卡片
        document.addEventListener('keydown', function(event) {
            if (event.key === 'Escape') {
                const shareModal = document.getElementById('shareModal');
                if (shareModal.classList.contains('show')) {
                    closeShareModal();
                }
            }
        });

        // 點擊模態框背景關閉
        document.addEventListener('click', function(event) {
            const shareModal = document.getElementById('shareModal');
            if (event.target === shareModal) {
                closeShareModal();
            }
        });

        function shareToSocial(platform) {
            const tradeText = generateShareText();
            const url = window.location.href;
            
            let shareUrl = '';
            
            switch(platform) {
                case 'twitter':
                    shareUrl = `https://twitter.com/intent/tweet?text=${encodeURIComponent(tradeText)}&url=${encodeURIComponent(url)}`;
                    break;
                case 'facebook':
                    shareUrl = `https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(url)}&quote=${encodeURIComponent(tradeText)}`;
                    break;
            }
            
            if (shareUrl) {
                window.open(shareUrl, '_blank', 'width=600,height=400');
            }
        }

        function generateShareText() {
            const summaryDiv = document.getElementById('tradeSummary');
            const rows = summaryDiv.querySelectorAll('.trade-row');
            
            // 根據交易類型生成不同的開頭
            const tradeTypeRow = Array.from(rows).find(row => 
                row.querySelector('.trade-label').textContent.includes('買入') || 
                row.querySelector('.trade-label').textContent.includes('賣出') ||
                row.querySelector('.trade-label').textContent.includes('下注')
            );
            
            let text = '';
            if (tradeTypeRow) {
                const labelText = tradeTypeRow.querySelector('.trade-label').textContent;
                if (labelText.includes('買入')) {
                    text = '🚀 剛在 BitX 完成一筆看漲交易！市場洞察力 MAX！\\n\\n';
                } else if (labelText.includes('賣出')) {
                    text = '💰 在 BitX 成功獲利出場！時機把握完美！\\n\\n';
                } else if (labelText.includes('下注')) {
                    text = '🎯 在 BitX 完成精彩下注！預測能力超強！\\n\\n';
                }
            }
            
            rows.forEach(row => {
                const label = row.querySelector('.trade-label').textContent;
                const value = row.querySelector('.trade-value').textContent;
                text += `${label}: ${value}\\n`;
            });
            
            // 添加更吸引人的結尾
            const endings = [
                '\\n🔥 預測市場就是這麼刺激！你也來試試？',
                '\\n💎 每一次交易都是對未來的投票！',
                '\\n⚡ 在 BitX，人人都可以是預言家！',
                '\\n🎯 精準預測，豐厚回報！加入我們吧！'
            ];
            
            const randomEnding = endings[Math.floor(Math.random() * endings.length)];
            text += randomEnding;
            text += '\\n\\n#BitX #預測市場 #區塊鏈交易 #投資智慧';
            
            return text;
        }

        function copyShareLink() {
            const shareText = generateShareText();
            const fullText = shareText + '\\n\\n🔗 ' + window.location.href;
            
            navigator.clipboard.writeText(fullText).then(() => {
                // 臨時更改按鈕文字以提供反饋
                const btn = event.target;
                const originalText = btn.innerHTML;
                btn.innerHTML = '✅ 已複製！';
                btn.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                
                setTimeout(() => {
                    btn.innerHTML = originalText;
                    btn.style.background = '';
                }, 2000);
            }).catch(() => {
                alert('複製失敗，請手動複製分享內容');
            });
        }

        function downloadShareCard() {
            // 使用 html2canvas 將分享卡片轉換為圖片
            // 這裡提供一個簡化版本，實際應用中可以使用更專業的圖片生成庫
            
            const card = document.querySelector('.share-card');
            const originalBg = card.style.background;
            
            // 臨時隱藏關閉按鈕以便截圖
            const closeBtn = card.querySelector('.share-close-btn');
            closeBtn.style.display = 'none';
            
            // 創建一個臨時的 canvas 來繪製卡片
            // 注意：這是一個簡化實現，實際項目中建議使用 html2canvas 庫
            
            // 恢復按鈕顯示
            setTimeout(() => {
                closeBtn.style.display = 'flex';
            }, 100);
            
            // 提示用戶
            alert('📸 截圖功能開發中...\\n\\n您可以使用瀏覽器的截圖功能來保存分享卡片！\\n\\n💡 建議：\\n1. 右鍵點擊 -> 檢查元素\\n2. 找到分享卡片元素\\n3. 右鍵 -> 截圖節點');
        }

        // 分享連結
        function shareLink() {
            const url = `${window.location.origin}${window.location.pathname}?topic=${currentTopic.id}`;
            navigator.clipboard.writeText(url).then(() => {
                alert('分享連結已复制到剪贴板！');
            });
        }

        // 自定义选项管理
        // 切換選項類型
        function toggleOptionType() {
            const optionType = document.querySelector('input[name="optionType"]:checked').value;
            const customOptions = document.getElementById('customOptions');
            
            if (optionType === 'custom') {
                customOptions.style.display = 'block';
                // 初始化2個默認選項
                if (document.getElementById('optionsList').children.length === 0) {
                    addOption();
                    addOption();
                }
            } else {
                customOptions.style.display = 'none';
                // 清空自定義選項
                document.getElementById('optionsList').innerHTML = '';
            }
        }

        function addOption() {
            const optionsList = document.getElementById('optionsList');
            const currentCount = optionsList.children.length;
            
            // 最多8個選項
            if (currentCount >= 8) {
                alert('最多只能添加8個選項');
                return;
            }
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-input';
            optionDiv.innerHTML = `
                <span class="option-number">選項 ${currentCount + 1}:</span>
                <input type="text" class="form-input" name="customOption${currentCount + 1}" placeholder="輸入選項名稱" required>
                <button type="button" class="btn btn-secondary btn-sm" onclick="removeOption(this)">刪除</button>
            `;
            optionsList.appendChild(optionDiv);
            
            updateRemoveButtons();
        }

        function removeOption(button) {
            const optionsList = document.getElementById('optionsList');
            const currentCount = optionsList.children.length;
            
            // 至少保留2個選項
            if (currentCount <= 2) {
                alert('至少需要保留2個選項');
                return;
            }
            
            button.parentElement.remove();
            updateOptionNumbers();
            updateRemoveButtons();
        }

        function updateOptionNumbers() {
            const optionsList = document.getElementById('optionsList');
            const options = optionsList.children;
            
            for (let i = 0; i < options.length; i++) {
                const numberSpan = options[i].querySelector('.option-number');
                const input = options[i].querySelector('input');
                numberSpan.textContent = `選項 ${i + 1}:`;
                input.name = `customOption${i + 1}`;
            }
        }

        function updateRemoveButtons() {
            const optionsList = document.getElementById('optionsList');
            const removeButtons = optionsList.querySelectorAll('.btn-secondary');
            const currentCount = optionsList.children.length;
            
            // 當只有2個選項時禁用刪除按鈕
            removeButtons.forEach(button => {
                if (currentCount <= 2) {
                    button.disabled = true;
                    button.style.opacity = '0.5';
                } else {
                    button.disabled = false;
                    button.style.opacity = '1';
                }
            });
        }

        // 切換Pump設定的可用性
        function togglePumpSettings() {
            const isPrivate = document.getElementById('isPrivate').checked;
            const pumpSection = document.getElementById('pumpSection');
            
            if (isPrivate) {
                pumpSection.classList.add('disabled');
                // 禁用Pump設定中的輸入
                const pumpInput = document.querySelector('input[name="pumpCondition"]');
                if (pumpInput) pumpInput.disabled = true;
            } else {
                pumpSection.classList.remove('disabled');
                // 啟用Pump設定中的輸入
                const pumpInput = document.querySelector('input[name="pumpCondition"]');
                if (pumpInput) pumpInput.disabled = false;
            }
        }

        // 切換高級設定的顯示
        function toggleAdvancedSettings() {
            const showAdvanced = document.getElementById('showAdvanced').checked;
            const advancedSettings = document.getElementById('advancedSettings');
            
            if (showAdvanced) {
                advancedSettings.style.display = 'block';
            } else {
                advancedSettings.style.display = 'none';
                // 清空高級設定的值
                const outerTradingEndTime = document.querySelector('input[name="outerTradingEndTime"]');
                if (outerTradingEndTime) outerTradingEndTime.value = '';
            }
        }

        // 當話題結束時間改變時，更新Trade交易結束時間的默認值
        function updateAdvancedSettings() {
            const topicEndTime = document.querySelector('input[name="topicEndTime"]').value;
            const outerTradingEndTime = document.querySelector('input[name="outerTradingEndTime"]');
            
            if (outerTradingEndTime && !outerTradingEndTime.value) {
                outerTradingEndTime.value = topicEndTime;
            }
        }

        // K線圖相關功能
        let currentTimeframe = '1m';
        let klineData = [];
        let priceData = [];
        let chartInterval = null;

        // 初始化價格走勢圖
        function initKlineChart() {
            if (!currentTopic || currentTopic.status !== 'outer') return;
            
            // 生成模擬價格數據
            generatePriceData();
            renderPriceChart();
            
            // 啟動實時更新
            if (chartInterval) clearInterval(chartInterval);
            chartInterval = setInterval(() => {
                updatePriceData();
                renderPriceChart();
            }, 3000); // 每3秒更新一次
        }

        // 生成模擬價格數據
        function generatePriceData() {
            // 處理多選項話題的價格數據生成
            let yesAmount = 0, noAmount = 0;
            
            if (currentTopic.outerPool) {
                // 單選項話題
                yesAmount = currentTopic.outerPool.yesAmount;
                noAmount = currentTopic.outerPool.noAmount;
            } else if (currentTopic.outerPools) {
                // 多選項話題 - 使用第一個已Pump的選項
                const firstPumpedPool = currentTopic.outerPools.find(pool => pool !== null);
                if (firstPumpedPool) {
                    yesAmount = firstPumpedPool.yesAmount;
                    noAmount = firstPumpedPool.noAmount;
                } else {
                    // 如果沒有已Pump的選項，使用默認值
                    yesAmount = 500;
                    noAmount = 500;
                }
            } else {
                // 默認值
                yesAmount = 500;
                noAmount = 500;
            }
            
            const totalAmount = yesAmount + noAmount;
            const baseYesPrice = totalAmount > 0 ? yesAmount / totalAmount : 0.5;
            const baseNoPrice = 1 - baseYesPrice;
            
            priceData = [];
            const now = Date.now();
            const pointCount = 20; // 顯示20個價格點
            
            for (let i = pointCount - 1; i >= 0; i--) {
                const timestamp = now - i * 30000; // 每30秒一個價格點
                const yesVariation = (Math.random() - 0.5) * 0.08; // ±4%變動
                const noVariation = (Math.random() - 0.5) * 0.08;
                
                const yesPrice = Math.max(0.1, Math.min(0.9, baseYesPrice + yesVariation));
                const noPrice = Math.max(0.1, Math.min(0.9, baseNoPrice + noVariation));
                
                priceData.push({
                    timestamp,
                    yesPrice: Math.max(0.1, Math.min(0.9, yesPrice)),
                    noPrice: Math.max(0.1, Math.min(0.9, noPrice))
                });
            }
        }

        // 更新價格數據
        function updatePriceData() {
            if (priceData.length === 0) return;
            
            const lastPoint = priceData[priceData.length - 1];
            const yesVariation = (Math.random() - 0.5) * 0.01; // ±0.5%變動
            const noVariation = (Math.random() - 0.5) * 0.01;
            
            const newYesPrice = Math.max(0.1, Math.min(0.9, lastPoint.yesPrice + yesVariation));
            const newNoPrice = Math.max(0.1, Math.min(0.9, lastPoint.noPrice + noVariation));
            
            // 更新最後一個價格點
            priceData[priceData.length - 1] = {
                ...lastPoint,
                yesPrice: newYesPrice,
                noPrice: newNoPrice
            };
            
            // 有時候添加新的價格點
            if (Math.random() < 0.15) {
                const newPoint = {
                    timestamp: Date.now(),
                    yesPrice: newYesPrice + (Math.random() - 0.5) * 0.02,
                    noPrice: newNoPrice + (Math.random() - 0.5) * 0.02
                };
                
                priceData.push(newPoint);
                if (priceData.length > 20) {
                    priceData.shift(); // 保持20個價格點
                }
            }
        }

        // 渲染價格走勢圖
        function renderPriceChart() {
            const chartContainer = document.getElementById('centerKlineChart');
            if (!chartContainer || priceData.length === 0) return;
            
            // 清空現有內容
            chartContainer.innerHTML = '';
            
            // 計算價格範圍
            const allYesPrices = priceData.map(p => p.yesPrice);
            const allNoPrices = priceData.map(p => p.noPrice);
            const minPrice = Math.min(...allYesPrices, ...allNoPrices);
            const maxPrice = Math.max(...allYesPrices, ...allNoPrices);
            const priceRange = maxPrice - minPrice || 0.1;
            
            const chartWidth = Math.max(100, chartContainer.clientWidth - 32);
            const chartHeight = 200;
            const pointWidth = chartWidth / priceData.length;
            
            // 創建SVG容器
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', chartWidth);
            svg.setAttribute('height', chartHeight);
            svg.style.position = 'absolute';
            svg.style.top = '16px';
            svg.style.left = '16px';
            chartContainer.appendChild(svg);
            
            // 繪製YES價格線
            let yesPath = '';
            priceData.forEach((point, index) => {
                const x = (index / (priceData.length - 1)) * chartWidth;
                const y = chartHeight - ((point.yesPrice - minPrice) / priceRange) * chartHeight;
                
                if (index === 0) {
                    yesPath += `M ${x} ${y}`;
                } else {
                    yesPath += ` L ${x} ${y}`;
                }
            });
            
            const yesLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            yesLine.setAttribute('d', yesPath);
            yesLine.setAttribute('stroke', '#10b981');
            yesLine.setAttribute('stroke-width', '2');
            yesLine.setAttribute('fill', 'none');
            svg.appendChild(yesLine);
            
            // 繪製NO價格線
            let noPath = '';
            priceData.forEach((point, index) => {
                const x = (index / (priceData.length - 1)) * chartWidth;
                const y = chartHeight - ((point.noPrice - minPrice) / priceRange) * chartHeight;
                
                if (index === 0) {
                    noPath += `M ${x} ${y}`;
                } else {
                    noPath += ` L ${x} ${y}`;
                }
            });
            
            const noLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            noLine.setAttribute('d', noPath);
            noLine.setAttribute('stroke', '#ef4444');
            noLine.setAttribute('stroke-width', '2');
            noLine.setAttribute('fill', 'none');
            svg.appendChild(noLine);
            
            // 添加數據點
            priceData.forEach((point, index) => {
                const x = (index / (priceData.length - 1)) * chartWidth;
                const yesY = chartHeight - ((point.yesPrice - minPrice) / priceRange) * chartHeight;
                const noY = chartHeight - ((point.noPrice - minPrice) / priceRange) * chartHeight;
                
                // YES數據點
                const yesCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                yesCircle.setAttribute('cx', x);
                yesCircle.setAttribute('cy', yesY);
                yesCircle.setAttribute('r', '3');
                yesCircle.setAttribute('fill', '#10b981');
                svg.appendChild(yesCircle);
                
                // NO數據點
                const noCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                noCircle.setAttribute('cx', x);
                noCircle.setAttribute('cy', noY);
                noCircle.setAttribute('r', '3');
                noCircle.setAttribute('fill', '#ef4444');
                svg.appendChild(noCircle);
                
                // 添加時間標籤
                const timeLabel = document.createElement('div');
                timeLabel.className = 'line-chart-label';
                timeLabel.textContent = new Date(point.timestamp).toLocaleTimeString('zh-TW', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                timeLabel.style.cssText = `
                    position: absolute;
                    left: ${x + 16}px;
                    bottom: 0;
                    font-size: 0.7rem;
                    color: #9ca3af;
                    transform: translateX(-50%);
                `;
                chartContainer.appendChild(timeLabel);
            });
            
            // 添加圖例
            const legend = document.createElement('div');
            legend.style.cssText = 'position: absolute; top: 0.5rem; left: 0.5rem; display: flex; gap: 1rem; font-size: 0.8rem;';
            legend.innerHTML = `
                <span style="color: #10b981;">● YES價格</span>
                <span style="color: #ef4444;">● NO價格</span>
            `;
            chartContainer.appendChild(legend);
            
            // 添加當前價格指示器
            const lastPoint = priceData[priceData.length - 1];
            const priceIndicator = document.createElement('div');
            priceIndicator.className = 'price-indicator';
            priceIndicator.textContent = `YES: ${lastPoint.yesPrice.toFixed(3)} | NO: ${lastPoint.noPrice.toFixed(3)}`;
            chartContainer.appendChild(priceIndicator);
        }

        // 顯示工具提示
        function showTooltip(event, bar) {
            let tooltip = document.querySelector('.chart-tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.className = 'chart-tooltip';
                document.body.appendChild(tooltip);
            }
            
            const time = new Date(bar.timestamp).toLocaleTimeString();
            tooltip.innerHTML = `
                <div>時間: ${time}</div>
                <div>開: ${bar.open.toFixed(3)}</div>
                <div>高: ${bar.high.toFixed(3)}</div>
                <div>低: ${bar.low.toFixed(3)}</div>
                <div>收: ${bar.close.toFixed(3)}</div>
                <div>量: ${bar.volume}</div>
            `;
            
            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY - 10}px`;
            tooltip.style.opacity = '1';
        }

        // 隱藏工具提示
        function hideTooltip() {
            const tooltip = document.querySelector('.chart-tooltip');
            if (tooltip) {
                tooltip.style.opacity = '0';
            }
        }

        // 切換時間框架
        function switchTimeframe(timeframe) {
            currentTimeframe = timeframe;
            
            // 更新按鈕狀態
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // 重新生成數據
            generatePriceData();
                            renderPriceChart();
        }

        // 快速下單功能
        let userBalance = 10000; // 模擬用戶餘額

        // 設置快速金額 (PK)
        function setQuickAmount(amount) {
            document.getElementById('betAmount').value = amount;
            
            // 更新快速按鈕狀態
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === amount.toString() || 
                    (amount === 1000 && btn.textContent === '1K') ||
                    (amount === 5000 && btn.textContent === '5K')) {
                    btn.classList.add('active');
                }
            });
            
            // 檢查餘額
            checkInnerBalance();
        }

        // 設置多選項快捷金額
        function setMultiOptionQuickAmount(amount) {
            document.getElementById('multiOptionAmount').value = amount;
            
            // 檢查餘額
            checkInnerBalance();
        }

        // 設置快速金額 (Trade)
        function setLMSRQuickAmount(amount) {
            document.getElementById('lmsrAmount').value = amount;
            
            // 更新快速按鈕狀態
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === amount.toString()) {
                    btn.classList.add('active');
                }
            });
            
            // 觸發LMSR價格更新和餘額檢查
            updateLMSRPrices();
            checkLMSRBalance();
        }

        // 設置多選項LMSR快捷金額
        function setMultiLMSRQuickAmount(amount) {
            document.getElementById('multiLmsrAmount').value = amount;
            
            // 檢查餘額
            checkLMSRBalance();
        }

        // 檢查PK交易餘額
        function checkInnerBalance() {
            // 檢查二元選項（betAmount）
            const betAmountEl = document.getElementById('betAmount');
            if (betAmountEl) {
                const amount = parseFloat(betAmountEl.value) || 0;
                if (amount > 0) {
                    const totalCost = amount; // PK是全額投入，手續費從中扣除
                    
                    const balanceElement = document.getElementById('userBalance');
                    const rechargeBtn = document.getElementById('rechargeBtn');
                    
                    if (totalCost > userBalance) {
                        if (balanceElement) balanceElement.classList.add('insufficient');
                        if (rechargeBtn) rechargeBtn.style.display = 'block';
                    } else {
                        if (balanceElement) balanceElement.classList.remove('insufficient');
                        if (rechargeBtn) rechargeBtn.style.display = 'none';
                    }
                }
            }

            // 檢查多選項（multiOptionAmount）
            const multiOptionAmountEl = document.getElementById('multiOptionAmount');
            if (multiOptionAmountEl) {
                const amount = parseFloat(multiOptionAmountEl.value) || 0;
                if (amount > 0) {
                    const totalCost = amount; // PK是全額投入，手續費從中扣除
                    
                    const multiBalanceElement = document.getElementById('multiUserBalance');
                    const multiRechargeBtn = document.getElementById('multiRechargeBtn');
                    
                    if (totalCost > userBalance) {
                        if (multiBalanceElement) multiBalanceElement.classList.add('insufficient');
                        if (multiRechargeBtn) multiRechargeBtn.style.display = 'block';
                    } else {
                        if (multiBalanceElement) multiBalanceElement.classList.remove('insufficient');
                        if (multiRechargeBtn) multiRechargeBtn.style.display = 'none';
                    }
                }
            }
        }

        // 檢查LMSR交易餘額
        function checkLMSRBalance() {
            // 檢查二元選項LMSR
            const lmsrAmountEl = document.getElementById('lmsrAmount');
            if (lmsrAmountEl) {
                const amount = parseFloat(lmsrAmountEl.value) || 0;
                if (amount > 0) {
                    // 計算預期成本（基於當前價格）
                    const yesPrice = currentTopic?.outerPool ? 
                        currentTopic.outerPool.yesAmount / currentTopic.outerPool.totalAmount : 0.5;
                    const noPrice = currentTopic?.outerPool ? 
                        currentTopic.outerPool.noAmount / currentTopic.outerPool.totalAmount : 0.5;
                    
                    // 使用較高的價格來估算最大成本
                    const maxPrice = Math.max(yesPrice, noPrice);
                    const estimatedCost = amount * maxPrice * 1.05; // 包含5%手續費
                    
                    const outerBalanceElement = document.getElementById('outerUserBalance');
                    const outerRechargeBtn = document.getElementById('outerRechargeBtn');
                    
                    if (estimatedCost > userBalance) {
                        if (outerBalanceElement) outerBalanceElement.classList.add('insufficient');
                        if (outerRechargeBtn) outerRechargeBtn.style.display = 'block';
                    } else {
                        if (outerBalanceElement) outerBalanceElement.classList.remove('insufficient');
                        if (outerRechargeBtn) outerRechargeBtn.style.display = 'none';
                    }
                }
            }

            // 檢查多選項LMSR
            const multiLmsrAmountEl = document.getElementById('multiLmsrAmount');
            if (multiLmsrAmountEl) {
                const amount = parseFloat(multiLmsrAmountEl.value) || 0;
                if (amount > 0) {
                    // 多選項LMSR簡化估算（使用平均價格）
                    const estimatedCost = amount * 0.6 * 1.05; // 假設平均價格0.6，包含5%手續費
                    
                    const multiOuterBalanceElement = document.getElementById('multiOuterUserBalance');
                    const multiOuterRechargeBtn = document.getElementById('multiOuterRechargeBtn');
                    
                    if (estimatedCost > userBalance) {
                        if (multiOuterBalanceElement) multiOuterBalanceElement.classList.add('insufficient');
                        if (multiOuterRechargeBtn) multiOuterRechargeBtn.style.display = 'block';
                    } else {
                        if (multiOuterBalanceElement) multiOuterBalanceElement.classList.remove('insufficient');
                        if (multiOuterRechargeBtn) multiOuterRechargeBtn.style.display = 'none';
                    }
                }
            }
        }

        // 檢查餘額
        function checkBalance(amount) {
            const balanceElement = document.getElementById('userBalance');
            const outerBalanceElement = document.getElementById('outerUserBalance');
            const rechargeBtn = document.getElementById('rechargeBtn');
            const outerRechargeBtn = document.getElementById('outerRechargeBtn');
            
            // 更新餘額顯示
            if (balanceElement) {
                balanceElement.textContent = `${userBalance.toLocaleString()} $`;
                if (amount > userBalance) {
                    balanceElement.classList.add('insufficient');
                    if (rechargeBtn) rechargeBtn.style.display = 'block';
                } else {
                    balanceElement.classList.remove('insufficient');
                    if (rechargeBtn) rechargeBtn.style.display = 'none';
                }
            }
            
            if (outerBalanceElement) {
                outerBalanceElement.textContent = `${userBalance.toLocaleString()} $`;
            }
        }

        // 顯示充值界面
        function showRecharge() {
            alert('充值功能將跳轉到充值頁面\n\n• 支持銀行卡充值\n• 支持數字貨幣充值\n• 支持第三方支付\n\n充值後餘額將即時到賬');
            
            // 模擬充值成功
            if (confirm('是否模擬充值 5000 $？')) {
                userBalance += 5000;
                updateBalanceDisplay();
                alert('充值成功！餘額已更新');
            }
        }

        // 更新所有餘額顯示
        function updateBalanceDisplay() {
            const balanceElement = document.getElementById('userBalance');
            const outerBalanceElement = document.getElementById('outerUserBalance');
            
            if (balanceElement) {
                balanceElement.textContent = `${userBalance.toLocaleString()} $`;
                balanceElement.classList.remove('insufficient');
            }
            
            if (outerBalanceElement) {
                outerBalanceElement.textContent = `${userBalance.toLocaleString()} $`;
                outerBalanceElement.classList.remove('insufficient');
            }
            
            // 隱藏充值按鈕
            const rechargeBtn = document.getElementById('rechargeBtn');
            const outerRechargeBtn = document.getElementById('outerRechargeBtn');
            const multiRechargeBtn = document.getElementById('multiRechargeBtn');
            const multiOuterRechargeBtn = document.getElementById('multiOuterRechargeBtn');
            if (rechargeBtn) rechargeBtn.style.display = 'none';
            if (outerRechargeBtn) outerRechargeBtn.style.display = 'none';
            if (multiRechargeBtn) multiRechargeBtn.style.display = 'none';
            if (multiOuterRechargeBtn) multiOuterRechargeBtn.style.display = 'none';
            
            // 重新檢查餘額（如果有輸入值）
            const betAmount = document.getElementById('betAmount');
            const multiOptionAmount = document.getElementById('multiOptionAmount');
            if ((betAmount && betAmount.value) || (multiOptionAmount && multiOptionAmount.value)) {
                checkInnerBalance();
            }
            
            const lmsrAmount = document.getElementById('lmsrAmount');
            const multiLmsrAmount = document.getElementById('multiLmsrAmount');
            if ((lmsrAmount && lmsrAmount.value) || (multiLmsrAmount && multiLmsrAmount.value)) {
                checkLMSRBalance();
            }
        }

        // 頁面加載時初始化餘額
        document.addEventListener('DOMContentLoaded', function() {
            updateBalanceDisplay();
        });

        // 創建話題表单提交
        document.getElementById('createTopicForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const isPrivate = formData.get('isPrivate') === 'on';
            const pumpCondition = parseInt(formData.get('pumpCondition')) || 1000;
            
            // 處理頭像 - 如果是文件則顯示文件名，否則使用首字符
            let avatar;
            const avatarFile = formData.get('avatar');
            if (avatarFile && avatarFile.name) {
                avatar = '📷'; // 使用相機emoji表示已上傳圖片
            } else {
                avatar = formData.get('content').charAt(0).toUpperCase();
            }
            
            const newTopic = {
                id: Date.now(),
                title: formData.get('content'),
                category: formData.get('category'),
                categoryName: e.target.category.selectedOptions[0].text,
                avatar: avatar,
                innerPool: {
                    yesAmount: 0,
                    noAmount: 0,
                    totalAmount: 0
                },
                outerPool: null,
                isOuter: false,
                endTime: formData.get('topicEndTime').split('T')[0],
                tradingEndTime: formData.get('tradingEndTime'), // PK交易結束時間
                status: 'inner',
                description: formData.get('content'),
                isPrivate: isPrivate,
                pumpCondition: isPrivate ? null : pumpCondition, // 私密話題不設定Pump條件
                outerTradingEndTime: formData.get('outerTradingEndTime') || formData.get('topicEndTime'), // 高級設定
                myInnerYes: 0,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            };

            sampleTopics.push(newTopic);
            alert('话题创建成功！');
            
            // 重置表单
            e.target.reset();
            
            // 跳转到話題詳情
            showTopicDetail(newTopic.id);
        });

        // 渲染個人中心数据
        function renderProfileData() {
            // 计算统计数据
            let totalInvested = 0;  // 總投入
            let totalValue = 0;     // 持倉價值
            let participatedTopics = 0;  // 參與話題數
            let totalTradingVolume = 0;  // 總交易量

            sampleTopics.forEach(topic => {
                const myInnerYes = topic.myInnerYes || 0;
                const myInnerNo = topic.myInnerNo || 0;
                const myOuterYes = topic.myOuterYes || 0;
                const myOuterNo = topic.myOuterNo || 0;
                
                const myInnerTotal = myInnerYes + myInnerNo;
                const myOuterTotal = myOuterYes + myOuterNo;
                const myTotal = myInnerTotal + myOuterTotal;
                
                if (myTotal > 0) {
                    participatedTopics++;
                    totalInvested += myTotal;
                    
                    // 計算當前持倉價值
                    let currentValue = myInnerTotal; // PK按原值計算
                    
                    // 計算交易量（包括PK和Trade的所有交易）
                    totalTradingVolume += myInnerTotal; // PK投入
                    
                    if (topic.status === 'outer' && topic.outerPool && topic.outerPool.totalAmount > 0) {
                        const yesPrice = topic.outerPool.yesAmount / topic.outerPool.totalAmount;
                        const noPrice = topic.outerPool.noAmount / topic.outerPool.totalAmount;
                        const outerValue = myOuterYes * yesPrice + myOuterNo * noPrice;
                        currentValue = myInnerTotal + outerValue;
                        
                        // Trade交易量估算（假設代幣是以當前價格買入的）
                        const outerTradeValue = myOuterYes * yesPrice + myOuterNo * noPrice;
                        totalTradingVolume += outerTradeValue;
                        
                        // 模擬歷史交易量（為了達到30M的水平）
                        totalTradingVolume += topic.outerPool.totalAmount * 0.1; // 假設參與了總池的10%的交易
                    }
                    
                    // 為每個話題添加模擬的歷史交易量
                    totalTradingVolume += (topic.innerPool?.totalAmount || 0) * 2; // 模擬多次PK交易
                    
                    totalValue += currentValue;
                }
            });

            // 模擬更大的交易量以達到合理的數值
            totalTradingVolume = totalTradingVolume * 50000; // 放大倍數以達到30M級別

            const totalProfit = totalValue - totalInvested;

            // 格式化數字顯示
            const formatNumber = (num) => {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                } else {
                    return num.toFixed(2);
                }
            };

            // 更新統計數據
            document.getElementById('totalAssets').textContent = `${formatNumber(totalValue)} U`;
            document.getElementById('totalProfit').textContent = totalProfit >= 0 ? 
                `+${formatNumber(totalProfit)} U` : `${formatNumber(totalProfit)} U`;
            document.getElementById('totalTopics').textContent = participatedTopics;
            document.getElementById('totalTrades').textContent = `${formatNumber(totalTradingVolume)} U`;

            // 渲染當前持倉
            renderCurrentPositions();
            
            // 渲染交易歷史
            renderTradingHistory();
        }

        // 渲染當前持倉
        function renderCurrentPositions() {
            const container = document.getElementById('currentPositions');
            container.innerHTML = '';

            const activePositions = sampleTopics.filter(topic => {
                const myInnerTotal = (topic.myInnerYes || 0) + (topic.myInnerNo || 0);
                const myOuterTotal = (topic.myOuterYes || 0) + (topic.myOuterNo || 0);
                return (myInnerTotal > 0 || myOuterTotal > 0) && topic.status !== 'ended';
            });

            if (activePositions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">📊</div>
                        <p>暫無活跃持仓</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">參與話題交易后将在这里显示</p>
                    </div>
                `;
                return;
            }

            activePositions.forEach(topic => {
                const myInnerYes = topic.myInnerYes || 0;
                const myInnerNo = topic.myInnerNo || 0;
                const myOuterYes = topic.myOuterYes || 0;
                const myOuterNo = topic.myOuterNo || 0;
                
                const myInnerTotal = myInnerYes + myInnerNo;
                const myOuterTotal = myOuterYes + myOuterNo;
                const myTotal = myInnerTotal + myOuterTotal;
                
                // 确定主要持仓类型和金额
                let position, positionAmount, positionType;
                if (myInnerTotal > myOuterTotal) {
                    position = myInnerYes > myInnerNo ? 'YES' : 'NO';
                    positionAmount = Math.max(myInnerYes, myInnerNo);
                    positionType = 'PK';
                } else if (myOuterTotal > 0) {
                    position = myOuterYes > myOuterNo ? 'YES' : 'NO';
                    positionAmount = Math.max(myOuterYes, myOuterNo);
                    positionType = 'Trade';
                } else {
                    position = myInnerYes > myInnerNo ? 'YES' : 'NO';
                    positionAmount = Math.max(myInnerYes, myInnerNo);
                    positionType = 'PK';
                }

                // 计算当前价值
                let currentValue = myInnerTotal;
                let valueClass = 'neutral';
                if (topic.status === 'outer' && topic.outerPool && topic.outerPool.totalAmount > 0) {
                    const yesPrice = topic.outerPool.yesAmount / topic.outerPool.totalAmount;
                    const noPrice = topic.outerPool.noAmount / topic.outerPool.totalAmount;
                    const outerValue = myOuterYes * yesPrice + myOuterNo * noPrice;
                    currentValue = myInnerTotal + outerValue;
                    valueClass = currentValue > myTotal ? 'positive' : currentValue < myTotal ? 'negative' : 'neutral';
                }

                const profitLoss = currentValue - myTotal;

                container.innerHTML += `
                    <div class="position-item" onclick="showTopicDetail(${topic.id})">
                        <div class="position-info">
                            <div class="position-title">${topic.title}</div>
                            <div class="position-details">
                                <span>持仓：${position} ${positionAmount} ${positionType === 'Trade' ? '个' : '$'}</span>
                                <span>状态：${positionType}</span>
                                <span>结束：${topic.endTime}</span>
                            </div>
                        </div>
                        <div class="position-value">
                            <div class="position-amount ${valueClass}">${currentValue.toFixed(2)} $</div>
                            <div class="position-status status-active">
                                ${profitLoss >= 0 ? '+' : ''}${profitLoss.toFixed(2)}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // 渲染交易歷史
        function renderTradingHistory() {
            const container = document.getElementById('tradingHistory');
            
            // 模拟交易歷史数据
            const historyData = [
                {
                    id: 1,
                    title: "比特币價格预测",
                    position: "YES",
                    amount: 100,
                    result: "won",
                    profit: 45.5,
                    date: "2024-01-15"
                },
                {
                    id: 2,
                    title: "美国大选预测",
                    position: "NO",
                    amount: 200,
                    result: "won",
                    profit: 89.2,
                    date: "2024-01-10"
                },
                {
                    id: 3,
                    title: "特斯拉股价预测",
                    position: "YES",
                    amount: 150,
                    result: "lost",
                    profit: -150,
                    date: "2024-01-05"
                },
                {
                    id: 4,
                    title: "OpenAI發布预测",
                    position: "NO",
                    amount: 80,
                    result: "won",
                    profit: 25.8,
                    date: "2023-12-28"
                }
            ];

            container.innerHTML = '';

            historyData.forEach(trade => {
                const resultClass = trade.result === 'won' ? 'positive' : 'negative';
                const statusClass = trade.result === 'won' ? 'status-won' : 'status-lost';

                container.innerHTML += `
                    <div class="history-item">
                        <div class="history-info">
                            <div class="history-title">${trade.title}</div>
                            <div class="history-details">
                                <span>持仓：${trade.position} ${trade.amount} $</span>
                                <span>日期：${trade.date}</span>
                            </div>
                        </div>
                        <div class="history-value">
                            <div class="history-amount ${resultClass}">
                                ${trade.profit >= 0 ? '+' : ''}${trade.profit.toFixed(2)} $
                            </div>
                            <div class="history-status ${statusClass}">
                                ${trade.result === 'won' ? '盈利' : '亏损'}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            renderTopics();
            
            // 预渲染PK話題以確保數據正確
            renderInnerTopics();
            
            // 检查URL参数
            const urlParams = new URLSearchParams(window.location.search);
            const topicId = urlParams.get('topic');
            if (topicId) {
                showTopicDetail(parseInt(topicId));
            }
            

        });
    </script>
</body>
</html>

