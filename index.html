<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>BitX ‰∫§ÊòìÂéüÂûã</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #0a0b0d;
            color: #ffffff;
            overflow-x: hidden;
        }

        /* Â∑¶ÂÅ¥Â∞éËà™Ê¨Ñ */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: #111218;
            border-right: 1px solid #1f2937;
            z-index: 100;
            display: flex;
            flex-direction: column;
        }

        .sidebar-header {
            padding: 1.5rem;
            border-bottom: 1px solid #1f2937;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #3b82f6;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .logo::before {
            content: "‚ö°";
            font-size: 1.2rem;
        }

        .sidebar-nav {
            flex: 1;
            padding: 1rem 0;
        }

        .nav-item {
            display: block;
            padding: 0.875rem 1.5rem;
            color: #9ca3af;
            text-decoration: none;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            font-weight: 500;
        }

        .nav-item:hover {
            background: #1f2937;
            color: #ffffff;
            border-left-color: #3b82f6;
        }

        .nav-item.active {
            background: #1e40af;
            color: #ffffff;
            border-left-color: #3b82f6;
        }

        .nav-icon {
            display: inline-block;
            width: 20px;
            margin-right: 0.75rem;
        }

        /* ‰∏ªÂÜÖÂÆπÂå∫Âüü */
        .main-layout {
            margin-left: 240px;
            min-height: 100vh;
            display: flex;
        }

        .content-area {
            flex: 1;
            padding: 2rem;
            max-width: calc(100vw - 240px - 420px);
        }

        /* ÂâµÂª∫È†ÅÈù¢ÁâπÊÆä‰ΩàÂ±Ä */
        #create .content-area {
            max-width: 1400px;
            margin: 0 auto;
            padding: 2rem 4rem;
            width: calc(100vw - 240px);
        }

        .container {
            max-width: none;
            margin: 0;
            padding: 0;
        }

        /* Âè≥ÂÅ¥‰∫§ÊòìÊ¨Ñ */
        .trading-sidebar {
            width: 420px;
            background: #111218;
            border-left: 1px solid #1f2937;
            padding: 2rem;
            overflow-y: auto;
            position: fixed;
            right: 0;
            top: 0;
            height: 100vh;
            z-index: 50;
        }

        .trading-sidebar.hidden {
            transform: translateX(100%);
            transition: transform 0.3s ease;
        }

        .trading-header {
            padding-bottom: 1rem;
            border-bottom: 1px solid #1f2937;
            margin-bottom: 1.5rem;
        }

        .trading-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.5rem;
        }

        .trading-subtitle {
            font-size: 0.875rem;
            color: #6b7280;
        }

        .btn {
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
        }

        .btn-primary {
            background: linear-gradient(135deg, #3b82f6, #1d4ed8);
            color: white;
            border: 1px solid #3b82f6;
        }

        .btn-primary:hover {
            background: linear-gradient(135deg, #2563eb, #1e40af);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(59, 130, 246, 0.4);
        }

        .btn-secondary {
            background: #1f2937;
            color: #d1d5db;
            border: 1px solid #374151;
        }

        .btn-secondary:hover {
            background: #374151;
            color: #ffffff;
        }

        .btn-success {
            background: linear-gradient(135deg, #10b981, #059669);
            color: white;
            border: 1px solid #10b981;
        }

        .btn-success:hover {
            background: linear-gradient(135deg, #059669, #047857);
        }

        .btn-danger {
            background: linear-gradient(135deg, #ef4444, #dc2626);
            color: white;
            border: 1px solid #ef4444;
        }

        .btn-danger:hover {
            background: linear-gradient(135deg, #dc2626, #b91c1c);
        }

        .btn-outline {
            background: transparent;
            border: 2px solid;
        }

        .btn-outline.btn-success {
            border-color: #16a34a;
            color: #16a34a;
        }

        .btn-outline.btn-success:hover {
            background: rgba(22, 163, 74, 0.1);
        }

        .btn-outline.btn-danger {
            border-color: #dc2626;
            color: #dc2626;
        }

        .btn-outline.btn-danger:hover {
            background: rgba(220, 38, 38, 0.1);
        }

        /* È°µÈù¢ÂàáÊç¢ */
        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        /* È¶ñÈ†ÅÁÄëÂ∏ÉÊµÅ */
        .waterfall {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: 1.5rem;
        }

        .topic-card {
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 1.5rem;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .topic-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
            background: linear-gradient(90deg, #3b82f6, #10b981);
        }

        .topic-card:hover {
            transform: translateY(-4px);
            border-color: #3b82f6;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
        }

        .topic-progress {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid #374151;
        }

        .topic-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .topic-avatar {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
            font-size: 1.2rem;
        }

        .topic-info h3 {
            font-size: 1.1rem;
            margin-bottom: 0.5rem;
            color: #ffffff;
            line-height: 1.4;
        }

        .topic-category {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            padding: 0.3rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }

        .topic-stats {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 1rem;
            margin-top: 1.5rem;
            padding-top: 1rem;
            border-top: 1px solid #2d3748;
        }

        .stat {
            text-align: center;
        }

        .stat-value {
            font-size: 1.3rem;
            font-weight: 700;
            color: #3b82f6;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.75rem;
            color: #9ca3af;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        /* ÂâµÂª∫Ë©±È°åÈ†ÅÈù¢ */
        .create-form {
            max-width: 700px;
            margin: 0 auto;
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 2.5rem;
        }

        .form-group {
            margin-bottom: 2rem;
        }

        .form-label {
            display: block;
            margin-bottom: 0.75rem;
            font-weight: 600;
            color: #ffffff;
            font-size: 0.9rem;
        }

        .form-input {
            width: 100%;
            padding: 1rem;
            border: 1px solid #374151;
            border-radius: 8px;
            font-size: 1rem;
            background: #111218;
            color: #ffffff;
            transition: all 0.2s;
        }

        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
            background: #1a1b23;
        }

        .form-input::placeholder {
            color: #6b7280;
        }

        .form-textarea {
            resize: vertical;
            min-height: 120px;
            line-height: 1.6;
        }

        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
        }

        .checkbox-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #3b82f6;
        }

        .pump-notice {
            background: rgba(245, 158, 11, 0.1);
            border: 1px solid rgba(245, 158, 11, 0.3);
            border-radius: 8px;
            padding: 1.25rem;
            margin: 1.5rem 0;
            color: #fbbf24;
        }

        .pump-notice strong {
            color: #f59e0b;
        }

        .options-container {
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
        }

        .option-input {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
        }

        .add-option {
            color: #2563eb;
            cursor: pointer;
            font-size: 0.9rem;
        }

        /* Ë©±È°åË©≥ÊÉÖÈ†ÅÈù¢ */
        .topic-detail-container {
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 2.5rem;
            margin-bottom: 2rem;
        }

        .main-content {
            width: 100%;
        }

        .topic-title {
            font-size: 1.75rem;
            margin-bottom: 1rem;
            color: #ffffff;
            font-weight: 700;
            line-height: 1.3;
        }

        .topic-meta {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 2rem;
            font-size: 0.875rem;
            color: #9ca3af;
            align-items: center;
        }

        /* ‰∫§ÊòìÁïåÈù¢Ê†∑Âºè */
        .betting-interface {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .bet-option {
            border: 2px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #111218;
            position: relative;
            overflow: hidden;
        }

        .bet-option::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            opacity: 0;
            transition: opacity 0.3s;
        }

        .bet-option:hover {
            transform: translateY(-2px);
            border-color: #4b5563;
        }

        .bet-option.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.05);
        }

        .bet-option.yes {
            border-color: #059669;
        }

        .bet-option.yes.selected {
            border-color: #10b981;
            background: rgba(16, 185, 129, 0.05);
        }

        .bet-option.yes::before {
            background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), transparent);
        }

        .bet-option.no {
            border-color: #dc2626;
        }

        .bet-option.no.selected {
            border-color: #ef4444;
            background: rgba(239, 68, 68, 0.05);
        }

        .bet-option.no::before {
            background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), transparent);
        }

        .bet-option.selected::before {
            opacity: 1;
        }

        .bet-label {
            font-weight: 700;
            font-size: 1.25rem;
            margin-bottom: 0.75rem;
            position: relative;
            z-index: 1;
        }

        .bet-option.yes .bet-label {
            color: #10b981;
        }

        .bet-option.no .bet-label {
            color: #ef4444;
        }

        .bet-amount {
            color: #9ca3af;
            font-size: 0.9rem;
            font-weight: 500;
            position: relative;
            z-index: 1;
        }

        .amount-input-group {
            display: flex;
            gap: 0.75rem;
            margin: 2rem 0;
        }

        .amount-input {
            flex: 1;
            padding: 1rem;
            border: 1px solid #374151;
            border-radius: 8px;
            background: #111218;
            color: #ffffff;
            font-size: 1rem;
        }

        .amount-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }

        .amount-input::placeholder {
            color: #6b7280;
        }

        /* Âè≥‰æß‰∫§ÊòìÊ†èÂÜÖÂÆπÊ†∑Âºè */
        .trading-section {
            margin-bottom: 2rem;
        }

        .section-title {
            font-weight: 600;
            margin-bottom: 1rem;
            color: #ffffff;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .section-title::before {
            content: '';
            width: 3px;
            height: 16px;
            background: linear-gradient(135deg, #3b82f6, #10b981);
            border-radius: 2px;
        }

        .pool-info {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            backdrop-filter: blur(10px);
        }

        .pool-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            font-size: 0.9rem;
        }

        .pool-row:last-child {
            margin-bottom: 0;
            font-weight: 700;
            padding-top: 1rem;
            border-top: 1px solid #374151;
            font-size: 1rem;
        }

        .pool-label {
            color: #9ca3af;
        }

        .pool-value {
            color: #ffffff;
            font-weight: 600;
        }

        .pool-row:last-child .pool-value {
            color: #3b82f6;
        }

        .pump-progress {
            margin: 1.5rem 0;
        }

        .progress-bar {
            width: 100%;
            height: 12px;
            background: rgba(55, 65, 81, 0.5);
            border-radius: 6px;
            overflow: hidden;
            border: 1px solid #374151;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #3b82f6);
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        .progress-text {
            text-align: center;
            margin-top: 0.75rem;
            font-size: 0.875rem;
            color: #9ca3af;
            font-weight: 500;
        }

        .progress-text strong {
            color: #10b981;
        }

        /* LMSRÂÉπÊ†ºÂç°ÁâáÊ†∑Âºè */
        .price-card {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1rem;
            text-align: center;
            position: relative;
            overflow: hidden;
        }

        .price-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 3px;
        }

        .price-card.yes-price::before {
            background: linear-gradient(90deg, #10b981, #059669);
        }

        .price-card.no-price::before {
            background: linear-gradient(90deg, #ef4444, #dc2626);
        }

        .price-label {
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            margin-bottom: 0.5rem;
            opacity: 0.8;
        }

        .yes-price .price-label {
            color: #34d399;
        }

        .no-price .price-label {
            color: #f87171;
        }

        .price-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .price-unit {
            font-size: 0.75rem;
            color: #9ca3af;
            opacity: 0.8;
        }

        /* LMSR‰∫§ÊòìÊåâÈíÆÊ†∑Âºè */
        .lmsr-buy-btn {
            position: relative;
            overflow: hidden;
        }

        .lmsr-buy-btn small {
            margin-top: 0.25rem;
        }

        .trading-form {
            margin-top: 1rem;
        }

        /* ÁçéÈáëÊ±†ÂàÜÂå∫Ê†∑Âºè */
        .pool-section {
            margin-bottom: 1.5rem;
        }

        .pool-section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
            padding-bottom: 0.5rem;
            border-bottom: 1px solid #374151;
        }

        .pool-section-title {
            font-size: 0.9rem;
            font-weight: 600;
            color: #ffffff;
        }

        .pool-section-badge {
            font-size: 0.7rem;
            padding: 0.25rem 0.6rem;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
            letter-spacing: 0.05em;
        }

        .pool-section-badge:not(.trade) {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .pool-section-badge.trade {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .pool-section-badge.pumped {
            background: rgba(245, 158, 11, 0.1);
            color: #fbbf24;
            border: 1px solid rgba(245, 158, 11, 0.3);
        }

        .status-badge {
            display: inline-flex;
            align-items: center;
            padding: 0.4rem 0.9rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .status-pk {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
            border: 1px solid rgba(59, 130, 246, 0.3);
        }

        .status-trade {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
            border: 1px solid rgba(16, 185, 129, 0.3);
        }

        .status-ended {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* ÂÄã‰∫∫‰∏≠ÂøÉÊ®£Âºè */
        .profile-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: #1a1b23;
            border: 1px solid #2d3748;
            border-radius: 16px;
            padding: 2rem;
            text-align: center;
        }

        .stat-card h3 {
            color: #9ca3af;
            font-size: 0.9rem;
            font-weight: 500;
            margin-bottom: 1rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }

        .stat-card .value {
            font-size: 2.5rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
        }

        .stat-card.positive .value {
            color: #10b981;
        }

        .stat-card.primary .value {
            color: #3b82f6;
        }

        /* ÊåÅ‰ªìÂíå‰∫§ÊòìÊ≠∑Âè≤Ê†∑Âºè */
        .position-item, .history-item {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid #374151;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .position-info, .history-info {
            flex: 1;
        }

        .position-title, .history-title {
            color: #ffffff;
            font-weight: 600;
            margin-bottom: 0.5rem;
            font-size: 0.95rem;
        }

        .position-details, .history-details {
            color: #9ca3af;
            font-size: 0.85rem;
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .position-value, .history-value {
            text-align: right;
        }

        .position-amount, .history-amount {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .position-amount.positive, .history-amount.positive {
            color: #10b981;
        }

        .position-amount.negative, .history-amount.negative {
            color: #ef4444;
        }

        .position-amount.neutral, .history-amount.neutral {
            color: #60a5fa;
        }

        .position-status, .history-status {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 12px;
            text-transform: uppercase;
            font-weight: 600;
        }

        .status-active {
            background: rgba(59, 130, 246, 0.1);
            color: #60a5fa;
        }

        .status-won {
            background: rgba(16, 185, 129, 0.1);
            color: #34d399;
        }

        .status-lost {
            background: rgba(239, 68, 68, 0.1);
            color: #f87171;
        }

        .empty-state {
            text-align: center;
            padding: 3rem 1rem;
            color: #6b7280;
        }

        .empty-state-icon {
            font-size: 3rem;
            margin-bottom: 1rem;
            opacity: 0.5;
        }

        /* ÂìçÂ∫îÂºèËÆæËÆ° */
        @media (max-width: 1024px) {
            .main-layout {
                margin-left: 0;
                flex-direction: column;
            }
            
            .sidebar {
                width: 100%;
                height: auto;
                position: relative;
                order: -1;
                flex-direction: row;
                border-right: none;
                border-bottom: 1px solid #1f2937;
            }
            
            .sidebar-nav {
                display: flex;
                flex-direction: row;
                padding: 0;
            }
            
            .nav-item {
                flex: 1;
                text-align: center;
                border-left: none;
                border-bottom: 3px solid transparent;
            }
            
            .nav-item.active,
            .nav-item:hover {
                border-left: none;
                border-bottom-color: #3b82f6;
            }
            
            .trading-sidebar {
                position: relative;
                width: 100%;
                height: auto;
                border-left: none;
                border-top: 1px solid #1f2937;
            }
            
            .content-area {
                max-width: 100%;
                padding: 1rem;
            }
        }

        @media (max-width: 768px) {
            .betting-interface {
                grid-template-columns: 1fr;
            }
            
            .waterfall {
                grid-template-columns: 1fr;
            }
            
            .topic-stats {
                grid-template-columns: 1fr;
                gap: 0.5rem;
            }
            
            .amount-input-group {
                flex-direction: column;
            }
            
            .profile-stats {
                grid-template-columns: 1fr;
            }
        }

        /* Ê®°ÊÄÅÊ°Ü */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 1000;
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 2rem;
            max-width: 400px;
            width: 90%;
            text-align: center;
        }

        .modal-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1rem;
        }

        .modal-buttons {
            display: flex;
            gap: 1rem;
            justify-content: center;
            margin-top: 1.5rem;
        }

        /* Á°ÆËÆ§ÂíåÊàêÂäüÂºπÁ™óËØ¶ÊÉÖÊ†∑Âºè */
        .confirm-details, .success-details {
            text-align: left;
            background: rgba(31, 41, 55, 0.05);
            border-radius: 8px;
            padding: 1rem;
            margin: 1rem 0;
        }

        .detail-row {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.5rem 0;
            border-bottom: 1px solid rgba(31, 41, 55, 0.1);
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 500;
            color: #374151;
        }

        .detail-value {
            font-weight: 600;
            color: #111827;
        }

        /* ÈÄâÈ°π‰∏≠ÁöÑÊîØÊåÅÊØî‰æãÊ†∑Âºè */
        #confirmRatio, #successRatio {
            font-size: 0.9em;
            color: #6b7280;
            font-weight: 500;
        }

        /* ÂâµÂª∫È†ÅÈù¢ÂàÜÂçÄÊ®£Âºè */
        .form-section {
            background: rgba(31, 41, 55, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.3);
            border-radius: 12px;
            padding: 2rem;
            margin-bottom: 2rem;
        }

        .section-header {
            margin-bottom: 1.5rem;
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
            padding-bottom: 1rem;
        }

        .section-title {
            color: #ffffff;
            font-size: 1.25rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .section-subtitle {
            color: #9ca3af;
            font-size: 0.9rem;
            margin: 0;
        }

        .input-group {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            background: rgba(17, 24, 39, 0.5);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 8px;
            padding: 0.75rem 1rem;
        }

        .input-label {
            color: #9ca3af;
            font-size: 0.9rem;
            white-space: nowrap;
        }

        .input-group .form-input {
            flex: 1;
            background: transparent;
            border: none;
            margin: 0;
            padding: 0;
        }

        .input-unit {
            color: #60a5fa;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .pump-explanation {
            background: rgba(59, 130, 246, 0.1);
            border: 1px solid rgba(59, 130, 246, 0.3);
            border-radius: 8px;
            padding: 1.25rem;
            margin-top: 1rem;
        }

        .explanation-title {
            color: #60a5fa;
            font-weight: 600;
            margin-bottom: 0.75rem;
            font-size: 0.95rem;
        }

        .explanation-list {
            margin: 0;
            padding-left: 1.25rem;
            color: #9ca3af;
            font-size: 0.85rem;
            line-height: 1.5;
        }

        .explanation-list li {
            margin-bottom: 0.5rem;
        }

        #pumpSection.disabled {
            opacity: 0.5;
            pointer-events: none;
        }

        #pumpSection.disabled::before {
            content: "ÁßÅÂØÜË©±È°å‰∏çÊîØÊè¥PumpÂäüËÉΩ";
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(239, 68, 68, 0.9);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            z-index: 10;
        }

        #pumpSection {
            position: relative;
        }

        .pool-section-badge.private {
            background: rgba(239, 68, 68, 0.2);
            color: #f87171;
            border: 1px solid rgba(239, 68, 68, 0.3);
        }

        /* ÈÅ∏È†ÖË®≠ÁΩÆÊ®£Âºè */
        .option-type-selector {
            display: flex;
            gap: 1.5rem;
            margin-bottom: 1rem;
        }

        .radio-option {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }

        .radio-option input[type="radio"] {
            margin: 0;
        }

        .radio-label {
            color: #ffffff;
            font-size: 0.9rem;
        }

        .custom-options-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .btn-sm {
            padding: 0.4rem 0.8rem;
            font-size: 0.8rem;
        }

        .option-input {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
            align-items: center;
        }

        .option-input .form-input {
            flex: 1;
        }

        .option-input .option-number {
            color: #9ca3af;
            font-size: 0.9rem;
            min-width: 60px;
        }

        /* PKÂ∞çÂ£òÁïåÈù¢Ê®£Âºè */
        .pk-arena {
            display: flex;
            align-items: stretch;
            gap: 1rem;
            margin: 1rem 0;
            padding: 1rem;
            background: rgba(17, 24, 39, 0.5);
            border-radius: 12px;
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .pk-side {
            flex: 1;
            background: rgba(31, 41, 55, 0.8);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            min-height: 120px;
        }

        .pk-side:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }

        .pk-side.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .yes-side {
            border-left: 4px solid #10b981;
        }

        .yes-side:hover {
            border-left-color: #059669;
            background: rgba(16, 185, 129, 0.05);
        }

        .no-side {
            border-right: 4px solid #ef4444;
        }

        .no-side:hover {
            border-right-color: #dc2626;
            background: rgba(239, 68, 68, 0.05);
        }

        .pk-header {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 0.75rem;
        }

        .pk-icon {
            font-size: 1.25rem;
        }

        .pk-label {
            font-weight: 600;
            color: #ffffff;
            font-size: 1rem;
        }

        .pk-stats {
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            gap: 0.15rem;
        }

        .pk-amount {
            font-size: 1.1rem;
            font-weight: 700;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .pk-percentage {
            font-size: 0.85rem;
            color: #9ca3af;
        }

        .pk-participants {
            font-size: 0.75rem;
            color: #6b7280;
        }

        .pk-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            transition: width 0.3s ease;
            width: 0%;
        }

        .yes-side .pk-indicator {
            background: linear-gradient(90deg, transparent, #10b981, transparent);
        }

        .no-side .pk-indicator {
            background: linear-gradient(90deg, transparent, #ef4444, transparent);
        }

        .pk-vs {
            text-align: center;
            color: #ffffff;
            font-weight: bold;
            flex-shrink: 0;
            padding: 0 0.75rem;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .vs-text {
            font-size: 1.5rem;
            background: linear-gradient(45deg, #3b82f6, #8b5cf6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            font-weight: 800;
        }

        .vs-subtitle {
            font-size: 0.65rem;
            color: #9ca3af;
            margin-top: 0.15rem;
        }

        /* Â§öÈÅ∏È†Ö‰∫§ÊòìÁïåÈù¢Ê®£Âºè */
        .multi-option-trading {
            display: none;
        }

        .multi-option-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 0.75rem;
            margin: 1rem 0;
        }

        .option-card {
            background: rgba(31, 41, 55, 0.8);
            border-radius: 8px;
            padding: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            position: relative;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
        }

        .option-card:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            border-color: rgba(59, 130, 246, 0.5);
        }

        .option-card.selected {
            border-color: #3b82f6;
            background: rgba(59, 130, 246, 0.1);
        }

        .option-header {
            text-align: center;
            margin-bottom: 0.75rem;
        }

        .option-name {
            font-size: 1rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .option-stats {
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.15rem;
        }

        .option-amount {
            font-size: 0.9rem;
            font-weight: 600;
            color: #ffffff;
        }

        .option-percentage {
            font-size: 0.75rem;
            color: #9ca3af;
        }

        .option-participants {
            font-size: 0.7rem;
            color: #6b7280;
        }

        .option-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background: linear-gradient(90deg, transparent, #3b82f6, transparent);
            border-radius: 0 0 6px 6px;
            transition: width 0.3s ease;
        }

        /* Â§öÈÅ∏È†ÖTrade LMSRÊ®£Âºè */
        .multi-lmsr-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .lmsr-option-card {
            background: rgba(31, 41, 55, 0.8);
            border-radius: 6px;
            padding: 0.75rem;
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .lmsr-option-header {
            text-align: center;
            margin-bottom: 0.5rem;
        }

        .lmsr-option-name {
            font-size: 0.85rem;
            font-weight: 600;
            color: #ffffff;
            margin-bottom: 0.25rem;
        }

        .lmsr-option-price {
            font-size: 0.75rem;
            color: #10b981;
            font-weight: 600;
        }

        .lmsr-option-actions {
            display: flex;
            gap: 0.25rem;
        }

        .lmsr-mini-btn {
            flex: 1;
            padding: 0.25rem 0.5rem;
            font-size: 0.7rem;
            border-radius: 4px;
            border: 1px solid;
            cursor: pointer;
            transition: all 0.2s;
        }

        .lmsr-buy-btn {
            background: rgba(16, 185, 129, 0.2);
            border-color: #10b981;
            color: #10b981;
        }

        .lmsr-buy-btn:hover {
            background: rgba(16, 185, 129, 0.3);
        }

        .lmsr-sell-btn {
            background: rgba(239, 68, 68, 0.2);
            border-color: #ef4444;
            color: #ef4444;
        }

        .lmsr-sell-btn:hover {
            background: rgba(239, 68, 68, 0.3);
        }

        /* KÁ∑öÂúñÊ®£Âºè */
        .kline-chart-container {
            background: rgba(17, 24, 39, 0.8);
            border-radius: 8px;
            border: 1px solid rgba(75, 85, 99, 0.3);
            overflow: hidden;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 1rem;
            background: rgba(31, 41, 55, 0.5);
            border-bottom: 1px solid rgba(75, 85, 99, 0.3);
        }

        .chart-title {
            color: #ffffff;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .chart-controls {
            display: flex;
            gap: 0.5rem;
        }

        .chart-btn {
            padding: 0.25rem 0.5rem;
            background: transparent;
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #9ca3af;
            border-radius: 4px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .chart-btn:hover {
            background: rgba(75, 85, 99, 0.3);
            color: #ffffff;
        }

        .chart-btn.active {
            background: #3b82f6;
            color: #ffffff;
            border-color: #3b82f6;
        }

        .kline-chart, .line-chart {
            height: 280px;
            position: relative;
            padding: 1rem;
            background: rgba(17, 24, 39, 0.5);
        }

        /* ÊäòÁ∫øÂõæÊ†∑Âºè */
        .line-chart {
            position: relative;
            padding: 1rem;
        }

        .line-chart svg {
            width: 100%;
            height: 100%;
        }

        .line-chart-label {
            position: absolute;
            bottom: 0;
            font-size: 0.7rem;
            color: #9ca3af;
            white-space: nowrap;
        }

        .price-indicator {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            background: rgba(17, 24, 39, 0.9);
            color: #ffffff;
            padding: 0.5rem;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .kline-bar {
            position: absolute;
            bottom: 1rem;
            width: 8px;
            border-radius: 1px;
            transition: all 0.3s;
        }

        .kline-bar.up {
            background: linear-gradient(180deg, #10b981, #059669);
            border: 1px solid #10b981;
        }

        .kline-bar.down {
            background: linear-gradient(180deg, #ef4444, #dc2626);
            border: 1px solid #ef4444;
        }

        .price-indicator {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            background: rgba(59, 130, 246, 0.8);
            color: white;
            padding: 0.25rem 0.5rem;
            border-radius: 4px;
            font-size: 0.75rem;
            font-weight: 600;
        }

        .chart-tooltip {
            position: absolute;
            background: rgba(17, 24, 39, 0.95);
            border: 1px solid rgba(75, 85, 99, 0.5);
            border-radius: 4px;
            padding: 0.5rem;
            font-size: 0.75rem;
            color: #ffffff;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.2s;
            z-index: 100;
        }

        /* Âø´ÈÄü‰∏ãÂñÆÊåâÈàïÊ®£Âºè */
        .quick-amount-buttons {
            display: flex;
            gap: 0.5rem;
            margin-bottom: 1rem;
            justify-content: space-between;
        }

        .quick-btn {
            flex: 1;
            padding: 0.5rem 0.75rem;
            background: rgba(75, 85, 99, 0.3);
            border: 1px solid rgba(75, 85, 99, 0.5);
            color: #d1d5db;
            border-radius: 6px;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .quick-btn:hover {
            background: rgba(59, 130, 246, 0.3);
            border-color: #3b82f6;
            color: #60a5fa;
        }

        .quick-btn.active {
            background: #3b82f6;
            border-color: #3b82f6;
            color: #ffffff;
        }

        /* È§òÈ°çÈ°ØÁ§∫Ê®£Âºè */
        .input-with-balance {
            position: relative;
        }

        .balance-display {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            padding: 0.5rem 0.75rem;
            background: rgba(17, 24, 39, 0.8);
            border-radius: 6px;
            border: 1px solid rgba(75, 85, 99, 0.3);
        }

        .balance-label {
            color: #9ca3af;
            font-size: 0.8rem;
        }

        .balance-amount {
            color: #10b981;
            font-weight: 600;
            font-size: 0.9rem;
        }

        .balance-amount.insufficient {
            color: #ef4444;
        }

        /* ÂÖÖÂÄºÊåâÈàïÊ®£Âºè */
        .recharge-btn {
            background: linear-gradient(45deg, #8b5cf6, #06b6d4);
            border: none;
            color: #ffffff;
            font-weight: 600;
            transition: all 0.3s;
        }

        .recharge-btn:hover {
            background: linear-gradient(45deg, #7c3aed, #0891b2);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(139, 92, 246, 0.4);
        }
    </style>
</head>
<body>
    <!-- Â∑¶ÂÅ¥Â∞éËà™Ê¨Ñ -->
    <nav class="sidebar">
        <div class="sidebar-header">
            <div class="logo">BitX ‰∫§ÊòìÂéüÂûã</div>
        </div>
        <div class="sidebar-nav">
            <a href="#" class="nav-item active" onclick="showPage('home')">
                <span class="nav-icon">üè†</span>ÁÜ±ÈñÄË©±È°å
            </a>
            <a href="#" class="nav-item" onclick="showPage('inner')">
                <span class="nav-icon">üìä</span>PKË©±È°å(ÊºîÁ§∫)
            </a>
            <a href="#" class="nav-item" onclick="showPage('create')">
                <span class="nav-icon">‚ûï</span>ÂâµÂª∫Ë©±È°å
            </a>
            <a href="#" class="nav-item" onclick="showPage('profile')">
                <span class="nav-icon">üë§</span>ÂÄã‰∫∫‰∏≠ÂøÉ
            </a>
        </div>
    </nav>

    <!-- ‰∏ªÂ∏ÉÂ±ÄÂÆπÂô® -->
    <div class="main-layout">
        <!-- È¶ñÈ†Å/ÁÄëÂ∏ÉÊµÅ -->
        <div id="home" class="page active">
            <div class="content-area">
                <h1 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 2rem;">ÁÜ±ÈñÄË©±È°å</h1>
                <div class="waterfall" id="topicWaterfall">
                    <!-- Ë©±È°åÂç°ÁâáÂ∞áÈÄöÈÅéJavaScriptÂãïÊÖãÁîüÊàê -->
                </div>
            </div>
        </div>

        <!-- PKË©±È°åÈ†ÅÈù¢ -->
        <div id="inner" class="page">
            <div class="content-area">
                <h1 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 2rem;">PKË©±È°å</h1>
                <div class="waterfall" id="innerTopicWaterfall">
                    <!-- PKË©±È°åÂç°ÁâáÂ∞áÈÄöÈÅéJavaScriptÂãïÊÖãÁîüÊàê -->
                </div>
            </div>
        </div>

        <!-- ÂâµÂª∫Ë©±È°åÈ†ÅÈù¢ -->
        <div id="create" class="page">
            <div class="content-area">
                <div class="create-form">
                    <h2 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 1.75rem;">ÂâµÂª∫Êñ∞Ë©±È°å</h2>
                
                    <form id="createTopicForm">
                        <!-- Á¨¨‰∏ÄÈÉ®ÂàÜÔºöË©±È°åË®≠ÂÆö -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">üìù Ë©±È°åË®≠ÂÆö</h3>
                                <p class="section-subtitle">Ë®≠ÂÆöË©±È°åÁöÑÂü∫Êú¨Ë≥áË®ä</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ë©±È°åÂÖßÂÆπ *</label>
                                <textarea class="form-input form-textarea" name="content" placeholder="Ë´ãËº∏ÂÖ•ÊÇ®Ë¶ÅÈ¢ÑÊµãÁöÑË©±È°åÂÖßÂÆπ..." required></textarea>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ë©±È°åÈ†≠ÂÉè</label>
                                <input type="file" class="form-input" name="avatar" accept="image/*">
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">ÊîØÊè¥ JPG„ÄÅPNG„ÄÅGIF Ê†ºÂºèÔºåÂª∫Ë≠∞Â∞∫ÂØ∏ 200x200 ÂÉèÁ¥†</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ë©±È°åÈ°ûÂà• *</label>
                                <select class="form-input" name="category" required>
                                    <option value="">Ë´ãÈÅ∏ÊìáÈ°ûÂà•</option>
                                    <option value="sports">È´îËÇ≤Ë≥Ω‰∫ã</option>
                                    <option value="politics">ÊîøÊ≤ªÈÅ∏Ëàâ</option>
                                    <option value="crypto">Âä†ÂØÜË≤®Âπ£</option>
                                    <option value="economy">Á∂ìÊøüÈ†êÊ∏¨</option>
                                    <option value="entertainment">Â®õÊ®ÇÂÖ´Âç¶</option>
                                    <option value="technology">ÁßëÊäÄÁôºÂ±ï</option>
                                    <option value="other">ÂÖ∂‰ªñ</option>
                                </select>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="isPrivate" name="isPrivate" onchange="togglePumpSettings()">
                                    <label for="isPrivate" class="form-label" style="margin-bottom: 0;">ÁßÅÂØÜË©±È°å</label>
                                </div>
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">ÁßÅÂØÜË©±È°å‰∏çÊúÉÂá∫ÁèæÂú®ÁÄëÂ∏ÉÊµÅ‰∏≠Ôºå‰πü‰∏çÊúÉËß∏ÁôºPumpËΩâTrade</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">ÈÅ∏È†ÖË®≠ÁΩÆ</label>
                                <div class="options-container">
                                    <div class="option-type-selector">
                                        <label class="radio-option">
                                            <input type="radio" name="optionType" value="binary" checked onchange="toggleOptionType()">
                                            <span class="radio-label">YES/NO ‰∫åÂÖÉÈÅ∏Êìá</span>
                                        </label>
                                        <label class="radio-option">
                                            <input type="radio" name="optionType" value="custom" onchange="toggleOptionType()">
                                            <span class="radio-label">Ëá™ÂÆöÁæ©ÈÅ∏È†ÖÔºà2ÂÄãÊàñ‰ª•‰∏äÔºâ</span>
                                        </label>
                                    </div>
                                    
                                    <div id="customOptions" style="display: none; margin-top: 1rem;">
                                        <div class="custom-options-header">
                                            <span style="color: #9ca3af; font-size: 0.9rem;">Ë´ãÊ∑ªÂä†Ëá≥Â∞ë2ÂÄãÈÅ∏È†ÖÔºö</span>
                                            <button type="button" class="btn btn-outline btn-sm" onclick="addOption()">+ Ê∑ªÂä†ÈÅ∏È†Ö</button>
                                        </div>
                                        <div id="optionsList">
                                            <!-- ÂãïÊÖãÁîüÊàêÁöÑÈÅ∏È†ÖËº∏ÂÖ•Ê°Ü -->
                                        </div>
                                        <div class="option-notice" style="color: #6b7280; font-size: 0.85rem; margin-top: 0.5rem;">
                                            ÊúÄÂ∞ëÈúÄË¶Å2ÂÄãÈÅ∏È†ÖÔºåÊúÄÂ§öÊîØÊè¥8ÂÄãÈÅ∏È†Ö
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Á¨¨‰∫åÈÉ®ÂàÜÔºöPumpË®≠ÂÆö -->
                        <div class="form-section" id="pumpSection">
                            <div class="section-header">
                                <h3 class="section-title">üöÄ PumpË®≠ÂÆö</h3>
                                <p class="section-subtitle">Ë®≠ÂÆöPKËΩâTradeÁöÑÊ¢ù‰ª∂</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">PumpËß∏ÁôºÊ¢ù‰ª∂ *</label>
                                <div class="input-group">
                                    <span class="input-label">Ë≥áÈáëÊ±†ÈÅîÂà∞</span>
                                    <input type="number" class="form-input" name="pumpCondition" value="1000" min="1000" step="100" required>
                                    <span class="input-unit">USDT</span>
                                </div>
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">ÊúÄÂ∞èÂÄºÁÇ∫1000 USDTÔºåÂª∫Ë≠∞Ë®≠ÂÆöÁÇ∫100ÁöÑÂÄçÊï∏</small>
                            </div>

                            <div class="pump-explanation">
                                <div class="explanation-title">üí° PK‚ÄìPump‚ÄìTrade Ê©üÂà∂Ë™™Êòé</div>
                                <ul class="explanation-list">
                                    <li><strong>PKÈöéÊÆµÔºö</strong>‰∏ÄÈñãÂßãÊòØPKÊ®°ÂºèÔºåÁé©ÂÆ∂ÈÅ∏„ÄåÊòØ„ÄçÊàñ„ÄåÂê¶„ÄçÔºå‰∫íÁõ∏ÊØîÊãºÊîØÊåÅÂäõÂ∫¶</li>
                                    <li><strong>PumpÈöéÊÆµÔºö</strong>Áï∂PKË≥áÈáëÈÅîÂà∞ÁõÆÊ®ôÔºåÁ≥ªÁµ±Ëá™ÂãïPumpÂçáÁ¥öÔºåÊääÈÉ®ÂàÜË≥áÈáëÊ≥®ÂÖ•‰∏ã‰∏ÄÈöéÊÆµÂ∏ÇÂ†¥</li>
                                    <li><strong>TradeÈöéÊÆµÔºö</strong>Ë©±È°åÂçáÁ¥öÁÇ∫ÂÖ¨Èñã‰∫§ÊòìÂ∏ÇÂ†¥Ôºå‰ªª‰Ωï‰∫∫ÈÉΩËÉΩÂèÉËàáÔºåÂÉπÊ†ºÁî±ÊºîÁÆóÊ≥ïËá™ÂãïË™øÊï¥</li>
                                    <li><strong>ÂõûÈ•ãÊ©üÂà∂Ôºö</strong>ÂÖ¨Èñã‰∫§ÊòìÁöÑÊâãÁ∫åË≤ª‰∏≠Ôºå40%ÊúÉÊåÅÁ∫åÂõûÈ•ãÁµ¶PKÈöéÊÆµÁöÑÁé©ÂÆ∂</li>
                                </ul>
                            </div>
                        </div>

                        <!-- Á¨¨‰∏âÈÉ®ÂàÜÔºöÊôÇÈñìË®≠ÂÆö -->
                        <div class="form-section">
                            <div class="section-header">
                                <h3 class="section-title">‚è∞ ÊôÇÈñìË®≠ÂÆö</h3>
                                <p class="section-subtitle">Ë®≠ÂÆöË©±È°åÁöÑÁîüÂëΩÈÄ±ÊúüÊôÇÈñì</p>
                            </div>

                            <div class="form-group">
                                <label class="form-label">PKÁµêÊùüÊôÇÈñì *</label>
                                <input type="datetime-local" class="form-input" name="tradingEndTime" required onchange="updateAdvancedSettings()">
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">Âú®Ê≠§ÊôÇÈñìÂÖßÂèØ‰ª•ÈÄ≤Ë°åPKÂ∞çÊ±∫ÔºåÂèØËß∏ÁôºPumpËΩâTrade</small>
                            </div>

                            <div class="form-group">
                                <label class="form-label">Ë©±È°åÁµêÊùüÊôÇÈñì *</label>
                                <input type="datetime-local" class="form-input" name="topicEndTime" required onchange="updateAdvancedSettings()">
                                <small style="color: #6b7280; margin-top: 0.5rem; display: block;">Ë©±È°åÁµêÊùüÂæåÊâÄÊúâ‰∫§ÊòìÂÅúÊ≠¢‰∏¶ÈÄ≤Ë°åÁµêÁÆóÔºåÈúÄÂ§ßÊñºPKÁµêÊùüÊôÇÈñì</small>
                            </div>

                            <div class="form-group">
                                <div class="checkbox-group">
                                    <input type="checkbox" id="showAdvanced" onchange="toggleAdvancedSettings()">
                                    <label for="showAdvanced" class="form-label" style="margin-bottom: 0;">È°ØÁ§∫È´òÁ¥öË®≠ÂÆö</label>
                                </div>
                            </div>

                            <div id="advancedSettings" style="display: none;">
                                <div class="form-group">
                                    <label class="form-label">TradeÁµêÊùüÊôÇÈñì</label>
                                    <input type="datetime-local" class="form-input" name="outerTradingEndTime">
                                    <small style="color: #6b7280; margin-top: 0.5rem; display: block;">ÁïôÁ©∫ÂâáËàáË©±È°åÁµêÊùüÊôÇÈñìÁõ∏Âêå„ÄÇË®≠ÂÆöÂæåÔºåTradeÂ∞áÂú®Ê≠§ÊôÇÈñìÂÅúÊ≠¢‰∫§Êòì‰ΩÜË©±È°åÁπºÁ∫åËá≥ÁµêÊùüÊôÇÈñì</small>
                                </div>
                            </div>
                        </div>

                        <div style="display: flex; gap: 1rem; justify-content: center; margin-top: 3rem;">
                            <button type="button" class="btn btn-secondary" onclick="showPage('home')">ÂèñÊ∂à</button>
                            <button type="submit" class="btn btn-primary">ÂâµÂª∫Ë©±È°å</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Ë©±È°åË©≥ÊÉÖÈ°µÈù¢ -->
        <div id="detail" class="page">
            <div class="content-area">
                <div class="topic-detail-container">
                    <div class="topic-header">
                        <div class="topic-avatar" id="detailAvatar">A</div>
                        <div class="topic-info">
                            <h1 class="topic-title" id="detailTitle">ËØùÈ¢òÊ†áÈ¢ò</h1>
                            <div class="topic-meta">
                                <span class="topic-category" id="detailCategory">Á±ªÂà´</span>
                                <span class="status-badge status-pk" id="detailStatus">PK‰∫§Êòì</span>
                                <span id="detailEndTime">ÁµêÊùüÊôÇÈñìÔºö2024-12-31 23:59</span>
                            </div>
                        </div>
                    </div>
                    
                    <div style="margin-top: 2rem; color: #9ca3af; line-height: 1.6;" id="detailDescription">
                        ËøôÈáåÊòæÁ§∫ËØùÈ¢òÁöÑËØ¶ÁªÜÊèèËø∞ÂÜÖÂÆπ...
                    </div>

                    <!-- ÂÉπÊ†ºËµ∞Âã¢ÂúñÂçÄÂüü (ÂÉÖTradeÈ°ØÁ§∫) -->
                    <div id="centerKlineSection" style="margin-top: 2rem; display: none;">
                        <div class="kline-chart-container">
                            <div class="chart-header">
                                <span class="chart-title">üìà ÂÉπÊ†ºËµ∞Âã¢Âúñ</span>
                                <div class="chart-controls">
                                    <button class="chart-btn active" onclick="switchTimeframe('1m')">1ÂàÜ</button>
                                    <button class="chart-btn" onclick="switchTimeframe('5m')">5ÂàÜ</button>
                                    <button class="chart-btn" onclick="switchTimeframe('1h')">1Â∞èÊôÇ</button>
                                </div>
                            </div>
                            <div id="centerKlineChart" class="line-chart"></div>
                        </div>
                    </div>

                    <!-- ÁçéÈáëÊ±†Áä∂ÊÄÅËØ¶ÊÉÖ -->
                    <div style="margin-top: 2rem;" id="poolDetailsSection">
                        <!-- ÁçéÈáëÊ±†‰ø°ÊÅØÂ∞ÜÈÄöËøáJavaScriptÂä®ÊÄÅÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>

        <!-- ÂÄã‰∫∫‰∏≠ÂøÉÈ°µÈù¢ -->
        <div id="profile" class="page">
            <div class="content-area">
                <h1 style="text-align: center; margin-bottom: 2rem; color: #ffffff; font-weight: 700; font-size: 1.75rem;">ÂÄã‰∫∫‰∏≠ÂøÉ</h1>
                
                <div class="profile-stats">
                    <div class="stat-card primary">
                        <h3>ÊåÅÂÄâÂÉπÂÄº</h3>
                        <div class="value" id="totalAssets">1,234.56 U</div>
                    </div>
                    <div class="stat-card positive">
                        <h3>Á∏ΩÁõàËôß</h3>
                        <div class="value" id="totalProfit">+234.56 U</div>
                    </div>
                    <div class="stat-card">
                        <h3>ÂèÉËàáË©±È°å</h3>
                        <div class="value" style="color: #60a5fa;" id="totalTopics">8</div>
                    </div>
                    <div class="stat-card">
                        <h3>Á∏Ω‰∫§ÊòìÈáè</h3>
                        <div class="value" style="color: #34d399;" id="totalTrades">30M U</div>
                    </div>
                </div>

                <!-- ÊåÅ‰ªìËÆ∞ÂΩï -->
                <div class="topic-detail-container" style="margin-bottom: 2rem;">
                    <h3 style="margin-bottom: 1.5rem; color: #ffffff; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #3b82f6;">üìä</span> Áï∂ÂâçÊåÅÂÄâ
                    </h3>
                    <div id="currentPositions">
                        <!-- ÊåÅ‰ªìÊï∞ÊçÆÂ∞ÜÈÄöËøáJavaScriptÁîüÊàê -->
                    </div>
                </div>

                <!-- ‰∫§ÊòìÊ≠∑Âè≤ -->
                <div class="topic-detail-container">
                    <h3 style="margin-bottom: 1.5rem; color: #ffffff; display: flex; align-items: center; gap: 0.5rem;">
                        <span style="color: #10b981;">üìà</span> ‰∫§ÊòìÊ≠∑Âè≤
                    </h3>
                    <div id="tradingHistory">
                        <!-- ‰∫§ÊòìÊ≠∑Âè≤Â∞ÜÈÄöËøáJavaScriptÁîüÊàê -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Âè≥‰æß‰∫§ÊòìÊ†è -->
    <div class="trading-sidebar hidden" id="tradingSidebar">
        <div class="trading-header">
            <div class="trading-title" id="tradingTitle">‰∫§ÊòìÈù¢Êùø</div>
            <div class="trading-subtitle" id="tradingSubtitle">ÈÅ∏ÊìáÊÇ®ÁöÑÈ¢ÑÊµãÂπ∂‰∏ãÊ≥®</div>
        </div>

        <!-- PK‰∫§ÊòìÁïåÈù¢ -->
        <div id="innerTrading" class="trading-section">
            <div class="section-title">Èô£ÁáüÂ∞çÊ±∫ - ÈÅ∏ÊìáÁ´ãÂ†¥</div>
            
            <!-- PKÂ∞çÊà∞ÁïåÈù¢ -->
            <div class="pk-arena">
                <div class="pk-side yes-side" onclick="selectOption('yes')">
                    <div class="pk-header">
                        <div class="pk-icon">üëç</div>
                        <div class="pk-label">YESÈô£Ááü</div>
                    </div>
                    <div class="pk-stats">
                        <div class="pk-amount" id="yesAmount">0 USDT</div>
                        <div class="pk-percentage" id="yesPercentage">0%</div>
                        <div class="pk-participants" id="yesParticipants">0‰∫∫</div>
                    </div>
                    <div class="pk-indicator" id="yesIndicator"></div>
                </div>
                
                <div class="pk-vs">
                    <div class="vs-text">VS</div>
                    <div class="vs-subtitle">Á´ãÂ†¥Â∞çÊ±∫</div>
                </div>
                
                <div class="pk-side no-side" onclick="selectOption('no')">
                    <div class="pk-header">
                        <div class="pk-icon">üëé</div>
                        <div class="pk-label">NOÈô£Ááü</div>
                    </div>
                    <div class="pk-stats">
                        <div class="pk-amount" id="noAmount">0 USDT</div>
                        <div class="pk-percentage" id="noPercentage">0%</div>
                        <div class="pk-participants" id="noParticipants">0‰∫∫</div>
                    </div>
                    <div class="pk-indicator" id="noIndicator"></div>
                </div>
            </div>

            <div class="amount-input-group">
                <div class="quick-amount-buttons">
                    <button class="quick-btn" onclick="setQuickAmount(100)">100</button>
                    <button class="quick-btn" onclick="setQuickAmount(500)">500</button>
                    <button class="quick-btn" onclick="setQuickAmount(1000)">1K</button>
                    <button class="quick-btn" onclick="setQuickAmount(5000)">5K</button>
                </div>
                <div class="input-with-balance">
                    <input type="number" class="amount-input" id="betAmount" placeholder="Ëº∏ÂÖ•‰∏ãÊ≥®ÈáëÈ°ç" min="1" step="1" oninput="checkInnerBalance()">
                    <div class="balance-display">
                        <span class="balance-label">È§òÈ°ç:</span>
                        <span class="balance-amount" id="userBalance">10,000 USDT</span>
                    </div>
                </div>
                <button class="btn btn-success" onclick="placeBet()" style="width: 100%;">Âä†ÂÖ•Èô£Ááü</button>
                <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; margin-top: 0.5rem; display: none;" id="rechargeBtn">üí∞ ÂÖÖÂÄº</button>
            </div>
        </div>

        <!-- Â§öÈÅ∏È†ÖPK‰∫§ÊòìÁïåÈù¢ -->
        <div id="multiOptionTrading" class="trading-section multi-option-trading">
            <div class="section-title">Â§öÈÅ∏È†ÖÈ†êÊ∏¨ - ÈÅ∏ÊìáÊúÄ‰Ω≥Á≠îÊ°à</div>
            
            <!-- Â§öÈÅ∏È†ÖÁ∂≤Ê†º -->
            <div class="multi-option-grid" id="multiOptionGrid">
                <!-- ÂãïÊÖãÁîüÊàêÈÅ∏È†ÖÂç°Áâá -->
            </div>

            <div class="amount-input-group">
                <div class="quick-amount-buttons">
                    <button class="quick-btn" onclick="setMultiOptionQuickAmount(100)">100</button>
                    <button class="quick-btn" onclick="setMultiOptionQuickAmount(500)">500</button>
                    <button class="quick-btn" onclick="setMultiOptionQuickAmount(1000)">1K</button>
                    <button class="quick-btn" onclick="setMultiOptionQuickAmount(5000)">5K</button>
                </div>
                <div class="input-with-balance">
                    <input type="number" class="amount-input" id="multiOptionAmount" placeholder="Ëº∏ÂÖ•‰∏ãÊ≥®ÈáëÈ°ç" min="1" step="1" oninput="checkInnerBalance()">
                    <div class="balance-display">
                        <span class="balance-label">È§òÈ°ç:</span>
                        <span class="balance-amount" id="multiUserBalance">10,000 USDT</span>
                    </div>
                </div>
                <button class="btn btn-success" onclick="placeBet()" style="width: 100%;">Á¢∫Ë™ç‰∏ãÊ≥®</button>
                <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; margin-top: 0.5rem; display: none;" id="multiRechargeBtn">üí∞ ÂÖÖÂÄº</button>
            </div>
        </div>

        <!-- Â§öÈÅ∏È†ÖTrade‰∫§ÊòìÁïåÈù¢ -->
        <div id="multiOptionOuter" class="trading-section multi-option-trading">
            <div class="section-title">Â§öÈÅ∏È†ÖLMSR‰∫§Êòì</div>
            
            <!-- ‰∫§ÊòìÊï∏ÈáèËº∏ÂÖ• -->
            <div class="amount-input-group">
                <div class="quick-amount-buttons">
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(10)">10</button>
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(50)">50</button>
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(100)">100</button>
                    <button class="quick-btn" onclick="setMultiLMSRQuickAmount(500)">500</button>
                </div>
                <div class="input-with-balance">
                    <input type="number" class="amount-input" id="multiLmsrAmount" placeholder="Ëº∏ÂÖ•‰∫§ÊòìÊï∏Èáè" min="0.1" step="0.1" oninput="checkLMSRBalance()">
                    <div class="balance-display">
                        <span class="balance-label">È§òÈ°ç:</span>
                        <span class="balance-amount" id="multiOuterUserBalance">10,000 USDT</span>
                    </div>
                </div>
            </div>

            <!-- Â§öÈÅ∏È†ÖLMSRÁ∂≤Ê†º -->
            <div class="multi-lmsr-grid" id="multiLmsrGrid">
                <!-- ÂãïÊÖãÁîüÊàêLMSRÈÅ∏È†ÖÂç°Áâá -->
            </div>
            
            <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; margin-top: 1rem; display: none;" id="multiOuterRechargeBtn">üí∞ ÂÖÖÂÄº</button>
        </div>

        <!-- Trade‰∫§ÊòìÁïåÈù¢ -->
        <div id="outerTrading" class="trading-section" style="display: none;">
            <div class="section-title">LMSR‰∫§Êòì</div>
            
            <!-- ÂÉπÊ†ºÊòæÁ§∫Âå∫Âüü -->
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 0.75rem; margin-bottom: 1.5rem;">
                <div class="price-card yes-price">
                    <div class="price-label">YES</div>
                    <div class="price-value" id="yesPriceDisplay">50.0%</div>
                    <div class="price-unit">ÂÉπÊ†º</div>
                </div>
                <div class="price-card no-price">
                    <div class="price-label">NO</div>
                    <div class="price-value" id="noPriceDisplay">50.0%</div>
                    <div class="price-unit">ÂÉπÊ†º</div>
                </div>
            </div>

            <!-- ‰∫§ÊòìË°®Âçï -->
            <div class="trading-form">
                <div class="form-group" style="margin-bottom: 1rem;">
                    <label style="display: block; margin-bottom: 0.5rem; color: #9ca3af; font-size: 0.85rem;">‰∫§ÊòìÊï∏Èáè</label>
                    <div class="quick-amount-buttons">
                        <button class="quick-btn" onclick="setLMSRQuickAmount(10)">10</button>
                        <button class="quick-btn" onclick="setLMSRQuickAmount(50)">50</button>
                        <button class="quick-btn" onclick="setLMSRQuickAmount(100)">100</button>
                        <button class="quick-btn" onclick="setLMSRQuickAmount(500)">500</button>
                    </div>
                    <div class="input-with-balance">
                        <input type="number" class="amount-input" id="lmsrAmount" placeholder="Ëº∏ÂÖ•‰∫§ÊòìÊï∏Èáè" min="0.1" step="0.1" oninput="checkLMSRBalance()">
                        <div class="balance-display">
                            <span class="balance-label">È§òÈ°ç:</span>
                            <span class="balance-amount" id="outerUserBalance">10,000 USDT</span>
                        </div>
                    </div>
                </div>
                
                <div class="trading-buttons">
                    <div style="margin-bottom: 1rem;">
                        <div style="text-align: center; margin-bottom: 0.5rem; color: #9ca3af; font-size: 0.85rem;">Ë≤∑ÂÖ•</div>
                        <button class="btn btn-success lmsr-buy-btn" onclick="buyLMSR('yes')" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>Ë≤∑ÂÖ• YES</span>
                            <small id="yesBuyInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">È†êË®àËä±Ë≤ª: 0 USDT</small>
                        </button>
                        <button class="btn btn-danger lmsr-buy-btn" onclick="buyLMSR('no')" style="width: 100%;">
                            <span>Ë≤∑ÂÖ• NO</span>
                            <small id="noBuyInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">È†êË®àËä±Ë≤ª: 0 USDT</small>
                        </button>
                    </div>
                    
                    <div>
                        <div style="text-align: center; margin-bottom: 0.5rem; color: #9ca3af; font-size: 0.85rem;">Ë≥£Âá∫</div>
                        <button class="btn btn-outline btn-success" onclick="sellLMSR('yes')" style="width: 100%; margin-bottom: 0.5rem;">
                            <span>Ë≥£Âá∫ YES</span>
                            <small id="yesSellInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">È†êË®àÊî∂ÂÖ•: 0 USDT</small>
                        </button>
                        <button class="btn btn-outline btn-danger" onclick="sellLMSR('no')" style="width: 100%;">
                            <span>Ë≥£Âá∫ NO</span>
                            <small id="noSellInfo" style="display: block; font-size: 0.75rem; opacity: 0.8;">È†êË®àÊî∂ÂÖ•: 0 USDT</small>
                        </button>
                    </div>
                </div>
                
                <button class="btn btn-outline recharge-btn" onclick="showRecharge()" style="width: 100%; margin-top: 1rem; display: none;" id="outerRechargeBtn">üí∞ ÂÖÖÂÄº</button>
            </div>
        </div>



                    <!-- ÊàëÁöÑÊåÅ‰ªì -->
            <div class="trading-section">
                <div class="section-title">ÊàëÁöÑÊåÅ‰ªì</div>
                
                <!-- TradeÊåÅÂÄâ -->
                <div class="pool-section" id="myOuterPositions" style="display: none;">
                    <div class="pool-section-header">
                        <span class="pool-section-title">TradeÊåÅÂÄâ</span>
                        <span class="pool-section-badge trade">LMSR‰ª£Âπ£</span>
                    </div>
                    <div class="pool-info">
                        <!-- Âä®ÊÄÅÁîüÊàêTradeÊåÅ‰ªì‰ø°ÊÅØ -->
                    </div>
                </div>

                <!-- PKÊåÅÂÄâ -->
                <div class="pool-section" id="myInnerPositions">
                    <div class="pool-section-header">
                        <span class="pool-section-title">PKÊåÅÂÄâ</span>
                        <span class="pool-section-badge">ÂéüÂßã‰∏ãÊ≥®</span>
                    </div>
                    <div class="pool-info">
                        <!-- Âä®ÊÄÅÁîüÊàêPKÊåÅ‰ªì‰ø°ÊÅØ -->
                    </div>
                </div>
            </div>

        <!-- ÂàÜ‰∫´ÊåâÈíÆ -->
        <div class="trading-section">
            <button class="btn btn-secondary" style="width: 100%;" onclick="shareLink()">
                üì§ ÂàÜ‰∫´ÈÄ£Áµê
            </button>
        </div>
    </div>



    <!-- Á¢∫Ë™çÊ®°ÊÄÅÊ°Ü -->
    <div id="confirmModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">Á¢∫Ë™ç‰∏ãÊ≥®</div>
            <div class="confirm-details">
                <div class="detail-row">
                    <span class="detail-label">ÈÅ∏È†ÖÔºö</span>
                    <span class="detail-value" id="confirmOption">YES <span id="confirmRatio">(65%)</span></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">‰∏ãÊ≥®È°çÔºö</span>
                    <span class="detail-value" id="confirmNetAmount">95.00 USDT</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ÊâãÁ∫åË≤ªÔºö</span>
                    <span class="detail-value" id="confirmFee">5.00 USDT (5%)</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Á∏ΩË≥áÈáëÊ±†Ôºö</span>
                    <span class="detail-value" id="confirmTotalPool">1,000 USDT</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-secondary" onclick="closeModal()">ÂèñÊ∂à</button>
                <button class="btn btn-primary" onclick="confirmBet()">Á¢∫Ë™ç</button>
            </div>
        </div>
    </div>

    <!-- ‰∏ãÂçïÊàêÂäüÊ®°ÊÄÅÊ°Ü -->
    <div id="successModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">‚úÖ ‰∏ãÊ≥®ÊàêÂäüÔºÅ</div>
            <div class="success-details">
                <div class="detail-row">
                    <span class="detail-label">ÈÅ∏È†ÖÔºö</span>
                    <span class="detail-value" id="successOption">YES <span id="successRatio">(65%)</span></span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">‰∏ãÊ≥®È°çÔºö</span>
                    <span class="detail-value" id="successNetAmount">95.00 USDT</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">ÊâãÁ∫åË≤ªÔºö</span>
                    <span class="detail-value" id="successFee">5.00 USDT</span>
                </div>
                <div class="detail-row">
                    <span class="detail-label">Á∏ΩË≥áÈáëÊ±†Ôºö</span>
                    <span class="detail-value" id="successTotalPool">1,000 USDT</span>
                </div>
            </div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closeSuccessModal()">Á¢∫ÂÆö</button>
            </div>
        </div>
    </div>

    <!-- PumpÈÄöÁü•Ê®°ÊÄÅÊ°Ü -->
    <div id="pumpModal" class="modal">
        <div class="modal-content">
            <div class="modal-title">üéâ PumpÊàêÂäüÔºÅ</div>
                            <div>ÊÅ≠ÂñúÔºÅËØùÈ¢òÂ∑≤ÊàêÂäü‰ªéPKËΩ¨Êç¢‰∏∫TradeÔºåÁé∞Âú®ÂèØ‰ª•ËøõË°åLMSR‰∫§Êòì‰∫ÜÔºÅ</div>
            <div class="modal-buttons">
                <button class="btn btn-primary" onclick="closePumpModal()">Êü•ÁúãTrade</button>
            </div>
        </div>
    </div>

    <script>
        // ÂÖ®Â±ÄÁä∂ÊÄÅÁÆ°ÁêÜ
        let currentPage = 'home';
        let selectedOption = null;
        let topics = [];
        let currentTopic = null;

        // Ê®°ÊãüÊï∞ÊçÆ
        const sampleTopics = [
            {
                id: 1,
                title: "ÊØîÁâπÂπ£ÂÉπÊ†ºÂú®2025Âπ¥Â∫ïËÉΩÂê¶Á™ÅÁ†¥15Ëê¨ÁæéÂÖÉÔºü",
                category: "crypto",
                categoryName: "Âä†ÂØÜË≤®Âπ£",
                avatar: "‚Çø",
                // PKÊï∞ÊçÆÔºàPumpÂâçÁöÑÂéüÂßã‰∏ãÊ≥®Ôºâ
                innerPool: {
                    yesAmount: 600,
                    noAmount: 400,
                    totalAmount: 1000
                },
                // TradeÊï∞ÊçÆÔºàLMSRÂ∫ïÊ±† + ‰∫§ÊòìÔºâ
                outerPool: {
                    basePool: 200, // ‰ªéPKÂ∞èÊñπ50%ËΩ¨ÂÖ•ÁöÑÂ∫ïÊ±†
                    yesAmount: 320, // Trade YES‰∫§ÊòìÈáè
                    noAmount: 280,  // Trade NO‰∫§ÊòìÈáè
                    totalAmount: 600, // ÂΩìÂâçËµÑÈáëÊ±†
                    totalVolume: 1500, // ÊÄªÊµÅÊ∞¥ÔºàÊâÄÊúâ‰∫§ÊòìÁöÑÁ¥ØËÆ°ÈáëÈ¢ùÔºâ
                    tradingFeeToInner: 12 // Trade‰∫§ÊòìÊâãÁ∫åË≤ªËΩ¨ÂÖ•PKÁöÑÈáëÈ¢ù
                },
                isOuter: true,
                endTime: "2025-12-31",
                status: "outer",
                description: "Èö®ËëóÊØîÁâπÂπ£ETFÁç≤ÊâπÂíåÊ©üÊßãÊé°Áî®Â¢ûÂä†ÔºåÊØîÁâπÂπ£ÂÉπÊ†ºÊòØÂê¶ËÉΩÂú®2025Âπ¥Â∫ïÁ™ÅÁ†¥Ê≠∑Âè≤Êñ∞È´ò15Ëê¨ÁæéÂÖÉÔºü",
                isPrivate: false,
                pumpCondition: 1000, // Ëá™ÂÆöÁæ©PumpÊ¢ù‰ª∂
                outerTradingEndTime: "2025-12-31", // Trade‰∫§ÊòìÁµêÊùüÊôÇÈñì
                // PKÊåÅÂÄâÔºàÂéüÂßã‰∏ãÊ≥®Ôºâ
                myInnerYes: 100,
                myInnerNo: 0,
                // TradeÊåÅÂÄâÔºàLMSR‰ª£Âπ£Ôºâ
                myOuterYes: 15,
                myOuterNo: 0,
                // Âπ≥ÂùáÂÉπÊ†ºË®òÈåÑ
                myOuterYesAvgPrice: 0.65,
                myOuterNoAvgPrice: 0.0
            },
            {
                id: 2,
                title: "2024Âπ¥ÁæéÂúãÁ∏ΩÁµ±Â§ßÈÅ∏ÁµêÊûúÈ†êÊ∏¨",
                category: "politics", 
                categoryName: "ÊîøÊ≤ªÈÄâ‰∏æ",
                avatar: "üó≥",
                innerPool: {
                    yesAmount: 800,
                    noAmount: 1200,
                    totalAmount: 2000
                },
                outerPool: {
                    basePool: 400, // ‰ªéPKÂ∞èÊñπ(YES)50%ËΩ¨ÂÖ•
                    yesAmount: 600,
                    noAmount: 800,
                    totalAmount: 1400,
                    totalVolume: 2800, // ÊÄªÊµÅÊ∞¥
                    tradingFeeToInner: 28
                },
                isOuter: true,
                endTime: "2024-11-05",
                status: "outer",
                description: "È†êÊ∏¨2024Âπ¥ÁæéÂúãÁ∏ΩÁµ±Â§ßÈÅ∏ÁöÑÁµêÊûúÔºåYES‰ª£Ë°®ÂÖ±ÂíåÈª®Áç≤ÂãùÔºåNO‰ª£Ë°®Ê∞ë‰∏ªÈª®Áç≤Âãù„ÄÇ",
                myInnerYes: 50,
                myInnerNo: 200,
                myOuterYes: 0,
                myOuterNo: 25
            },
            {
                id: 3,
                title: "OpenAI GPT-5ÊòØÂê¶ÊúÉÂú®2024Âπ¥ÁôºÂ∏ÉÔºü",
                category: "technology",
                categoryName: "ÁßëÊäÄÂèëÂ±ï", 
                avatar: "ü§ñ",
                innerPool: {
                    yesAmount: 200,
                    noAmount: 150,
                    totalAmount: 350
                },
                outerPool: null, // ËøòÊú™Pump
                isOuter: false,
                endTime: "2024-12-31",
                status: "inner",
                description: "OpenAIÊòØÂê¶ÊúÉÂú®2024Âπ¥ÂÜÖÁôºÂ∏ÉGPT-5Ê®°ÂûãÔºüÂü∫‰∫éÂΩìÂâçÁöÑÊäÄË°ìÂèëÂ±ïËøõÂ∫¶ÂíåÂÖ¨Âè∏ÂÖ¨ÂëäËøõË°åÈ¢ÑÊµã„ÄÇ",
                myInnerYes: 0,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            },
            {
                id: 4,
                title: "2024Âπ¥‰∏ñÁïåÁõÉÂÜ†ËªçÈ†êÊ∏¨",
                category: "sports",
                categoryName: "È´îËÇ≤Ë≥Ω‰∫ã",
                avatar: "‚öΩ",
                options: ["Â∑¥Ë•ø", "ÈòøÊ†πÂª∑", "Ê≥ïÂúã", "Âæ∑Âúã", "ÂÖ∂‰ªñ"],
                innerPool: {
                    option0Amount: 300,  // Â∑¥Ë•ø
                    option1Amount: 250,  // ÈòøÊ†πÂª∑
                    option2Amount: 200,  // Ê≥ïÂúã
                    option3Amount: 150,  // Âæ∑Âúã
                    option4Amount: 100,  // ÂÖ∂‰ªñ
                    totalAmount: 1000
                },
                outerPool: {
                    // ÂèñÊúÄÂ∞èÈÅ∏È†Ö(ÂÖ∂‰ªñ100)ÁöÑ50%‰ΩúÁÇ∫Â∫ïÊ±†
                    basePool: 50,
                    // Â§öÈÅ∏È†ÖTrade‰ΩøÁî®Âπ≥ÂùáÂàÜÈÖç‰ΩúÁÇ∫ÂàùÂßãÊµÅÂãïÊÄß
                    option0Amount: 120,  // Â∑¥Ë•øÂàùÂßã‰ªΩÈ°ç
                    option1Amount: 100,  // ÈòøÊ†πÂª∑ÂàùÂßã‰ªΩÈ°ç
                    option2Amount: 80,   // Ê≥ïÂúãÂàùÂßã‰ªΩÈ°ç
                    option3Amount: 60,   // Âæ∑ÂúãÂàùÂßã‰ªΩÈ°ç
                    option4Amount: 40,   // ÂÖ∂‰ªñÂàùÂßã‰ªΩÈ°ç
                    totalAmount: 400,
                    tradingFeeToInner: 0
                },
                isOuter: true,
                endTime: "2024-12-31",
                status: "outer",
                description: "È†êÊ∏¨2024Âπ¥‰∏ñÁïåÁõÉË∂≥ÁêÉË≥ΩÁöÑÂÜ†ËªçÈöä‰ºç„ÄÇÈÅ∏Êìá‰Ω†Ë™çÁÇ∫ÊúÄÊúâÂèØËÉΩÂ•™ÂÜ†ÁöÑÂúãÂÆ∂Èöä„ÄÇ",
                isPrivate: false,
                pumpCondition: 1000,
                myOption0: 50,  // ÊàëÂú®Â∑¥Ë•øÁöÑÊäïÊ≥®
                myOption1: 0,
                myOption2: 0,
                myOption3: 0,
                myOption4: 0,
                // TradeÂ§öÈÅ∏È†ÖÊåÅÂÄâÔºàLMSR‰ª£Âπ£Ôºâ
                myOuterOption0: 5,  // ÊàëÊåÅÊúâÁöÑÂ∑¥Ë•øLMSR‰ª£Âπ£
                myOuterOption1: 2,  // ÊàëÊåÅÊúâÁöÑÈòøÊ†πÂª∑LMSR‰ª£Âπ£
                myOuterOption2: 0,
                myOuterOption3: 0,
                myOuterOption4: 0
            },
            {
                id: 7,
                title: "2024Âπ¥Â•ßÊñØÂç°ÊúÄ‰Ω≥ÂΩ±ÁâáÁçéÈ†êÊ∏¨",
                category: "entertainment",
                categoryName: "Â®õÊ®ÇËóùË°ì",
                avatar: "üèÜ",
                options: ["Ê≤ô‰∏ò2", "Â•ßÊú¨Êµ∑Èªò", "Ëä±ÊúàÊÆ∫Êâã", "Ë≤ßÊ∞ëÁ™üÁôæËê¨ÂØåÁøÅÈáçË£ΩÁâà", "ÂÖ∂‰ªñ"],
                innerPool: {
                    option0Amount: 150,  // Ê≤ô‰∏ò2
                    option1Amount: 200,  // Â•ßÊú¨Êµ∑Èªò
                    option2Amount: 120,  // Ëä±ÊúàÊÆ∫Êâã
                    option3Amount: 80,   // Ë≤ßÊ∞ëÁ™üÁôæËê¨ÂØåÁøÅÈáçË£ΩÁâà
                    option4Amount: 50,   // ÂÖ∂‰ªñ
                    totalAmount: 600
                },
                outerPool: null, // ÈÇÑÊú™Pump
                isOuter: false,
                endTime: "2024-03-10",
                status: "inner",
                description: "2024Âπ¥Á¨¨96Â±ÜÂ•ßÊñØÂç°ÈáëÂÉèÁçéÊúÄ‰Ω≥ÂΩ±ÁâáÁçéËä±ËêΩË™∞ÂÆ∂ÔºüÂü∫ÊñºÂΩ±ÁâáË≥™Èáè„ÄÅÁ•®ÊàøË°®ÁèæÂíåÂ≠∏Èô¢ÂÅèÂ•ΩÈÄ≤Ë°åÈ†êÊ∏¨„ÄÇ",
                isPrivate: false,
                pumpCondition: 1000,
                // PKÂ§öÈÅ∏È†ÖÊåÅÂÄâ
                myOption0: 30,  // ÊàëÂú®Ê≤ô‰∏ò2ÁöÑÊäïÊ≥®
                myOption1: 0,   // ÊàëÂú®Â•ßÊú¨Êµ∑ÈªòÁöÑÊäïÊ≥®
                myOption2: 20,  // ÊàëÂú®Ëä±ÊúàÊÆ∫ÊâãÁöÑÊäïÊ≥®
                myOption3: 0,   // ÊàëÂú®Ë≤ßÊ∞ëÁ™üÁôæËê¨ÂØåÁøÅÈáçË£ΩÁâàÁöÑÊäïÊ≥®
                myOption4: 0    // ÊàëÂú®ÂÖ∂‰ªñÁöÑÊäïÊ≥®
            },
            {
                id: 6,
                title: "ÁâπÊñØÊãâËÇ°ÂÉπËÉΩÂê¶Âú®2024Âπ¥Ë∂ÖÈÅé300ÁæéÂÖÉÔºü",
                category: "economy",
                categoryName: "Á∂ìÊøüÈ¢ÑÊµã",
                avatar: "üöó",
                innerPool: {
                    yesAmount: 80,
                    noAmount: 120,
                    totalAmount: 200
                },
                outerPool: null,
                isOuter: false,
                endTime: "2024-12-31",
                status: "inner",
                description: "ËÄÉÊÖÆÂà∞ÈõªÂãïËªäÂ∏ÇÂ†¥Á´∂Áà≠ÂíåÁâπÊñØÊãâÁöÑÊ•≠ÂãôÁôºÂ±ïÔºåÂÖ∂ËÇ°ÂÉπÊòØÂê¶ËÉΩÂú®2024Âπ¥Á™ÅÁ†¥300ÁæéÂÖÉÔºü",
                myInnerYes: 50,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            }
        ];

        // È°µÈù¢ÂàáÊç¢
        function showPage(pageId) {
            // Êõ¥Êñ∞È°µÈù¢ÊòæÁ§∫
            document.querySelectorAll('.page').forEach(page => {
                page.classList.remove('active');
            });
            const targetPage = document.getElementById(pageId);
            if (targetPage) {
                targetPage.classList.add('active');
            }
            
            // Êõ¥Êñ∞ÂØºËà™Áä∂ÊÄÅ
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            
            // Ê†πÊçÆÈ°µÈù¢ËÆæÁΩÆÂØπÂ∫îÁöÑÂØºËà™È°π‰∏∫Ê¥ªË∑ÉÁä∂ÊÄÅ
            const navMap = {
                'home': 0,
                'inner': 1,
                'create': 2,
                'profile': 3
            };
            if (navMap[pageId] !== undefined) {
                document.querySelectorAll('.nav-item')[navMap[pageId]].classList.add('active');
            }
            
            currentPage = pageId;

            // ÊéßÂà∂‰∫§ÊòìÊ†èÊòæÁ§∫
            const tradingSidebar = document.getElementById('tradingSidebar');
            if (pageId === 'detail') {
                tradingSidebar.classList.remove('hidden');
            } else {
                tradingSidebar.classList.add('hidden');
            }

            if (pageId === 'home') {
                renderTopics();
            } else if (pageId === 'inner') {
                renderInnerTopics();
            } else if (pageId === 'profile') {
                renderProfileData();
            }
        }

        // Ê∏≤ÊüìËØùÈ¢òÁÄëÂ∏ÉÊµÅ
        function renderTopics() {
            const waterfall = document.getElementById('topicWaterfall');
            waterfall.innerHTML = '';

            sampleTopics.filter(topic => topic.status === 'outer').forEach(topic => {
                const card = document.createElement('div');
                card.className = 'topic-card';
                card.onclick = () => showTopicDetail(topic.id);
                
                // ËÆ°ÁÆóTradeÊÄªÁçéÈáëÊ±†
                const outerTotalPool = topic.outerPool.basePool + topic.outerPool.totalAmount;
                const isMultiOption = topic.options && topic.options.length > 2;
                
                // Ë®àÁÆóÈ†òÂÖàÈÅ∏È†Ö
                let leadingOption = 'YES';
                let leadingPercentage = '50.0';
                
                if (isMultiOption) {
                    // Â§öÈÅ∏È†ÖTradeÔºàÊú™‰æÜÊì¥Â±ïÔºâ
                    leadingOption = topic.options[0] || 'ÈÅ∏È†Ö1';
                    leadingPercentage = '20.0';  // Á∞°ÂñÆÂπ≥Âùá
                } else {
                    // ‰∫åÂÖÉÈÅ∏È†Ö
                    const yesAmount = topic.outerPool.yesAmount || 0;
                    const totalAmount = topic.outerPool.totalAmount || 1;
                    leadingPercentage = ((yesAmount / totalAmount) * 100).toFixed(1);
                    if (yesAmount < (topic.outerPool.noAmount || 0)) {
                        leadingOption = 'NO';
                        leadingPercentage = (((topic.outerPool.noAmount || 0) / totalAmount) * 100).toFixed(1);
                    }
                }
                
                card.innerHTML = `
                    <div class="topic-header">
                        <div class="topic-avatar">${topic.avatar}</div>
                        <div class="topic-info">
                            <h3>${topic.title}</h3>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="topic-category">${topic.categoryName}</div>
                                ${isMultiOption ? '<span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 500;">Â§öÈÅ∏È†Ö</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="topic-stats">
                        <div class="stat">
                            <div class="stat-value">${outerTotalPool}</div>
                            <div class="stat-label">TradeÊÄªÊ±†(USDT)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${leadingPercentage}%</div>
                            <div class="stat-label">${leadingOption}È†òÂÖà</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${topic.endTime}</div>
                            <div class="stat-label">ÁµêÊùüÊôÇÈñì</div>
                        </div>
                    </div>
                `;
                

                waterfall.appendChild(card);
            });
            

        }

        // Ê∏≤ÊüìPKË©±È°åÁÄëÂ∏ÉÊµÅ
        function renderInnerTopics() {
            const waterfall = document.getElementById('innerTopicWaterfall');
            waterfall.innerHTML = '';

            const pkTopics = sampleTopics.filter(topic => topic.status === 'inner');

            pkTopics.forEach(topic => {
                const card = document.createElement('div');
                card.className = 'topic-card';
                card.onclick = () => showTopicDetail(topic.id);
                
                // Ë®àÁÆóPKË≥áÈáëÊ±†‰ø°ÊÅØ
                const pkTotalPool = topic.innerPool.totalAmount;
                const isMultiOption = topic.options && topic.options.length > 2;
                const pumpThreshold = topic.pumpCondition || 1000;
                const pumpProgress = Math.min((pkTotalPool / pumpThreshold) * 100, 100).toFixed(1);
                
                // Ë®àÁÆóÂà∞PumpÈÇÑÈúÄÂ§öÂ∞ë
                const pumpRemaining = Math.max(pumpThreshold - pkTotalPool, 0);
                
                // Ë®àÁÆóÊúÄÂèóÊ≠°ËøéÁöÑÈÅ∏È†Ö
                let leadingOption = 'YES';
                let leadingPercentage = '50.0';
                
                if (isMultiOption) {
                    let maxAmount = 0;
                    let maxIndex = 0;
                    for (let i = 0; i < topic.options.length; i++) {
                        const amount = topic.innerPool[`option${i}Amount`] || 0;
                        if (amount > maxAmount) {
                            maxAmount = amount;
                            maxIndex = i;
                        }
                    }
                    leadingOption = topic.options[maxIndex] || 'ÈÅ∏È†Ö1';
                    leadingPercentage = pkTotalPool > 0 ? ((maxAmount / pkTotalPool) * 100).toFixed(1) : '0.0';
                } else {
                    const yesAmount = topic.innerPool.yesAmount || 0;
                    leadingPercentage = pkTotalPool > 0 ? ((yesAmount / pkTotalPool) * 100).toFixed(1) : '50.0';
                    if (yesAmount < (topic.innerPool.noAmount || 0)) {
                        leadingOption = 'NO';
                        leadingPercentage = pkTotalPool > 0 ? (((topic.innerPool.noAmount || 0) / pkTotalPool) * 100).toFixed(1) : '50.0';
                    }
                }
                
                card.innerHTML = `
                    <div class="topic-header">
                        <div class="topic-avatar">${topic.avatar}</div>
                        <div class="topic-info">
                            <h3>${topic.title}</h3>
                            <div style="display: flex; align-items: center; gap: 0.5rem;">
                                <div class="topic-category">${topic.categoryName}</div>
                                ${isMultiOption ? '<span style="background: #059669; color: white; padding: 2px 6px; border-radius: 4px; font-size: 0.7rem; font-weight: 500;">Â§öÈÅ∏È†Ö</span>' : ''}
                            </div>
                        </div>
                    </div>
                    <div class="topic-stats">
                        <div class="stat">
                            <div class="stat-value">${pkTotalPool}</div>
                            <div class="stat-label">PKÁ∏ΩÊ±†(USDT)</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${leadingPercentage}%</div>
                            <div class="stat-label">${leadingOption}È†òÂÖà</div>
                        </div>
                        <div class="stat">
                            <div class="stat-value">${pumpProgress}%</div>
                            <div class="stat-label">PumpÈÄ≤Â∫¶</div>
                        </div>
                    </div>
                    <div class="topic-progress">
                        <div style="font-size: 0.8rem; color: #9ca3af; margin-bottom: 0.5rem;">
                            Ë∑ùÈõ¢PumpÈÇÑÈúÄ: <strong style="color: #f59e0b;">${pumpRemaining} USDT</strong>
                        </div>
                        <div style="background: #374151; border-radius: 4px; height: 6px; overflow: hidden;">
                            <div style="background: linear-gradient(90deg, #10b981, #059669); height: 100%; width: ${pumpProgress}%; transition: width 0.3s ease;"></div>
                        </div>
                    </div>
                `;
                
                waterfall.appendChild(card);
            });

            // Â¶ÇÊûúÊ≤íÊúâPKË©±È°åÔºåÈ°ØÁ§∫Á©∫ÁãÄÊÖã
            if (waterfall.children.length === 0) {
                waterfall.innerHTML = `
                    <div style="text-align: center; padding: 3rem; color: #6b7280;">
                        <div style="font-size: 3rem; margin-bottom: 0.5rem;">üìä</div>
                        <h3 style="margin-bottom: 0.5rem;">Êö´ÁÑ°PKË©±È°å</h3>
                        <p>ÊâÄÊúâË©±È°åÈÉΩÂ∑≤ÈÄ≤ÂÖ•TradeÈöéÊÆµÔºåÊàñÂâµÂª∫Êñ∞Ë©±È°åÈñãÂßã‰∫§Êòì</p>
                    </div>
                `;
            }
        }

        // ÊòæÁ§∫Ë©±È°åË©≥ÊÉÖ
        function showTopicDetail(topicId) {
            currentTopic = sampleTopics.find(t => t.id === topicId) || {
                id: topicId,
                title: "Êñ∞ËØùÈ¢ò",
                category: "other",
                categoryName: "ÂÖ∂‰ªñ",
                avatar: "üí°",
                innerPool: {
                    yesAmount: 0,
                    noAmount: 0,
                    totalAmount: 0
                },
                outerPool: null,
                isOuter: false,
                endTime: "2024-12-31",
                status: "inner",
                description: "ËøôÊòØ‰∏Ä‰∏™Êñ∞ÂàõÂª∫ÁöÑËØùÈ¢ò",
                myInnerYes: 0,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            };

            // Êõ¥Êñ∞È°µÈù¢ÂÜÖÂÆπ
            document.getElementById('detailTitle').textContent = currentTopic.title;
            document.getElementById('detailCategory').textContent = currentTopic.categoryName;
            document.getElementById('detailAvatar').textContent = currentTopic.avatar;
            document.getElementById('detailEndTime').textContent = `ÁµêÊùüÊôÇÈñìÔºö${currentTopic.endTime}`;
            document.getElementById('detailDescription').textContent = currentTopic.description || currentTopic.title;
            
            // Ê†πÊçÆËØùÈ¢òÁä∂ÊÄÅÊõ¥Êñ∞‰∫§ÊòìÊ†è
            updateTradingInterface();
            updatePoolDisplay();
            showPage('detail');
        }

        // Êõ¥Êñ∞‰∫§ÊòìÁïåÈù¢
        function updateTradingInterface() {
            if (!currentTopic) return;
            
            const isOuter = currentTopic.status === 'outer';
            const tradingTitle = document.getElementById('tradingTitle');
            const tradingSubtitle = document.getElementById('tradingSubtitle');
            const statusBadge = document.getElementById('detailStatus');
            const innerTrading = document.getElementById('innerTrading');
            const outerTrading = document.getElementById('outerTrading');
            const multiOptionTrading = document.getElementById('multiOptionTrading');
            const multiOptionOuter = document.getElementById('multiOptionOuter');
            const centerKlineSection = document.getElementById('centerKlineSection');
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;

            // Èö±ËóèÊâÄÊúâ‰∫§ÊòìÁïåÈù¢
            innerTrading.style.display = 'none';
            outerTrading.style.display = 'none';
            if (multiOptionTrading) multiOptionTrading.style.display = 'none';
            if (multiOptionOuter) multiOptionOuter.style.display = 'none';

            if (isOuter) {
                // TradeÁä∂ÊÄÅ
                tradingTitle.textContent = 'LMSR‰∫§Êòì';
                tradingSubtitle.textContent = 'Âü∫‰∫éÂ∏ÇÂú∫ÂÉπÊ†ºÁöÑÈ¢ÑÊµãÂ∏ÇÂú∫‰∫§Êòì';
                statusBadge.textContent = 'Trade‰∫§Êòì';
                statusBadge.className = 'status-badge status-trade';
                
                if (isMultiOption) {
                    if (multiOptionOuter) multiOptionOuter.style.display = 'block';
                    updateMultiLMSRInterface();
                } else {
                    outerTrading.style.display = 'block';
                    updateLMSRPrices();
                }
                
                // È°ØÁ§∫‰∏≠ÈñìÂçÄÂüüÁöÑKÁ∑öÂúñ
                if (centerKlineSection) {
                    centerKlineSection.style.display = 'block';
                }
                
                // Êõ¥Êñ∞LMSRÂÉπÊ†ºÊòæÁ§∫
                updateLMSRPrices();
                
                // ÂàùÂßãÂåñÂÉπÊ†ºËµ∞Âã¢Âúñ
                setTimeout(() => {
                    initKlineChart();
                }, 100);
            } else {
                // PKÁä∂ÊÄÅ
                statusBadge.textContent = 'PK‰∫§Êòì';
                statusBadge.className = 'status-badge status-pk';
                
                if (isMultiOption) {
                    tradingTitle.textContent = 'Â§öÈÅ∏È†ÖÈ†êÊ∏¨';
                    tradingSubtitle.textContent = 'ÈÅ∏ÊìáÊúÄ‰Ω≥Á≠îÊ°àÔºåÈ†êË¶ãÊú™‰æÜ';
                    if (multiOptionTrading) multiOptionTrading.style.display = 'block';
                    updateMultiOptionInterface();
                } else {
                    tradingTitle.textContent = 'È†êÊ∏¨Â∞çÊ±∫';
                    tradingSubtitle.textContent = 'ÈÅ∏ÊìáÁ´ãÂ†¥ÔºåÈ†êË¶ãÊú™‰æÜ';
                    innerTrading.style.display = 'block';
                    updatePKInterface();
                }
                
                // Èö±Ëóè‰∏≠ÈñìÂçÄÂüüÁöÑKÁ∑öÂúñ
                if (centerKlineSection) {
                    centerKlineSection.style.display = 'none';
                }
                
                // Êõ¥Êñ∞PKÁïåÈù¢Êï∏Êìö
                updatePKInterface();
                
                // Ê£ÄÊü•ÊòØÂê¶Êé•ËøëPumpÊù°‰ª∂
                if (currentTopic.totalPool >= 800) {
                    tradingSubtitle.textContent = 'Âç≥Â∞ÜËææÂà∞PumpÊù°‰ª∂ÔºÅ';
                    tradingSubtitle.style.color = '#f59e0b';
                } else {
                    tradingSubtitle.style.color = '#6b7280';
                }
            }
        }

        // Êõ¥Êñ∞LMSRÂÉπÊ†ºÊòæÁ§∫
        function updateLMSRPrices() {
            if (!currentTopic || currentTopic.status !== 'outer' || !currentTopic.outerPool) return;

                            // ‰ΩøÁî®TradeÊï∞ÊçÆËÆ°ÁÆóLMSRÂÉπÊ†º
                const tradePool = currentTopic.outerPool;
                const totalAmount = tradePool.totalAmount;
                const yesAmount = tradePool.yesAmount;
                const noAmount = tradePool.noAmount;
                
                // Âü∫Êú¨ÂÉπÊ†ºËÆ°ÁÆóÔºàÂü∫‰∫éTradeÁçéÈáëÊ±†ÊØî‰æãÔºâ
                const yesPrice = yesAmount / totalAmount;
                const noPrice = noAmount / totalAmount;

            // Êõ¥Êñ∞ÂÉπÊ†ºÊòæÁ§∫ÔºàÁôæÂàÜÊØîÊ†ºÂºèÔºâ
            document.getElementById('yesPriceDisplay').textContent = `${(yesPrice * 100).toFixed(1)}%`;
            document.getElementById('noPriceDisplay').textContent = `${(noPrice * 100).toFixed(1)}%`;

            // ÁõëÂê¨Êï∞ÈáèËº∏ÂÖ•ÂèòÂåñÔºåÊõ¥Êñ∞È†êË®àËä±Ë≤ªÂíåÊî∂ÂÖ•
            const amountInput = document.getElementById('lmsrAmount');
            const updateCostInfo = () => {
                const amount = parseFloat(amountInput.value) || 0;
                const yesCostBase = amount * yesPrice;
                const noCostBase = amount * noPrice;
                
                // ÂåÖÂê´5%ÊâãÁ∫åË≤ªÁöÑÊÄªÊàêÊú¨ÔºàË≤∑ÂÖ•Ôºâ
                const yesCostTotal = (yesCostBase * 1.05).toFixed(2);
                const noCostTotal = (noCostBase * 1.05).toFixed(2);
                
                // Êâ£Èô§5%ÊâãÁ∫åË≤ªÁöÑÂáÄÊî∂ÂÖ•ÔºàË≥£Âá∫Ôºâ
                const yesRevenueTotal = (yesCostBase * 0.95).toFixed(2);
                const noRevenueTotal = (noCostBase * 0.95).toFixed(2);
                
                // Êõ¥Êñ∞Ë≤∑ÂÖ•‰ø°ÊÅØ
                document.getElementById('yesBuyInfo').textContent = `È†êË®àËä±Ë≤ª: ${yesCostTotal} USDT `;
                document.getElementById('noBuyInfo').textContent = `È†êË®àËä±Ë≤ª: ${noCostTotal} USDT `;
                
                // Êõ¥Êñ∞Ë≥£Âá∫‰ø°ÊÅØ
                document.getElementById('yesSellInfo').textContent = `È†êË®àÊî∂ÂÖ•: ${yesRevenueTotal} USDT`;
                document.getElementById('noSellInfo').textContent = `È†êË®àÊî∂ÂÖ•: ${noRevenueTotal} USDT`;
            };

            // ÁªëÂÆöËº∏ÂÖ•‰∫ã‰ª∂
            amountInput.removeEventListener('input', updateCostInfo);
            amountInput.addEventListener('input', updateCostInfo);
            
            // ÂàùÂßãÊõ¥Êñ∞
            updateCostInfo();
        }

        // LMSRË≤∑ÂÖ•ÂäüËÉΩ
        function buyLMSR(option) {
                    if (!currentTopic || currentTopic.status !== 'outer' || !currentTopic.outerPool) {
            alert('Âè™ËÉΩÂú®TradeÁä∂ÊÄÅ‰∏ãËøõË°åLMSR‰∫§Êòì');
            return;
        }

            const amount = parseFloat(document.getElementById('lmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ‰∫§ÊòìÊï∏Èáè');
                return;
            }

            // Ë®àÁÆó‰∫§ÊòìÊàêÊú¨
            const yesPrice = currentTopic.outerPool.yesAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount) || 0.5;
            const noPrice = 1 - yesPrice;
            const priceBase = option === 'yes' ? yesPrice : noPrice;
            const cost = amount * priceBase * 1.05; // ÂåÖÂê´5%ÊâãÁ∫åË≤ª

            // Ê™¢Êü•È§òÈ°ç
            if (cost > userBalance) {
                const shortage = cost - userBalance;
                const shouldRecharge = confirm(`üí∞ È§òÈ°ç‰∏çË∂≥ÔºåÁÑ°Ê≥ïÂÆåÊàê‰∫§Êòì\n\nÈúÄË¶ÅÈáëÈ°ç: ${cost.toFixed(2)} USDT\nÁï∂ÂâçÈ§òÈ°ç: ${userBalance.toFixed(2)} USDT\n‰∏çË∂≥ÈáëÈ°ç: ${shortage.toFixed(2)} USDT\n\nÊòØÂê¶Á´ãÂç≥ÂÖÖÂÄºÔºü`);
                
                if (shouldRecharge) {
                    showRecharge();
                } else {
                    // È°ØÁ§∫ÂÖÖÂÄºÊåâÈàï
                    const outerRechargeBtn = document.getElementById('outerRechargeBtn');
                    if (outerRechargeBtn) outerRechargeBtn.style.display = 'block';
                }
                
                return;
            }

            // ËÆ°ÁÆó5%ÊâãÁ∫åË≤ª
            const tradingFee = cost * 0.05;
            const netCost = cost - tradingFee;

            // Ë®àÁÆóÂπ≥ÂùáÂÉπÊ†ºÔºà‰∏çÂåÖÂê´ÊâãÁ∫åË≤ªÔºâ
            const averagePrice = netCost / amount;
            
            // Ë®àÁÆóÊΩõÂú®Êî∂ÁõäÔºàË≥ºË≤∑ÁöÑ‰ª£Âπ£Â¶ÇÊûúË¥è‰∫ÜËÉΩÁç≤ÂæóÁöÑÁ∏ΩÈáëÈ°çÔºâ
            const potentialProfit = amount; // Â¶ÇÊûúËµ¢‰∫ÜÔºåÊØè‰∏™‰ª£Â∏Å‰ª∑ÂÄº1 USDTÔºåÊâÄ‰ª•ÊÄªÊî∂ÁõäÊòØ‰ª£Â∏ÅÊï∞Èáè
            
            // Á¢∫Ë™ç‰∫§Êòì
            if (confirm(`Á¢∫Ë™çË≤∑ÂÖ• ${amount} ‰∏™ ${option.toUpperCase()} ‰ª£Âπ£Ôºü\nÂπ≥ÂùáÂÉπÊ†º: ${(averagePrice * 100).toFixed(1)}%\nÁ∏ΩËä±Ë≤ª: ${cost.toFixed(2)} USDT\nÊâãÁ∫åË≤ª: ${tradingFee.toFixed(2)} USDT\nÊΩõÂú®Êî∂Áõä: ${potentialProfit.toFixed(2)} USDT`)) {
                
                // Êâ£Èô§È§òÈ°ç
                userBalance -= cost;
                // Êõ¥Êñ∞TradeÊåÅÂÄâÂíåÂπ≥ÂùáÂÉπÊ†º
                if (option === 'yes') {
                    const currentYes = currentTopic.myOuterYes || 0;
                    const currentYesAvg = currentTopic.myOuterYesAvgPrice || 0;
                    const newTotal = currentYes + amount;
                    // Ë®àÁÆóÊñ∞ÁöÑÂπ≥ÂùáÂÉπÊ†º
                    currentTopic.myOuterYesAvgPrice = currentYes > 0 ? 
                        ((currentYes * currentYesAvg) + (amount * priceBase)) / newTotal : priceBase;
                    currentTopic.myOuterYes = newTotal;
                } else {
                    const currentNo = currentTopic.myOuterNo || 0;
                    const currentNoAvg = currentTopic.myOuterNoAvgPrice || 0;
                    const newTotal = currentNo + amount;
                    // Ë®àÁÆóÊñ∞ÁöÑÂπ≥ÂùáÂÉπÊ†º
                    currentTopic.myOuterNoAvgPrice = currentNo > 0 ? 
                        ((currentNo * currentNoAvg) + (amount * priceBase)) / newTotal : priceBase;
                    currentTopic.myOuterNo = newTotal;
                }

                // Êõ¥Êñ∞TradeÁçéÈáëÊ±†ÂíåÊÄªÊµÅÊ∞¥
                currentTopic.outerPool.totalAmount += netCost;
                currentTopic.outerPool.totalVolume = (currentTopic.outerPool.totalVolume || 0) + cost; // ÊÄªÊµÅÊ∞¥ÂåÖÂê´ÊâãÁª≠Ë¥π
                if (option === 'yes') {
                    currentTopic.outerPool.yesAmount += netCost;
                } else {
                    currentTopic.outerPool.noAmount += netCost;
                }

                // ÊâãÁ∫åË≤ªÁöÑ40%ÂõûÊµÅÂà∞PK
                const feeToPK = tradingFee * 0.4;
                currentTopic.outerPool.tradingFeeToInner += feeToPK;

                // Êõ¥Êñ∞sampleTopics‰∏≠ÁöÑÊï∞ÊçÆ
                const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
                if (topicIndex !== -1) {
                    sampleTopics[topicIndex] = {...currentTopic};
                }

                // Êõ¥Êñ∞ÊòæÁ§∫
                updateLMSRPrices();
                updatePoolDisplay();

                // Ê∏ÖÁ©∫Ëº∏ÂÖ•
                document.getElementById('lmsrAmount').value = '';

                // Êõ¥Êñ∞È§òÈ°çÈ°ØÁ§∫
                updateBalanceDisplay();

                alert(`‰∫§ÊòìÊàêÂäüÔºÅ\nË≤∑ÂÖ•: ${amount} ‰∏™ ${option.toUpperCase()}\nÂπ≥ÂùáÂÉπÊ†º: ${(averagePrice * 100).toFixed(1)}%\nÁ∏ΩËä±Ë≤ª: ${cost.toFixed(2)} USDT\nÊâãÁ∫åË≤ª: ${tradingFee.toFixed(2)} USDT\nÊΩõÂú®Êî∂Áõä: ${potentialProfit.toFixed(2)} USDT `);
            }
        }

        // LMSRË≥£Âá∫ÂáΩÊï∏
        function sellLMSR(option) {
                    if (!currentTopic || currentTopic.status !== 'outer' || !currentTopic.outerPool) {
            alert('Âè™ËÉΩÂú®TradeÁãÄÊÖã‰∏ãÈÄ≤Ë°åLMSR‰∫§Êòì');
            return;
        }

            const amount = parseFloat(document.getElementById('lmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ‰∫§ÊòìÊï∏Èáè');
                return;
            }

            // Ê™¢Êü•ÊåÅÂÄâÊòØÂê¶Ë∂≥Â§†
            const currentHolding = option === 'yes' ? (currentTopic.myOuterYes || 0) : (currentTopic.myOuterNo || 0);
            if (amount > currentHolding) {
                alert(`ÊåÅÂÄâ‰∏çË∂≥ÔºÅÊÇ®ÁõÆÂâçÊåÅÊúâ ${currentHolding} ÂÄã ${option.toUpperCase()} ‰ª£Âπ£`);
                return;
            }

            // Ë®àÁÆóË≥£Âá∫Êî∂ÂÖ•Ôºà‰ªéÊï∞ÊçÆÊ∫êËé∑Âèñ‰ª∑Ê†ºËÄå‰∏çÊòØÊòæÁ§∫ÊñáÊú¨Ôºâ
            const yesPrice = currentTopic.outerPool.yesAmount / currentTopic.outerPool.totalAmount;
            const noPrice = currentTopic.outerPool.noAmount / currentTopic.outerPool.totalAmount;
            const revenue = option === 'yes' ? amount * yesPrice : amount * noPrice;

            // Ë®àÁÆó2%ÊâãÁ∫åË≤ª
            const tradingFee = revenue * 0.05;
            const netRevenue = revenue - tradingFee;

            // Ë®àÁÆóÂπ≥ÂùáÂÉπÊ†ºÔºà‰∏çÂåÖÂê´ÊâãÁ∫åË≤ªÔºâ
            const averagePrice = netRevenue / amount;
            
            // Ë®àÁÆóÁï∂ÂâçÂÉπÊ†ºÁî®ÊñºÈ°ØÁ§∫
            const currentPrice = option === 'yes' ? 
                currentTopic.outerPool.yesAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount) :
                currentTopic.outerPool.noAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount);
            
            // Á¢∫Ë™ç‰∫§Êòì
            if (confirm(`Á¢∫Ë™çË≥£Âá∫ ${amount} ÂÄã ${option.toUpperCase()} ‰ª£Âπ£Ôºü\nÂπ≥ÂùáÂÉπÊ†º: ${(averagePrice * 100).toFixed(1)}%\nÁï∂ÂâçÂÉπÊ†º: ${(currentPrice * 100).toFixed(1)}%\nÁ∏ΩÊî∂ÂÖ•: ${revenue.toFixed(2)} USDT\nÊâãÁ∫åË≤ª: ${tradingFee.toFixed(2)} USDT`)) {
                // Êõ¥Êñ∞TradeÊåÅÂÄâ
                if (option === 'yes') {
                    currentTopic.myOuterYes = (currentTopic.myOuterYes || 0) - amount;
                } else {
                    currentTopic.myOuterNo = (currentTopic.myOuterNo || 0) - amount;
                }

                // Êõ¥Êñ∞TradeË≥áÈáëÊ±†ÔºàÂæûÊ±†‰∏≠ÂèñÂá∫Ë≥áÈáëÔºâÂíåÊÄªÊµÅÊ∞¥
                currentTopic.outerPool.totalAmount -= netRevenue;
                currentTopic.outerPool.totalVolume = (currentTopic.outerPool.totalVolume || 0) + revenue; // ÊÄªÊµÅÊ∞¥ÂåÖÂê´ÊâãÁª≠Ë¥π
                if (option === 'yes') {
                    currentTopic.outerPool.yesAmount -= netRevenue;
                } else {
                    currentTopic.outerPool.noAmount -= netRevenue;
                }

                // ÊâãÁ∫åË≤ªÁöÑ40%ÂõûÊµÅÂà∞PK
                const feeToPK = tradingFee * 0.4;
                currentTopic.outerPool.tradingFeeToInner += feeToPK;

                // Êõ¥Êñ∞sampleTopics‰∏≠ÁöÑÊï∏Êìö
                const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
                if (topicIndex !== -1) {
                    sampleTopics[topicIndex] = {...currentTopic};
                }

                // Êõ¥Êñ∞È°ØÁ§∫
                updateLMSRPrices();
                updatePoolDisplay();

                // Ê∏ÖÁ©∫Ëº∏ÂÖ•
                document.getElementById('lmsrAmount').value = '';

                // Â¢ûÂä†È§òÈ°çÔºàË≥£Âá∫Êî∂ÂÖ•Ôºâ
                userBalance += netRevenue;
                updateBalanceDisplay();

                alert(`‰∫§ÊòìÊàêÂäüÔºÅ\nË≥£Âá∫: ${amount} ÂÄã ${option.toUpperCase()}\nÂπ≥ÂùáÂÉπÊ†º: ${(averagePrice * 100).toFixed(1)}%\nÁï∂ÂâçÂÉπÊ†º: ${(currentPrice * 100).toFixed(1)}%\nÁ∏ΩÊî∂ÂÖ•: ${revenue.toFixed(2)} USDT\nÊâãÁ∫åË≤ª: ${tradingFee.toFixed(2)} USDT `);
            }
        }

        // Êõ¥Êñ∞Â§öÈÅ∏È†ÖPKÁïåÈù¢
        function updateMultiOptionInterface() {
            if (!currentTopic || !currentTopic.options) return;
            
            const grid = document.getElementById('multiOptionGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            currentTopic.options.forEach((option, index) => {
                const amount = currentTopic.innerPool[`option${index}Amount`] || 0;
                const percentage = currentTopic.innerPool.totalAmount > 0 ? 
                    ((amount / currentTopic.innerPool.totalAmount) * 100).toFixed(1) : '0.0';
                const participants = Math.floor(amount / 50) + Math.floor(Math.random() * 5); // Ê®°Êì¨ÂèÉËàá‰∫∫Êï∏
                
                const card = document.createElement('div');
                card.className = 'option-card';
                card.onclick = () => selectMultiOption(index);
                card.innerHTML = `
                    <div class="option-header">
                        <div class="option-name">${option}</div>
                    </div>
                    <div class="option-stats">
                        <div class="option-amount">${amount} USDT</div>
                        <div class="option-percentage">${percentage}%</div>
                        <div class="option-participants">${participants}‰∫∫ÊîØÊåÅ</div>
                    </div>
                    <div class="option-indicator" style="width: ${percentage}%"></div>
                `;
                grid.appendChild(card);
            });
        }

        // Êõ¥Êñ∞Â§öÈÅ∏È†ÖTrade LMSRÁïåÈù¢
        function updateMultiLMSRInterface() {
            if (!currentTopic || !currentTopic.options) return;
            
            const grid = document.getElementById('multiLmsrGrid');
            if (!grid) return;
            
            grid.innerHTML = '';
            
            currentTopic.options.forEach((option, index) => {
                // Á∞°ÂåñÁöÑÂÉπÊ†ºË®àÁÆó
                const basePrice = 1 / currentTopic.options.length;
                const variance = (Math.random() - 0.5) * 0.3;
                const price = Math.max(0.05, Math.min(0.95, basePrice + variance));
                
                const card = document.createElement('div');
                card.className = 'lmsr-option-card';
                card.innerHTML = `
                    <div class="lmsr-option-header">
                        <div class="lmsr-option-name">${option}</div>
                        <div class="lmsr-option-price">${price.toFixed(3)} USDT</div>
                    </div>
                    <div class="lmsr-option-actions">
                        <button class="lmsr-mini-btn lmsr-buy-btn" onclick="buyMultiLMSR(${index})">Ë≤∑ÂÖ•</button>
                        <button class="lmsr-mini-btn lmsr-sell-btn" onclick="sellMultiLMSR(${index})">Ë≥£Âá∫</button>
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // ÈÅ∏ÊìáÂ§öÈÅ∏È†Ö
        let selectedMultiOption = null;
        function selectMultiOption(optionIndex) {
            selectedMultiOption = optionIndex;
            
            // Êõ¥Êñ∞Ë¶ñË¶∫ÁãÄÊÖã
            document.querySelectorAll('.option-card').forEach((card, index) => {
                if (index === optionIndex) {
                    card.classList.add('selected');
                } else {
                    card.classList.remove('selected');
                }
            });
        }

        // Â§öÈÅ∏È†ÖLMSR‰∫§ÊòìÂáΩÊï∏
        function buyMultiLMSR(optionIndex) {
            const amount = parseFloat(document.getElementById('multiLmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ‰∫§ÊòìÊï∏Èáè');
                return;
            }
            
            // Á∞°ÂñÆÁöÑÊàêÊú¨Ë®àÁÆó
            const cost = amount * (1 / currentTopic.options.length) * 1.05;
            
            if (cost > userBalance) {
                const shortage = cost - userBalance;
                const shouldRecharge = confirm(`üí∞ È§òÈ°ç‰∏çË∂≥ÔºåÁÑ°Ê≥ïÂÆåÊàê‰∫§Êòì\n\nÈúÄË¶ÅÈáëÈ°ç: ${cost.toFixed(2)} USDT\nÁï∂ÂâçÈ§òÈ°ç: ${userBalance.toFixed(2)} USDT\n‰∏çË∂≥ÈáëÈ°ç: ${shortage.toFixed(2)} USDT\n\nÊòØÂê¶Á´ãÂç≥ÂÖÖÂÄºÔºü`);
                
                if (shouldRecharge) {
                    showRecharge();
                }
                return;
            }
            
            if (confirm(`Á¢∫Ë™çË≤∑ÂÖ• ${amount} ÂÄã ${currentTopic.options[optionIndex]} ‰ª£Âπ£Ôºü\nÁ∏ΩËä±Ë≤ª: ${cost.toFixed(2)} USDT`)) {
                userBalance -= cost;
                
                // Êõ¥Êñ∞ÊåÅÂÄâ
                const holdingKey = `myMultiOption${optionIndex}`;
                currentTopic[holdingKey] = (currentTopic[holdingKey] || 0) + amount;
                
                updateBalanceDisplay();
                document.getElementById('multiLmsrAmount').value = '';
                alert(`‰∫§ÊòìÊàêÂäüÔºÅË≤∑ÂÖ• ${amount} ÂÄã ${currentTopic.options[optionIndex]} ‰ª£Âπ£`);
            }
        }

        function sellMultiLMSR(optionIndex) {
            const amount = parseFloat(document.getElementById('multiLmsrAmount').value);
            if (!amount || amount <= 0) {
                alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ‰∫§ÊòìÊï∏Èáè');
                return;
            }
            
            const holdingKey = `myMultiOption${optionIndex}`;
            const currentHolding = currentTopic[holdingKey] || 0;
            
            if (amount > currentHolding) {
                alert(`ÊåÅÂÄâ‰∏çË∂≥ÔºÅÊÇ®ÁõÆÂâçÊåÅÊúâ ${currentHolding} ÂÄã ${currentTopic.options[optionIndex]} ‰ª£Âπ£`);
                return;
            }
            
            // Á∞°ÂñÆÁöÑÊî∂ÂÖ•Ë®àÁÆó
            const revenue = amount * (1 / currentTopic.options.length) * 0.95;
            
            if (confirm(`Á¢∫Ë™çË≥£Âá∫ ${amount} ÂÄã ${currentTopic.options[optionIndex]} ‰ª£Âπ£Ôºü\nÈ†êË®àÊî∂ÂÖ•: ${revenue.toFixed(2)} USDT`)) {
                userBalance += revenue;
                currentTopic[holdingKey] -= amount;
                
                updateBalanceDisplay();
                document.getElementById('multiLmsrAmount').value = '';
                alert(`‰∫§ÊòìÊàêÂäüÔºÅË≥£Âá∫ ${amount} ÂÄã ${currentTopic.options[optionIndex]} ‰ª£Âπ£`);
            }
        }

        // Êõ¥Êñ∞ÁçéÈáëÊ±†ÊòæÁ§∫
        function updatePoolDisplay() {
            if (!currentTopic) return;

            const isOuter = currentTopic.status === 'outer';
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            
            // Êõ¥Êñ∞PK‰∫§ÊòìÁïåÈù¢ÁöÑÊòæÁ§∫ÔºàÂè™Â∞ç‰∫åÂÖÉÈÅ∏È†ÖÔºâ
            if (currentTopic.innerPool && !isMultiOption) {
                const yesAmountEl = document.getElementById('yesAmount');
                const noAmountEl = document.getElementById('noAmount');
                if (yesAmountEl) yesAmountEl.textContent = `${currentTopic.innerPool.yesAmount || 0} USDT`;
                if (noAmountEl) noAmountEl.textContent = `${currentTopic.innerPool.noAmount || 0} USDT`;
            }

            // Êõ¥Êñ∞Â§öÈÅ∏È†ÖPKÁïåÈù¢Êï∏Êìö
            if (isMultiOption && !isOuter) {
                updatePKInterface();
            }

            // Êõ¥Êñ∞ÊàëÁöÑÊåÅ‰ªì
            updateMyPositions();

            // Êõ¥Êñ∞‰∏≠Èó¥Âå∫ÂüüÁöÑÁçéÈáëÊ±†ËØ¶ÊÉÖ
            updatePoolDetailsSection();
        }

        // Êõ¥Êñ∞‰∏≠Èó¥Âå∫ÂüüÁöÑÁçéÈáëÊ±†ËØ¶ÊÉÖÊòæÁ§∫
        function updatePoolDetailsSection() {
            if (!currentTopic) return;

            const poolDetailsSection = document.getElementById('poolDetailsSection');
            const isOuter = currentTopic.status === 'outer';

            if (isOuter && currentTopic.outerPool) {
                const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
                let outerPoolRowsHTML = '';
                
                if (isMultiOption) {
                    // Â§öÈÅ∏È†ÖTradeË≥áÈáëÊ±†È°ØÁ§∫
                    currentTopic.options.forEach((option, index) => {
                        const amount = currentTopic.outerPool[`option${index}Amount`] || 0;
                        outerPoolRowsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">${option}ÁçéÊ±†Ôºö</span>
                                <span class="pool-value">${amount} USDT</span>
                            </div>
                        `;
                    });
                } else {
                    // ‰∫åÂÖÉÈÅ∏È†ÖTradeË≥áÈáëÊ±†È°ØÁ§∫
                    outerPoolRowsHTML = `
                        <div class="pool-row">
                            <span class="pool-label">YESÁçéÊ±†Ôºö</span>
                            <span class="pool-value">${currentTopic.outerPool.yesAmount} USDT</span>
                        </div>
                        <div class="pool-row">
                            <span class="pool-label">NOÁçéÊ±†Ôºö</span>
                            <span class="pool-value">${currentTopic.outerPool.noAmount} USDT</span>
                        </div>
                    `;
                }
                
                // TradeÁä∂ÊÄÅ - ÊòæÁ§∫Â∏ÇÂú∫‰ø°ÊÅØÂíå‰ª∑Ê†ºËµ∞Âäø
                poolDetailsSection.innerHTML = `
                        <!-- Trade‰ø°ÊÅØ -->
                        <div class="pool-section">
                            <div class="pool-section-header">
                                <span class="pool-section-title">Trade‰ø°ÊÅØ</span>
                                <span class="pool-section-badge trade">LMSR</span>
                            </div>
                            <div class="pool-info">
                                <div class="pool-row">
                                    <span class="pool-label">ÊÄªÊµÅÊ∞¥Ôºö</span>
                                    <span class="pool-value">${currentTopic.outerPool.totalVolume || 0} USDT</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">Â∏ÇÂ†¥ÊµÅÂãïÊÄßÔºö</span>
                                    <span class="pool-value">${currentTopic.outerPool.totalAmount} USDT</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">ÂΩìÂâçYES‰ª∑Ê†ºÔºö</span>
                                    <span class="pool-value" style="color: #10b981;">${((currentTopic.outerPool.yesAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount)) * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">ÂΩìÂâçNO‰ª∑Ê†ºÔºö</span>
                                    <span class="pool-value" style="color: #ef4444;">${((currentTopic.outerPool.noAmount / (currentTopic.outerPool.yesAmount + currentTopic.outerPool.noAmount)) * 100).toFixed(1)}%</span>
                                </div>
                            </div>
                        </div>

                    <!-- PKÁçéÈáëÊ±† -->
                    <div class="pool-section">
                        <div class="pool-section-header">
                            <span class="pool-section-title">PKÁçéÈáëÊ±†</span>
                            <span class="pool-section-badge pumped">Â∑≤Pump</span>
                        </div>
                        <div class="pool-info">
                            ${(() => {
                                if (isMultiOption) {
                                    // Â§öÈÅ∏È†ÖÈ°ØÁ§∫
                                    return currentTopic.options.map((option, index) => {
                                        const amount = currentTopic.innerPool[`option${index}Amount`] || 0;
                                        return `
                                            <div class="pool-row">
                                                <span class="pool-label">ÂéüÂßã${option}ÊäïÊ≥®Ôºö</span>
                                                <span class="pool-value">${amount} USDT</span>
                                            </div>
                                        `;
                                    }).join('');
                                } else {
                                    // ‰∫åÂÖÉÈÅ∏È†ÖÈ°ØÁ§∫
                                    return `
                                        <div class="pool-row">
                                            <span class="pool-label">ÂéüÂßãYESÊäïÊ≥®Ôºö</span>
                                            <span class="pool-value">${currentTopic.innerPool?.yesAmount || 0} USDT</span>
                                        </div>
                                        <div class="pool-row">
                                            <span class="pool-label">ÂéüÂßãNOÊäïÊ≥®Ôºö</span>
                                            <span class="pool-value">${currentTopic.innerPool?.noAmount || 0} USDT</span>
                                        </div>
                                    `;
                                }
                            })()}
                            <div class="pool-row" style="color: #ef4444;">
                                <span class="pool-label">ËΩ¨Âá∫TradeÂ∫ïÊ±†Ôºö</span>
                                <span class="pool-value">-${currentTopic.outerPool.basePool} USDT</span>
                            </div>
                            <div class="pool-row" style="color: #10b981;">
                                <span class="pool-label">ÊâãÁ∫åË≤ªÂõûÊµÅÔºö</span>
                                <span class="pool-value">+${currentTopic.outerPool.tradingFeeToInner || 0} USDT</span>
                            </div>
                            <div class="pool-row">
                                <span class="pool-label">PKÂΩìÂâçÊÄªÈ¢ùÔºö</span>
                                <span class="pool-value">${((currentTopic.innerPool?.totalAmount || 0) - currentTopic.outerPool.basePool + (currentTopic.outerPool.tradingFeeToInner || 0)).toFixed(2)} USDT</span>
                            </div>
                        </div>
                    </div>

                    <!-- PumpÊú∫Âà∂ËØ¥Êòé -->
                    <div style="background: rgba(245, 158, 11, 0.1); border: 1px solid rgba(245, 158, 11, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #fbbf24;">
                        <strong>üí° PumpÊú∫Âà∂ËØ¥ÊòéÔºö</strong><br>
                        ‚Ä¢ PKËææÂà∞1000UÊó∂Ëß¶ÂèëPump<br>
                        ‚Ä¢ Â∞èÊñπÁöÑ50%ËΩ¨ÂÖ•TradeÂ∫ïÊ±†<br>
                        ‚Ä¢ Trade‰∫§ÊòìÊâãÁ∫åË≤ªÁöÑ40%ÊåÅÁª≠ÂõûÊµÅPK
                    </div>
                `;
            } else {
                // PKÁä∂ÊÄÅ - ÊòæÁ§∫ÂΩìÂâçÁä∂ÊÄÅÂíåPumpËøõÂ∫¶
                const innerTotal = currentTopic.innerPool?.totalAmount || 0;
                const isPrivate = currentTopic.isPrivate;
                const pumpThreshold = currentTopic.pumpCondition || 1000;
                
                let progressSection = '';
                let conditionSection = '';
                
                if (!isPrivate) {
                    // ÈùûÁßÅÂØÜË©±È°åÈ°ØÁ§∫PumpÈÄ≤Â∫¶
                    const progress = Math.min(innerTotal / pumpThreshold * 100, 100);
                    const remaining = Math.max(pumpThreshold - innerTotal, 0);
                    
                    progressSection = `
                        <div class="pump-progress" style="margin: 1.5rem 0;">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%;"></div>
                            </div>
                            <div class="progress-text">
                                Ë∑ùÁ¶ªPumpËøòÈúÄ <strong style="color: #10b981;">${remaining}</strong> USDT
                            </div>
                        </div>
                    `;
                    
                    conditionSection = `
                        <!-- PumpÊù°‰ª∂ËØ¥Êòé -->
                        <div style="background: rgba(59, 130, 246, 0.1); border: 1px solid rgba(59, 130, 246, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #60a5fa;">
                            <strong>‚ö° PumpÊù°‰ª∂Ôºö</strong><br>
                            ‚Ä¢ PKÁçéÈáëÊ±†ËææÂà∞${pumpThreshold} USDTÊó∂Ëá™Âä®Ëß¶ÂèëPump<br>
                            ‚Ä¢ PK‰∫§ÊòìÊî∂Âèñ5%ÊâãÁ∫åË≤ª<br>
                            ‚Ä¢ ‰∏ãÊ≥®ÈáëÈ°çËæÉÂ∞è‰∏ÄÊñπÁöÑ50%Â∞ÜËΩ¨‰∏∫Trade LMSRÂ∫ïÊ±†<br>
                            ‚Ä¢ ËΩ¨‰∏∫TradeÂêéÂèØÂú®ÁÄëÂ∏ÉÊµÅ‰∏≠Â±ïÁ§∫Âíå‰∫§Êòì
                        </div>
                        
                        <!-- Êî∂ÁõäË™™Êòé -->
                        <div style="background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #10b981;">
                            <strong>üí∞ Êî∂ÁõäÊ©üÊúÉÔºö</strong><br>
                            ‚Ä¢ <strong>PKÂãùÂà©</strong>ÔºöÁìúÂàÜÂ∞çÊñπÈô£ÁáüÁöÑÂÖ®ÈÉ®Ë≥áÈáë<br>
                            ‚Ä¢ <strong>Trade‰∫§Êòì</strong>ÔºöÂèØÂú®LMSRÂ∏ÇÂ†¥ÈÄ≤Ë°åÂÉπÊ†º‰∫§ÊòìÁç≤Âà©<br>
‚Ä¢ <strong>ÊâãÁ∫åË≤ªÂàÜÁ¥Ö</strong>ÔºöPKÂèÉËàáËÄÖ‰∫´ÂèóTrade‰∫§ÊòìÊâãÁ∫åË≤ªÁöÑ40%ÂõûÊµÅ<br>
                            ‚Ä¢ <strong>Êó©ÊúüÂèÉËàáÂÑ™Âã¢</strong>ÔºöË∂äÊó©ÂèÉËàáÔºåÊΩõÂú®Êî∂ÁõäÂÄçÊï∏Ë∂äÈ´ò
                        </div>
                    `;
                } else {
                    // ÁßÅÂØÜË©±È°åÈ°ØÁ§∫ÁßÅÂØÜË™™Êòé
                    conditionSection = `
                        <!-- ÁßÅÂØÜË©±È°åËØ¥Êòé -->
                        <div style="background: rgba(239, 68, 68, 0.1); border: 1px solid rgba(239, 68, 68, 0.3); border-radius: 8px; padding: 1rem; margin-top: 1rem; font-size: 0.85rem; color: #f87171;">
                            <strong>üîí ÁßÅÂØÜË©±È°åÔºö</strong><br>
                            ‚Ä¢ Ê≠§Ë©±È°åÁÇ∫ÁßÅÂØÜË©±È°åÔºå‰∏çÊúÉÂá∫ÁèæÂú®ÁÄëÂ∏ÉÊµÅ‰∏≠<br>
                            ‚Ä¢ ÁßÅÂØÜË©±È°å‰∏çÊîØÊè¥PumpÂäüËÉΩÔºå‰∏çÊúÉËΩâÁÇ∫Trade<br>
                            ‚Ä¢ PK‰∫§ÊòìÊî∂Âèñ5%ÊâãÁ∫åË≤ª<br>
‚Ä¢ Ë©±È°åÁµêÊùüÂæåÁõ¥Êé•ÈÄ≤Ë°åPKÁµêÁÆó
                        </div>
                    `;
                }

                const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
                let poolRowsHTML = '';
                
                if (isMultiOption) {
                    // Â§öÈÅ∏È†ÖË©±È°åÈ°ØÁ§∫
                    currentTopic.options.forEach((option, index) => {
                        const amount = currentTopic.innerPool[`option${index}Amount`] || 0;
                        poolRowsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">${option}Ôºö</span>
                                <span class="pool-value">${amount} USDT</span>
                            </div>
                        `;
                    });
                } else {
                    // ‰∫åÂÖÉÈÅ∏È†ÖË©±È°åÈ°ØÁ§∫
                    poolRowsHTML = `
                        <div class="pool-row">
                            <span class="pool-label">YESÊäïÊ≥®Ôºö</span>
                            <span class="pool-value">${currentTopic.innerPool?.yesAmount || 0} USDT</span>
                        </div>
                        <div class="pool-row">
                            <span class="pool-label">NOÊäïÊ≥®Ôºö</span>
                            <span class="pool-value">${currentTopic.innerPool?.noAmount || 0} USDT</span>
                        </div>
                    `;
                }

                poolDetailsSection.innerHTML = `
                                            <!-- PKÁçéÈáëÊ±† -->
                    <div class="pool-section">
                        <div class="pool-section-header">
                            <span class="pool-section-title">PKÁçéÈáëÊ±†</span>
                            <span class="pool-section-badge ${isPrivate ? 'private' : ''}">${isPrivate ? 'ÁßÅÂØÜ' : 'Ê¥ªË∫ç'}</span>
                        </div>
                        <div class="pool-info">
                            ${poolRowsHTML}
                            <div class="pool-row">
                                <span class="pool-label">PKÁçéÈáëÁ∏ΩÈ°çÔºö</span>
                                <span class="pool-value">${innerTotal} USDT</span>
                            </div>
                        </div>
                        ${progressSection}
                    </div>
                    ${conditionSection}
                `;
            }
        }

        // Êõ¥Êñ∞PKÁïåÈù¢Êï∏Êìö
        function updatePKInterface() {
            if (!currentTopic || !currentTopic.innerPool) return;
            
            const { yesAmount, noAmount, totalAmount } = currentTopic.innerPool;
            
            // Ë®àÁÆóÁôæÂàÜÊØî
            const yesPercentage = totalAmount > 0 ? Math.round((yesAmount / totalAmount) * 100) : 0;
            const noPercentage = totalAmount > 0 ? Math.round((noAmount / totalAmount) * 100) : 0;
            
            // Ê®°Êì¨ÂèÉËàá‰∫∫Êï∏ÔºàÂØ¶ÈöõÈ†ÖÁõÆ‰∏≠ÈúÄË¶ÅÂæûÂæåÁ´ØÁç≤ÂèñÔºâ
            const yesParticipants = Math.floor(yesAmount / 50) + Math.floor(Math.random() * 5);
            const noParticipants = Math.floor(noAmount / 50) + Math.floor(Math.random() * 5);
            
            // Êõ¥Êñ∞YESÈô£ÁáüÊï∏Êìö
            document.getElementById('yesAmount').textContent = `${yesAmount} USDT`;
            document.getElementById('yesPercentage').textContent = `${yesPercentage}%`;
            document.getElementById('yesParticipants').textContent = `${yesParticipants}‰∫∫`;
            
            // Êõ¥Êñ∞NOÈô£ÁáüÊï∏Êìö
            document.getElementById('noAmount').textContent = `${noAmount} USDT`;
            document.getElementById('noPercentage').textContent = `${noPercentage}%`;
            document.getElementById('noParticipants').textContent = `${noParticipants}‰∫∫`;
            
            // Êõ¥Êñ∞ÈÄ≤Â∫¶ÊåáÁ§∫Âô®
            const yesIndicator = document.getElementById('yesIndicator');
            const noIndicator = document.getElementById('noIndicator');
            
            if (yesIndicator) yesIndicator.style.width = `${yesPercentage}%`;
            if (noIndicator) noIndicator.style.width = `${noPercentage}%`;
            
            // Êõ¥Êñ∞ÈÅ∏‰∏≠ÁãÄÊÖã
            const yesSide = document.querySelector('.yes-side');
            const noSide = document.querySelector('.no-side');
            
            if (selectedOption === 'yes') {
                yesSide?.classList.add('selected');
                noSide?.classList.remove('selected');
            } else if (selectedOption === 'no') {
                noSide?.classList.add('selected');
                yesSide?.classList.remove('selected');
            } else {
                yesSide?.classList.remove('selected');
                noSide?.classList.remove('selected');
            }
        }

        // Êõ¥Êñ∞ÊàëÁöÑÊåÅ‰ªìÊòæÁ§∫
        function updateMyPositions() {
            if (!currentTopic) return;

            const isOuter = currentTopic.status === 'outer';
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            const myInnerPositions = document.getElementById('myInnerPositions');
            const myOuterPositions = document.getElementById('myOuterPositions');

            // Êõ¥Êñ∞PKÊåÅÂÄâ
            if (isMultiOption) {
                // Â§öÈÅ∏È†ÖPKÊåÅÂÄâ - ÂãïÊÖãÁîüÊàêÂÖßÂÆπ
                const innerPositionsContent = document.querySelector('#myInnerPositions .pool-info');
                if (innerPositionsContent) {
                    let positionsHTML = '';
                    let totalInnerValue = 0;
                    
                    currentTopic.options.forEach((option, index) => {
                        const amount = currentTopic[`myOption${index}`] || 0;
                        totalInnerValue += amount;
                        positionsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">${option}Ôºö</span>
                                <span class="pool-value">${amount} USDT</span>
                            </div>
                        `;
                    });
                    
                    positionsHTML += `
                        <div class="pool-row">
                            <span class="pool-label">Á∏ΩË®àÔºö</span>
                            <span class="pool-value">${totalInnerValue} USDT</span>
                        </div>
                    `;
                    
                    innerPositionsContent.innerHTML = positionsHTML;
                }
            } else {
                // ‰∫åÂÖÉÈÅ∏È†ÖPKÊåÅÂÄâ
                const myInnerYes = currentTopic.myInnerYes || 0;
                const myInnerNo = currentTopic.myInnerNo || 0;
                
                // Âä®ÊÄÅÁîüÊàêPKÊåÅ‰ªìÊòæÁ§∫
                const innerPositionsContent = document.querySelector('#myInnerPositions .pool-info');
                if (innerPositionsContent) {
                    let positionsHTML = '';
                    let totalValue = 0;
                    
                    // Âè™ÊòæÁ§∫ÊúâÊåÅ‰ªìÁöÑÈÄâÈ°π
                    if (myInnerYes > 0) {
                        totalValue += myInnerYes;
                        positionsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">YESÊåÅ‰ªìÔºö</span>
                                <span class="pool-value">${myInnerYes} USDT</span>
                            </div>
                        `;
                    }
                    
                    if (myInnerNo > 0) {
                        totalValue += myInnerNo;
                        positionsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">NOÊåÅ‰ªìÔºö</span>
                                <span class="pool-value">${myInnerNo} USDT</span>
                            </div>
                        `;
                    }
                    
                    // Â¶ÇÊûúÊúâ‰ªª‰ΩïÊåÅ‰ªìÔºåÊòæÁ§∫ÊÄªËÆ°
                    if (myInnerYes > 0 || myInnerNo > 0) {
                        positionsHTML += `
                            <div class="pool-row" style="border-top: 1px solid #374151; margin-top: 0.5rem; padding-top: 0.5rem; font-weight: 700;">
                                <span class="pool-label">Á∏ΩË®àÔºö</span>
                                <span class="pool-value">${totalValue} USDT</span>
                            </div>
                        `;
                    } else {
                        // Â¶ÇÊûúÊ≤°ÊúâÊåÅ‰ªìÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
                        positionsHTML = `
                            <div class="pool-row" style="text-align: center; color: #9ca3af; padding: 1rem;">
                                <span>ÊöÇÊó†PKÊåÅ‰ªì</span>
                            </div>
                        `;
                    }
                    
                    innerPositionsContent.innerHTML = positionsHTML;
                }
            }

            // Ê†πÊçÆÁä∂ÊÄÅÊòæÁ§∫/ÈöêËóèTradeÊåÅÂÄâ
            if (isOuter && currentTopic.outerPool) {
                myOuterPositions.style.display = 'block';
                
                if (isMultiOption) {
                    // Â§öÈÅ∏È†ÖTradeÊåÅÂÄâ - ÂãïÊÖãÁîüÊàêÂÖßÂÆπ
                    const outerPositionsContent = document.querySelector('#myOuterPositions .pool-info');
                    if (outerPositionsContent) {
                        let positionsHTML = '';
                        let totalOuterValue = 0;
                        
                        currentTopic.options.forEach((option, index) => {
                            const tokens = currentTopic[`myOuterOption${index}`] || 0;
                            // Á∞°ÂåñÁöÑÂÉπÊ†ºË®àÁÆóÔºàÂü∫Êñº‰ªΩÈ°çÊØî‰æãÔºâ
                            const optionAmount = currentTopic.outerPool[`option${index}Amount`] || 0;
                            const price = currentTopic.outerPool.totalAmount > 0 ? 
                                optionAmount / currentTopic.outerPool.totalAmount : 0;
                            const value = tokens * price;
                            totalOuterValue += value;
                            
                            positionsHTML += `
                                <div class="pool-row">
                                    <span class="pool-label">${option}‰ª£Âπ£Ôºö</span>
                                    <span class="pool-value">${tokens} ÂÄã</span>
                                </div>
                            `;
                        });
                        
                        positionsHTML += `
                            <div class="pool-row">
                                <span class="pool-label">‰º∞ÂÄºÔºö</span>
                                <span class="pool-value">${totalOuterValue.toFixed(2)} USDT</span>
                            </div>
                        `;
                        
                        outerPositionsContent.innerHTML = positionsHTML;
                    }
                } else {
                    // ‰∫åÂÖÉÈÅ∏È†ÖTradeÊåÅÂÄâ
                    const myOuterYes = currentTopic.myOuterYes || 0;
                    const myOuterNo = currentTopic.myOuterNo || 0;
                    const myOuterYesAvgPrice = currentTopic.myOuterYesAvgPrice || 0;
                    const myOuterNoAvgPrice = currentTopic.myOuterNoAvgPrice || 0;
                    
                    // Âä®ÊÄÅÁîüÊàêÊåÅ‰ªìÊòæÁ§∫
                    const outerPositionsContent = document.querySelector('#myOuterPositions .pool-info');
                    if (outerPositionsContent) {
                        let positionsHTML = '';
                        let totalValue = 0;
                        
                        // ËÆ°ÁÆóÂΩìÂâç‰ª∑Ê†º
                        const yesCurrentPrice = currentTopic.outerPool.totalAmount > 0 ? 
                            currentTopic.outerPool.yesAmount / currentTopic.outerPool.totalAmount : 0;
                        const noCurrentPrice = currentTopic.outerPool.totalAmount > 0 ? 
                            currentTopic.outerPool.noAmount / currentTopic.outerPool.totalAmount : 0;
                        
                        // Âè™ÊòæÁ§∫ÊúâÊåÅ‰ªìÁöÑ‰ª£Â∏Å
                        if (myOuterYes > 0) {
                            const yesValue = (myOuterYes * yesCurrentPrice);
                            totalValue += yesValue;
                            positionsHTML += `
                                <div class="pool-row">
                                    <span class="pool-label">YES‰ª£Âπ£Ôºö</span>
                                    <span class="pool-value">${myOuterYes} ‰∏™</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">Âπ≥ÂùáË≥ºË≤∑ÂÉπÊ†ºÔºö</span>
                                    <span class="pool-value">${(myOuterYesAvgPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">Áï∂ÂâçÂÉπÊ†ºÔºö</span>
                                    <span class="pool-value">${(yesCurrentPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">Áï∂Ââç‰º∞ÂÄºÔºö</span>
                                    <span class="pool-value">${yesValue.toFixed(2)} USDT</span>
                                </div>
                            `;
                        }
                        
                        if (myOuterNo > 0) {
                            const noValue = (myOuterNo * noCurrentPrice);
                            totalValue += noValue;
                            
                            // Â¶ÇÊûúÊúâYESÊåÅ‰ªìÔºåÊ∑ªÂä†ÂàÜÈöîÁ∫ø
                            if (myOuterYes > 0) {
                                positionsHTML += `<div class="pool-row" style="border-top: 1px solid #374151; margin-top: 0.5rem; padding-top: 0.5rem;">`;
                            } else {
                                positionsHTML += `<div class="pool-row">`;
                            }
                            
                            positionsHTML += `
                                    <span class="pool-label">NO‰ª£Âπ£Ôºö</span>
                                    <span class="pool-value">${myOuterNo} ‰∏™</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">Âπ≥ÂùáË≥ºË≤∑ÂÉπÊ†ºÔºö</span>
                                    <span class="pool-value">${(myOuterNoAvgPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">Áï∂ÂâçÂÉπÊ†ºÔºö</span>
                                    <span class="pool-value">${(noCurrentPrice * 100).toFixed(1)}%</span>
                                </div>
                                <div class="pool-row">
                                    <span class="pool-label">Áï∂Ââç‰º∞ÂÄºÔºö</span>
                                    <span class="pool-value">${noValue.toFixed(2)} USDT</span>
                                </div>
                            `;
                        }
                        
                        // Â¶ÇÊûúÊúâ‰ªª‰ΩïÊåÅ‰ªìÔºåÊòæÁ§∫ÊÄª‰º∞ÂÄº
                        if (myOuterYes > 0 || myOuterNo > 0) {
                            positionsHTML += `
                                <div class="pool-row" style="border-top: 1px solid #374151; margin-top: 0.5rem; padding-top: 0.5rem; font-weight: 700;">
                                    <span class="pool-label">Á∏Ω‰º∞ÂÄºÔºö</span>
                                    <span class="pool-value">${totalValue.toFixed(2)} USDT</span>
                                </div>
                            `;
                        } else {
                            // Â¶ÇÊûúÊ≤°ÊúâÊåÅ‰ªìÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
                            positionsHTML = `
                                <div class="pool-row" style="text-align: center; color: #9ca3af; padding: 1rem;">
                                    <span>ÊöÇÊó†TradeÊåÅ‰ªì</span>
                                </div>
                            `;
                        }
                        
                        outerPositionsContent.innerHTML = positionsHTML;
                    }
                }
            } else {
                myOuterPositions.style.display = 'none';
            }
        }

        // ÈÅ∏Êìá‰∏ãÊ≥®ÈÅ∏È†Ö
        function selectOption(option) {
            selectedOption = option;
            document.querySelectorAll('.bet-option').forEach(el => {
                el.classList.remove('selected');
            });
            document.querySelector(`.bet-option.${option}`).classList.add('selected');
        }

        // ‰∏ãÊ≥®
        function placeBet() {
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            
            if (isMultiOption) {
                // Â§öÈÅ∏È†ÖÈÇèËºØ
                if (selectedMultiOption === null) {
                    alert('Ë´ãÂÖàÈÅ∏Êìá‰∏ÄÂÄãÈÅ∏È†Ö');
                    return;
                }

                const amount = parseInt(document.getElementById('multiOptionAmount').value);
                if (!amount || amount <= 0) {
                    alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ‰∏ãÊ≥®ÈáëÈ°ç');
                    return;
                }

                // ËÆ°ÁÆóÊâãÁª≠Ë¥πÂíåÂáÄ‰∏ãÊ≥®È¢ù
                const fee = amount * 0.05;
                const netAmount = amount - fee;
                
                // ËÆ°ÁÆóÂΩìÂâçÈÄâÈ°πÁöÑÊîØÊåÅÊØî‰æã
                const totalPool = currentTopic.innerPool?.totalAmount || 0;
                const optionKey = `option${selectedMultiOption}Amount`;
                const optionAmount = currentTopic.innerPool?.[optionKey] || 0;
                const supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '0.0';
                
                // ÊòæÁ§∫Á¢∫Ë™çÊ®°ÊÄÅÊ°Ü
                document.getElementById('confirmOption').innerHTML = `${currentTopic.options[selectedMultiOption]} <span id="confirmRatio">(${supportRatio}%)</span>`;
                document.getElementById('confirmNetAmount').textContent = `${netAmount.toFixed(2)} USDT`;
                document.getElementById('confirmFee').textContent = `${fee.toFixed(2)} USDT (5%)`;
                document.getElementById('confirmTotalPool').textContent = `${totalPool.toFixed(2)} USDT`;
                document.getElementById('confirmModal').classList.add('active');
            } else {
                // ‰∫åÂÖÉÈÅ∏È†ÖÈÇèËºØ
                if (!selectedOption) {
                    alert('ËØ∑ÂÖàÈÅ∏ÊìáYESÊàñNO');
                    return;
                }

                const amount = parseInt(document.getElementById('betAmount').value);
                if (!amount || amount <= 0) {
                    alert('Ë´ãËº∏ÂÖ•ÊúâÊïàÁöÑ‰∏ãÊ≥®ÈáëÈ°ç');
                    return;
                }

                // ËÆ°ÁÆóÊâãÁª≠Ë¥πÂíåÂáÄ‰∏ãÊ≥®È¢ù
                const fee = amount * 0.05;
                const netAmount = amount - fee;
                
                // ËÆ°ÁÆóÂΩìÂâçÈÄâÈ°πÁöÑÊîØÊåÅÊØî‰æã
                const totalPool = currentTopic.innerPool?.totalAmount || 0;
                const optionAmount = selectedOption === 'yes' ? 
                    (currentTopic.innerPool?.yesAmount || 0) : 
                    (currentTopic.innerPool?.noAmount || 0);
                const supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '0.0';
                
                // ÊòæÁ§∫Á¢∫Ë™çÊ®°ÊÄÅÊ°Ü
                document.getElementById('confirmOption').innerHTML = `${selectedOption.toUpperCase()} <span id="confirmRatio">(${supportRatio}%)</span>`;
                document.getElementById('confirmNetAmount').textContent = `${netAmount.toFixed(2)} USDT`;
                document.getElementById('confirmFee').textContent = `${fee.toFixed(2)} USDT (5%)`;
                document.getElementById('confirmTotalPool').textContent = `${totalPool.toFixed(2)} USDT`;
                document.getElementById('confirmModal').classList.add('active');
            }
        }



        // Á¢∫Ë™ç‰∏ãÊ≥®
        function confirmBet() {
            const isMultiOption = currentTopic.options && currentTopic.options.length > 2;
            const inputAmount = parseInt(document.getElementById(isMultiOption ? 'multiOptionAmount' : 'betAmount').value);
            
            // Ê™¢Êü•È§òÈ°ç
            if (inputAmount > userBalance) {
                const shortage = inputAmount - userBalance;
                const shouldRecharge = confirm(`üí∞ È§òÈ°ç‰∏çË∂≥ÔºåÁÑ°Ê≥ïÂÆåÊàê‰∫§Êòì\n\nÈúÄË¶ÅÈáëÈ°ç: ${inputAmount} USDT\nÁï∂ÂâçÈ§òÈ°ç: ${userBalance} USDT\n‰∏çË∂≥ÈáëÈ°ç: ${shortage} USDT\n\nÊòØÂê¶Á´ãÂç≥ÂÖÖÂÄºÔºü`);
                
                if (shouldRecharge) {
                    showRecharge();
                } else {
                    checkInnerBalance(); // È°ØÁ§∫ÂÖÖÂÄºÊåâÈàï
                }
                return;
            }
            
            // Ë®àÁÆó5%ÊâãÁ∫åË≤ª
            const fee = inputAmount * 0.05;
            const netAmount = inputAmount - fee;
            
            // Êâ£Èô§È§òÈ°ç
            userBalance -= inputAmount;
            
            // Á°Æ‰øùPKÊï∞ÊçÆÁªìÊûÑÂ≠òÂú®Âπ∂Êõ¥Êñ∞Êï∞ÊçÆ
            if (isMultiOption) {
                // Â§öÈÄâÈ°πÈÄªËæë
                if (!currentTopic.innerPool) {
                    currentTopic.innerPool = { totalAmount: 0 };
                    for (let i = 0; i < currentTopic.options.length; i++) {
                        currentTopic.innerPool[`option${i}Amount`] = 0;
                    }
                }
                
                const optionKey = `option${selectedMultiOption}Amount`;
                const myOptionKey = `myOption${selectedMultiOption}`;
                
                currentTopic.innerPool[optionKey] = (currentTopic.innerPool[optionKey] || 0) + netAmount;
                currentTopic.innerPool.totalAmount += netAmount;
                currentTopic[myOptionKey] = (currentTopic[myOptionKey] || 0) + netAmount;
            } else {
                // ‰∫åÂÖÉÈÄâÈ°πÈÄªËæë
                if (!currentTopic.innerPool) {
                    currentTopic.innerPool = { yesAmount: 0, noAmount: 0, totalAmount: 0 };
                }
                
                if (selectedOption === 'yes') {
                    currentTopic.innerPool.yesAmount += netAmount;
                    currentTopic.myInnerYes = (currentTopic.myInnerYes || 0) + netAmount;
                } else {
                    currentTopic.innerPool.noAmount += netAmount;
                    currentTopic.myInnerNo = (currentTopic.myInnerNo || 0) + netAmount;
                }
                currentTopic.innerPool.totalAmount += netAmount;
            }

            // Êõ¥Êñ∞sampleTopics‰∏≠ÁöÑÊï∞ÊçÆ
            const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
            if (topicIndex !== -1) {
                sampleTopics[topicIndex] = {...currentTopic};
            }

            // Ê£ÄÊü•ÊòØÂê¶Ëß¶ÂèëPumpÔºà‰ΩøÁî®Ëá™ÂÆöÁæ©Ê¢ù‰ª∂ÔºåÁßÅÂØÜË©±È°å‰∏çËß∏ÁôºÔºâ
            const pumpThreshold = currentTopic.pumpCondition || 1000;
            if (currentTopic.innerPool.totalAmount >= pumpThreshold && 
                currentTopic.status === 'inner' && 
                !currentTopic.isPrivate) {
                triggerPump();
            } else {
                // Â¶ÇÊûúËøòÊòØPKÔºåÊõ¥Êñ∞ÁïåÈù¢ÊèêÁ§∫
                updateTradingInterface();
            }

            updatePoolDisplay();
            closeModal();
            
            // ËÆ°ÁÆó‰∏ãÊ≥®ÈÄâÈ°πÁöÑÊîØÊåÅÊØî‰æãÂπ∂ÊòæÁ§∫ÊàêÂäüÂºπÁ™ó
            const totalPool = currentTopic.innerPool.totalAmount;
            let optionAmount, optionText, supportRatio;
            
            if (isMultiOption) {
                const optionKey = `option${selectedMultiOption}Amount`;
                optionAmount = currentTopic.innerPool[optionKey];
                optionText = currentTopic.options[selectedMultiOption];
                supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '0.0';
            } else {
                optionAmount = selectedOption === 'yes' ? currentTopic.innerPool.yesAmount : currentTopic.innerPool.noAmount;
                optionText = selectedOption.toUpperCase();
                supportRatio = totalPool > 0 ? ((optionAmount / totalPool) * 100).toFixed(1) : '0.0';
            }
            
            // ÊòæÁ§∫ÊàêÂäüÂºπÁ™ó
            document.getElementById('successOption').innerHTML = `${optionText} <span id="successRatio">(${supportRatio}%)</span>`;
            document.getElementById('successNetAmount').textContent = `${netAmount.toFixed(2)} USDT`;
            document.getElementById('successFee').textContent = `${fee.toFixed(2)} USDT`;
            document.getElementById('successTotalPool').textContent = `${totalPool.toFixed(2)} USDT`;
            document.getElementById('successModal').classList.add('active');
            
            // Êõ¥Êñ∞È§òÈ°çÈ°ØÁ§∫
            updateBalanceDisplay();
            
            // Ê∏ÖÁ©∫Ëº∏ÂÖ•
            if (isMultiOption) {
                document.getElementById('multiOptionAmount').value = '';
                selectedMultiOption = null;
                document.querySelectorAll('.option-card').forEach(el => {
                    el.classList.remove('selected');
                });
            } else {
                document.getElementById('betAmount').value = '';
                selectedOption = null;
                document.querySelectorAll('.bet-option').forEach(el => {
                    el.classList.remove('selected');
                });
            }
        }

        // Ëß¶ÂèëPumpÊú∫Âà∂
        function triggerPump() {
            const inner = currentTopic.innerPool;
            
            // ÊâæÂá∫‰∏ãÊ≥®ÈáëÈ°çËæÉÂ∞èÁöÑ‰∏ÄÊñπ
            const smallerSide = inner.yesAmount < inner.noAmount ? 'yes' : 'no';
            const smallerAmount = Math.min(inner.yesAmount, inner.noAmount);
            
            // Â∞èÊñπÁöÑ50%‰Ωú‰∏∫TradeÂ∫ïÊ±†
            const basePool = smallerAmount * 0.5;
            
            // Ê†πÊçÆPKÁçéÈáëÊØî‰æãËÆæÁΩÆÂàùÂßãËôöÊãüÊµÅÂä®ÊÄß
            const yesRatio = inner.yesAmount / inner.totalAmount;
            const noRatio = inner.noAmount / inner.totalAmount;
            
            // ÂàõÂª∫TradeÊï∞ÊçÆÁªìÊûÑ
            currentTopic.outerPool = {
                basePool: basePool,
                yesAmount: yesRatio * basePool * 2, // ÂàùÂßãËôöÊãüÊµÅÂä®ÊÄß
                noAmount: noRatio * basePool * 2,
                totalAmount: basePool * 2,
                tradingFeeToInner: 0
            };
            
            // Êõ¥Êñ∞Áä∂ÊÄÅ
            currentTopic.status = 'outer';
            currentTopic.isOuter = true;
            
            // Êõ¥Êñ∞sampleTopics‰∏≠ÁöÑÊï∞ÊçÆ
            const topicIndex = sampleTopics.findIndex(t => t.id === currentTopic.id);
            if (topicIndex !== -1) {
                sampleTopics[topicIndex] = {...currentTopic};
            }
            
            // Êõ¥Êñ∞‰∫§ÊòìÁïåÈù¢
            updateTradingInterface();
            
            // ÊòæÁ§∫PumpÈÄöÁü•
            setTimeout(() => {
                document.getElementById('pumpModal').classList.add('active');
            }, 500);
        }

        // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
        function closeModal() {
            document.getElementById('confirmModal').classList.remove('active');
        }

        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }

        function closePumpModal() {
            document.getElementById('pumpModal').classList.remove('active');
            // ÂàáÊç¢Âà∞Trade‰∫§ÊòìÁïåÈù¢
            document.getElementById('innerTrading').style.display = 'none';
            document.getElementById('outerTrading').style.display = 'block';
            document.getElementById('tradingTitle').textContent = 'LMSR‰∫§Êòì';
            document.getElementById('tradingSubtitle').textContent = 'Âü∫‰∫éÂ∏ÇÂú∫ÂÉπÊ†º‰∫§Êòì';
        }

        // ÂàÜ‰∫´ÈÄ£Áµê
        function shareLink() {
            const url = `${window.location.origin}${window.location.pathname}?topic=${currentTopic.id}`;
            navigator.clipboard.writeText(url).then(() => {
                alert('ÂàÜ‰∫´ÈÄ£ÁµêÂ∑≤Â§çÂà∂Âà∞Ââ™Ë¥¥ÊùøÔºÅ');
            });
        }

        // Ëá™ÂÆö‰πâÈÄâÈ°πÁÆ°ÁêÜ
        // ÂàáÊèõÈÅ∏È†ÖÈ°ûÂûã
        function toggleOptionType() {
            const optionType = document.querySelector('input[name="optionType"]:checked').value;
            const customOptions = document.getElementById('customOptions');
            
            if (optionType === 'custom') {
                customOptions.style.display = 'block';
                // ÂàùÂßãÂåñ2ÂÄãÈªòË™çÈÅ∏È†Ö
                if (document.getElementById('optionsList').children.length === 0) {
                    addOption();
                    addOption();
                }
            } else {
                customOptions.style.display = 'none';
                // Ê∏ÖÁ©∫Ëá™ÂÆöÁæ©ÈÅ∏È†Ö
                document.getElementById('optionsList').innerHTML = '';
            }
        }

        function addOption() {
            const optionsList = document.getElementById('optionsList');
            const currentCount = optionsList.children.length;
            
            // ÊúÄÂ§ö8ÂÄãÈÅ∏È†Ö
            if (currentCount >= 8) {
                alert('ÊúÄÂ§öÂè™ËÉΩÊ∑ªÂä†8ÂÄãÈÅ∏È†Ö');
                return;
            }
            
            const optionDiv = document.createElement('div');
            optionDiv.className = 'option-input';
            optionDiv.innerHTML = `
                <span class="option-number">ÈÅ∏È†Ö ${currentCount + 1}:</span>
                <input type="text" class="form-input" name="customOption${currentCount + 1}" placeholder="Ëº∏ÂÖ•ÈÅ∏È†ÖÂêçÁ®±" required>
                <button type="button" class="btn btn-secondary btn-sm" onclick="removeOption(this)">Âà™Èô§</button>
            `;
            optionsList.appendChild(optionDiv);
            
            updateRemoveButtons();
        }

        function removeOption(button) {
            const optionsList = document.getElementById('optionsList');
            const currentCount = optionsList.children.length;
            
            // Ëá≥Â∞ë‰øùÁïô2ÂÄãÈÅ∏È†Ö
            if (currentCount <= 2) {
                alert('Ëá≥Â∞ëÈúÄË¶Å‰øùÁïô2ÂÄãÈÅ∏È†Ö');
                return;
            }
            
            button.parentElement.remove();
            updateOptionNumbers();
            updateRemoveButtons();
        }

        function updateOptionNumbers() {
            const optionsList = document.getElementById('optionsList');
            const options = optionsList.children;
            
            for (let i = 0; i < options.length; i++) {
                const numberSpan = options[i].querySelector('.option-number');
                const input = options[i].querySelector('input');
                numberSpan.textContent = `ÈÅ∏È†Ö ${i + 1}:`;
                input.name = `customOption${i + 1}`;
            }
        }

        function updateRemoveButtons() {
            const optionsList = document.getElementById('optionsList');
            const removeButtons = optionsList.querySelectorAll('.btn-secondary');
            const currentCount = optionsList.children.length;
            
            // Áï∂Âè™Êúâ2ÂÄãÈÅ∏È†ÖÊôÇÁ¶ÅÁî®Âà™Èô§ÊåâÈàï
            removeButtons.forEach(button => {
                if (currentCount <= 2) {
                    button.disabled = true;
                    button.style.opacity = '0.5';
                } else {
                    button.disabled = false;
                    button.style.opacity = '1';
                }
            });
        }

        // ÂàáÊèõPumpË®≠ÂÆöÁöÑÂèØÁî®ÊÄß
        function togglePumpSettings() {
            const isPrivate = document.getElementById('isPrivate').checked;
            const pumpSection = document.getElementById('pumpSection');
            
            if (isPrivate) {
                pumpSection.classList.add('disabled');
                // Á¶ÅÁî®PumpË®≠ÂÆö‰∏≠ÁöÑËº∏ÂÖ•
                const pumpInput = document.querySelector('input[name="pumpCondition"]');
                if (pumpInput) pumpInput.disabled = true;
            } else {
                pumpSection.classList.remove('disabled');
                // ÂïüÁî®PumpË®≠ÂÆö‰∏≠ÁöÑËº∏ÂÖ•
                const pumpInput = document.querySelector('input[name="pumpCondition"]');
                if (pumpInput) pumpInput.disabled = false;
            }
        }

        // ÂàáÊèõÈ´òÁ¥öË®≠ÂÆöÁöÑÈ°ØÁ§∫
        function toggleAdvancedSettings() {
            const showAdvanced = document.getElementById('showAdvanced').checked;
            const advancedSettings = document.getElementById('advancedSettings');
            
            if (showAdvanced) {
                advancedSettings.style.display = 'block';
            } else {
                advancedSettings.style.display = 'none';
                // Ê∏ÖÁ©∫È´òÁ¥öË®≠ÂÆöÁöÑÂÄº
                const outerTradingEndTime = document.querySelector('input[name="outerTradingEndTime"]');
                if (outerTradingEndTime) outerTradingEndTime.value = '';
            }
        }

        // Áï∂Ë©±È°åÁµêÊùüÊôÇÈñìÊîπËÆäÊôÇÔºåÊõ¥Êñ∞Trade‰∫§ÊòìÁµêÊùüÊôÇÈñìÁöÑÈªòË™çÂÄº
        function updateAdvancedSettings() {
            const topicEndTime = document.querySelector('input[name="topicEndTime"]').value;
            const outerTradingEndTime = document.querySelector('input[name="outerTradingEndTime"]');
            
            if (outerTradingEndTime && !outerTradingEndTime.value) {
                outerTradingEndTime.value = topicEndTime;
            }
        }

        // KÁ∑öÂúñÁõ∏ÈóúÂäüËÉΩ
        let currentTimeframe = '1m';
        let klineData = [];
        let priceData = [];
        let chartInterval = null;

        // ÂàùÂßãÂåñÂÉπÊ†ºËµ∞Âã¢Âúñ
        function initKlineChart() {
            if (!currentTopic || currentTopic.status !== 'outer') return;
            
            // ÁîüÊàêÊ®°Êì¨ÂÉπÊ†ºÊï∏Êìö
            generatePriceData();
            renderPriceChart();
            
            // ÂïüÂãïÂØ¶ÊôÇÊõ¥Êñ∞
            if (chartInterval) clearInterval(chartInterval);
            chartInterval = setInterval(() => {
                updatePriceData();
                renderPriceChart();
            }, 3000); // ÊØè3ÁßíÊõ¥Êñ∞‰∏ÄÊ¨°
        }

        // ÁîüÊàêÊ®°Êì¨ÂÉπÊ†ºÊï∏Êìö
        function generatePriceData() {
            const { yesAmount, noAmount } = currentTopic.outerPool;
            const totalAmount = yesAmount + noAmount;
            const baseYesPrice = totalAmount > 0 ? yesAmount / totalAmount : 0.5;
            const baseNoPrice = 1 - baseYesPrice;
            
            priceData = [];
            const now = Date.now();
            const pointCount = 20; // È°ØÁ§∫20ÂÄãÂÉπÊ†ºÈªû
            
            for (let i = pointCount - 1; i >= 0; i--) {
                const timestamp = now - i * 30000; // ÊØè30Áßí‰∏ÄÂÄãÂÉπÊ†ºÈªû
                const yesVariation = (Math.random() - 0.5) * 0.08; // ¬±4%ËÆäÂãï
                const noVariation = (Math.random() - 0.5) * 0.08;
                
                const yesPrice = Math.max(0.1, Math.min(0.9, baseYesPrice + yesVariation));
                const noPrice = Math.max(0.1, Math.min(0.9, baseNoPrice + noVariation));
                
                priceData.push({
                    timestamp,
                    yesPrice: Math.max(0.1, Math.min(0.9, yesPrice)),
                    noPrice: Math.max(0.1, Math.min(0.9, noPrice))
                });
            }
        }

        // Êõ¥Êñ∞ÂÉπÊ†ºÊï∏Êìö
        function updatePriceData() {
            if (priceData.length === 0) return;
            
            const lastPoint = priceData[priceData.length - 1];
            const yesVariation = (Math.random() - 0.5) * 0.01; // ¬±0.5%ËÆäÂãï
            const noVariation = (Math.random() - 0.5) * 0.01;
            
            const newYesPrice = Math.max(0.1, Math.min(0.9, lastPoint.yesPrice + yesVariation));
            const newNoPrice = Math.max(0.1, Math.min(0.9, lastPoint.noPrice + noVariation));
            
            // Êõ¥Êñ∞ÊúÄÂæå‰∏ÄÂÄãÂÉπÊ†ºÈªû
            priceData[priceData.length - 1] = {
                ...lastPoint,
                yesPrice: newYesPrice,
                noPrice: newNoPrice
            };
            
            // ÊúâÊôÇÂÄôÊ∑ªÂä†Êñ∞ÁöÑÂÉπÊ†ºÈªû
            if (Math.random() < 0.15) {
                const newPoint = {
                    timestamp: Date.now(),
                    yesPrice: newYesPrice + (Math.random() - 0.5) * 0.02,
                    noPrice: newNoPrice + (Math.random() - 0.5) * 0.02
                };
                
                priceData.push(newPoint);
                if (priceData.length > 20) {
                    priceData.shift(); // ‰øùÊåÅ20ÂÄãÂÉπÊ†ºÈªû
                }
            }
        }

        // Ê∏≤ÊüìÂÉπÊ†ºËµ∞Âã¢Âúñ
        function renderPriceChart() {
            const chartContainer = document.getElementById('centerKlineChart');
            if (!chartContainer || priceData.length === 0) return;
            
            // Ê∏ÖÁ©∫ÁèæÊúâÂÖßÂÆπ
            chartContainer.innerHTML = '';
            
            // Ë®àÁÆóÂÉπÊ†ºÁØÑÂúç
            const allYesPrices = priceData.map(p => p.yesPrice);
            const allNoPrices = priceData.map(p => p.noPrice);
            const minPrice = Math.min(...allYesPrices, ...allNoPrices);
            const maxPrice = Math.max(...allYesPrices, ...allNoPrices);
            const priceRange = maxPrice - minPrice || 0.1;
            
            const chartWidth = chartContainer.clientWidth - 32;
            const chartHeight = 200;
            const pointWidth = chartWidth / priceData.length;
            
            // ÂâµÂª∫SVGÂÆπÂô®
            const svg = document.createElementNS('http://www.w3.org/2000/svg', 'svg');
            svg.setAttribute('width', chartWidth);
            svg.setAttribute('height', chartHeight);
            svg.style.position = 'absolute';
            svg.style.top = '16px';
            svg.style.left = '16px';
            chartContainer.appendChild(svg);
            
            // Áπ™Ë£ΩYESÂÉπÊ†ºÁ∑ö
            let yesPath = '';
            priceData.forEach((point, index) => {
                const x = (index / (priceData.length - 1)) * chartWidth;
                const y = chartHeight - ((point.yesPrice - minPrice) / priceRange) * chartHeight;
                
                if (index === 0) {
                    yesPath += `M ${x} ${y}`;
                } else {
                    yesPath += ` L ${x} ${y}`;
                }
            });
            
            const yesLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            yesLine.setAttribute('d', yesPath);
            yesLine.setAttribute('stroke', '#10b981');
            yesLine.setAttribute('stroke-width', '2');
            yesLine.setAttribute('fill', 'none');
            svg.appendChild(yesLine);
            
            // Áπ™Ë£ΩNOÂÉπÊ†ºÁ∑ö
            let noPath = '';
            priceData.forEach((point, index) => {
                const x = (index / (priceData.length - 1)) * chartWidth;
                const y = chartHeight - ((point.noPrice - minPrice) / priceRange) * chartHeight;
                
                if (index === 0) {
                    noPath += `M ${x} ${y}`;
                } else {
                    noPath += ` L ${x} ${y}`;
                }
            });
            
            const noLine = document.createElementNS('http://www.w3.org/2000/svg', 'path');
            noLine.setAttribute('d', noPath);
            noLine.setAttribute('stroke', '#ef4444');
            noLine.setAttribute('stroke-width', '2');
            noLine.setAttribute('fill', 'none');
            svg.appendChild(noLine);
            
            // Ê∑ªÂä†Êï∏ÊìöÈªû
            priceData.forEach((point, index) => {
                const x = (index / (priceData.length - 1)) * chartWidth;
                const yesY = chartHeight - ((point.yesPrice - minPrice) / priceRange) * chartHeight;
                const noY = chartHeight - ((point.noPrice - minPrice) / priceRange) * chartHeight;
                
                // YESÊï∏ÊìöÈªû
                const yesCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                yesCircle.setAttribute('cx', x);
                yesCircle.setAttribute('cy', yesY);
                yesCircle.setAttribute('r', '3');
                yesCircle.setAttribute('fill', '#10b981');
                svg.appendChild(yesCircle);
                
                // NOÊï∏ÊìöÈªû
                const noCircle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                noCircle.setAttribute('cx', x);
                noCircle.setAttribute('cy', noY);
                noCircle.setAttribute('r', '3');
                noCircle.setAttribute('fill', '#ef4444');
                svg.appendChild(noCircle);
                
                // Ê∑ªÂä†ÊôÇÈñìÊ®ôÁ±§
                const timeLabel = document.createElement('div');
                timeLabel.className = 'line-chart-label';
                timeLabel.textContent = new Date(point.timestamp).toLocaleTimeString('zh-TW', { 
                    hour: '2-digit', 
                    minute: '2-digit' 
                });
                timeLabel.style.cssText = `
                    position: absolute;
                    left: ${x + 16}px;
                    bottom: 0;
                    font-size: 0.7rem;
                    color: #9ca3af;
                    transform: translateX(-50%);
                `;
                chartContainer.appendChild(timeLabel);
            });
            
            // Ê∑ªÂä†Âúñ‰æã
            const legend = document.createElement('div');
            legend.style.cssText = 'position: absolute; top: 0.5rem; left: 0.5rem; display: flex; gap: 1rem; font-size: 0.8rem;';
            legend.innerHTML = `
                <span style="color: #10b981;">‚óè YESÂÉπÊ†º</span>
                <span style="color: #ef4444;">‚óè NOÂÉπÊ†º</span>
            `;
            chartContainer.appendChild(legend);
            
            // Ê∑ªÂä†Áï∂ÂâçÂÉπÊ†ºÊåáÁ§∫Âô®
            const lastPoint = priceData[priceData.length - 1];
            const priceIndicator = document.createElement('div');
            priceIndicator.className = 'price-indicator';
            priceIndicator.textContent = `YES: ${lastPoint.yesPrice.toFixed(3)} | NO: ${lastPoint.noPrice.toFixed(3)}`;
            chartContainer.appendChild(priceIndicator);
        }

        // È°ØÁ§∫Â∑•ÂÖ∑ÊèêÁ§∫
        function showTooltip(event, bar) {
            let tooltip = document.querySelector('.chart-tooltip');
            if (!tooltip) {
                tooltip = document.createElement('div');
                tooltip.className = 'chart-tooltip';
                document.body.appendChild(tooltip);
            }
            
            const time = new Date(bar.timestamp).toLocaleTimeString();
            tooltip.innerHTML = `
                <div>ÊôÇÈñì: ${time}</div>
                <div>Èñã: ${bar.open.toFixed(3)}</div>
                <div>È´ò: ${bar.high.toFixed(3)}</div>
                <div>‰Ωé: ${bar.low.toFixed(3)}</div>
                <div>Êî∂: ${bar.close.toFixed(3)}</div>
                <div>Èáè: ${bar.volume}</div>
            `;
            
            tooltip.style.left = `${event.pageX + 10}px`;
            tooltip.style.top = `${event.pageY - 10}px`;
            tooltip.style.opacity = '1';
        }

        // Èö±ËóèÂ∑•ÂÖ∑ÊèêÁ§∫
        function hideTooltip() {
            const tooltip = document.querySelector('.chart-tooltip');
            if (tooltip) {
                tooltip.style.opacity = '0';
            }
        }

        // ÂàáÊèõÊôÇÈñìÊ°ÜÊû∂
        function switchTimeframe(timeframe) {
            currentTimeframe = timeframe;
            
            // Êõ¥Êñ∞ÊåâÈàïÁãÄÊÖã
            document.querySelectorAll('.chart-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event.target.classList.add('active');
            
            // ÈáçÊñ∞ÁîüÊàêÊï∏Êìö
            generatePriceData();
                            renderPriceChart();
        }

        // Âø´ÈÄü‰∏ãÂñÆÂäüËÉΩ
        let userBalance = 10000; // Ê®°Êì¨Áî®Êà∂È§òÈ°ç

        // Ë®≠ÁΩÆÂø´ÈÄüÈáëÈ°ç (PK)
        function setQuickAmount(amount) {
            document.getElementById('betAmount').value = amount;
            
            // Êõ¥Êñ∞Âø´ÈÄüÊåâÈàïÁãÄÊÖã
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === amount.toString() || 
                    (amount === 1000 && btn.textContent === '1K') ||
                    (amount === 5000 && btn.textContent === '5K')) {
                    btn.classList.add('active');
                }
            });
            
            // Ê™¢Êü•È§òÈ°ç
            checkInnerBalance();
        }

        // Ë®≠ÁΩÆÂ§öÈÅ∏È†ÖÂø´Êç∑ÈáëÈ°ç
        function setMultiOptionQuickAmount(amount) {
            document.getElementById('multiOptionAmount').value = amount;
            
            // Ê™¢Êü•È§òÈ°ç
            checkInnerBalance();
        }

        // Ë®≠ÁΩÆÂø´ÈÄüÈáëÈ°ç (Trade)
        function setLMSRQuickAmount(amount) {
            document.getElementById('lmsrAmount').value = amount;
            
            // Êõ¥Êñ∞Âø´ÈÄüÊåâÈàïÁãÄÊÖã
            document.querySelectorAll('.quick-btn').forEach(btn => {
                btn.classList.remove('active');
                if (btn.textContent === amount.toString()) {
                    btn.classList.add('active');
                }
            });
            
            // Ëß∏ÁôºLMSRÂÉπÊ†ºÊõ¥Êñ∞ÂíåÈ§òÈ°çÊ™¢Êü•
            updateLMSRPrices();
            checkLMSRBalance();
        }

        // Ë®≠ÁΩÆÂ§öÈÅ∏È†ÖLMSRÂø´Êç∑ÈáëÈ°ç
        function setMultiLMSRQuickAmount(amount) {
            document.getElementById('multiLmsrAmount').value = amount;
            
            // Ê™¢Êü•È§òÈ°ç
            checkLMSRBalance();
        }

        // Ê™¢Êü•PK‰∫§ÊòìÈ§òÈ°ç
        function checkInnerBalance() {
            // Ê™¢Êü•‰∫åÂÖÉÈÅ∏È†ÖÔºàbetAmountÔºâ
            const betAmountEl = document.getElementById('betAmount');
            if (betAmountEl) {
                const amount = parseFloat(betAmountEl.value) || 0;
                if (amount > 0) {
                    const totalCost = amount; // PKÊòØÂÖ®È°çÊäïÂÖ•ÔºåÊâãÁ∫åË≤ªÂæû‰∏≠Êâ£Èô§
                    
                    const balanceElement = document.getElementById('userBalance');
                    const rechargeBtn = document.getElementById('rechargeBtn');
                    
                    if (totalCost > userBalance) {
                        if (balanceElement) balanceElement.classList.add('insufficient');
                        if (rechargeBtn) rechargeBtn.style.display = 'block';
                    } else {
                        if (balanceElement) balanceElement.classList.remove('insufficient');
                        if (rechargeBtn) rechargeBtn.style.display = 'none';
                    }
                }
            }

            // Ê™¢Êü•Â§öÈÅ∏È†ÖÔºàmultiOptionAmountÔºâ
            const multiOptionAmountEl = document.getElementById('multiOptionAmount');
            if (multiOptionAmountEl) {
                const amount = parseFloat(multiOptionAmountEl.value) || 0;
                if (amount > 0) {
                    const totalCost = amount; // PKÊòØÂÖ®È°çÊäïÂÖ•ÔºåÊâãÁ∫åË≤ªÂæû‰∏≠Êâ£Èô§
                    
                    const multiBalanceElement = document.getElementById('multiUserBalance');
                    const multiRechargeBtn = document.getElementById('multiRechargeBtn');
                    
                    if (totalCost > userBalance) {
                        if (multiBalanceElement) multiBalanceElement.classList.add('insufficient');
                        if (multiRechargeBtn) multiRechargeBtn.style.display = 'block';
                    } else {
                        if (multiBalanceElement) multiBalanceElement.classList.remove('insufficient');
                        if (multiRechargeBtn) multiRechargeBtn.style.display = 'none';
                    }
                }
            }
        }

        // Ê™¢Êü•LMSR‰∫§ÊòìÈ§òÈ°ç
        function checkLMSRBalance() {
            // Ê™¢Êü•‰∫åÂÖÉÈÅ∏È†ÖLMSR
            const lmsrAmountEl = document.getElementById('lmsrAmount');
            if (lmsrAmountEl) {
                const amount = parseFloat(lmsrAmountEl.value) || 0;
                if (amount > 0) {
                    // Ë®àÁÆóÈ†êÊúüÊàêÊú¨ÔºàÂü∫ÊñºÁï∂ÂâçÂÉπÊ†ºÔºâ
                    const yesPrice = currentTopic?.outerPool ? 
                        currentTopic.outerPool.yesAmount / currentTopic.outerPool.totalAmount : 0.5;
                    const noPrice = currentTopic?.outerPool ? 
                        currentTopic.outerPool.noAmount / currentTopic.outerPool.totalAmount : 0.5;
                    
                    // ‰ΩøÁî®ËºÉÈ´òÁöÑÂÉπÊ†º‰æÜ‰º∞ÁÆóÊúÄÂ§ßÊàêÊú¨
                    const maxPrice = Math.max(yesPrice, noPrice);
                    const estimatedCost = amount * maxPrice * 1.05; // ÂåÖÂê´5%ÊâãÁ∫åË≤ª
                    
                    const outerBalanceElement = document.getElementById('outerUserBalance');
                    const outerRechargeBtn = document.getElementById('outerRechargeBtn');
                    
                    if (estimatedCost > userBalance) {
                        if (outerBalanceElement) outerBalanceElement.classList.add('insufficient');
                        if (outerRechargeBtn) outerRechargeBtn.style.display = 'block';
                    } else {
                        if (outerBalanceElement) outerBalanceElement.classList.remove('insufficient');
                        if (outerRechargeBtn) outerRechargeBtn.style.display = 'none';
                    }
                }
            }

            // Ê™¢Êü•Â§öÈÅ∏È†ÖLMSR
            const multiLmsrAmountEl = document.getElementById('multiLmsrAmount');
            if (multiLmsrAmountEl) {
                const amount = parseFloat(multiLmsrAmountEl.value) || 0;
                if (amount > 0) {
                    // Â§öÈÅ∏È†ÖLMSRÁ∞°Âåñ‰º∞ÁÆóÔºà‰ΩøÁî®Âπ≥ÂùáÂÉπÊ†ºÔºâ
                    const estimatedCost = amount * 0.6 * 1.05; // ÂÅáË®≠Âπ≥ÂùáÂÉπÊ†º0.6ÔºåÂåÖÂê´5%ÊâãÁ∫åË≤ª
                    
                    const multiOuterBalanceElement = document.getElementById('multiOuterUserBalance');
                    const multiOuterRechargeBtn = document.getElementById('multiOuterRechargeBtn');
                    
                    if (estimatedCost > userBalance) {
                        if (multiOuterBalanceElement) multiOuterBalanceElement.classList.add('insufficient');
                        if (multiOuterRechargeBtn) multiOuterRechargeBtn.style.display = 'block';
                    } else {
                        if (multiOuterBalanceElement) multiOuterBalanceElement.classList.remove('insufficient');
                        if (multiOuterRechargeBtn) multiOuterRechargeBtn.style.display = 'none';
                    }
                }
            }
        }

        // Ê™¢Êü•È§òÈ°ç
        function checkBalance(amount) {
            const balanceElement = document.getElementById('userBalance');
            const outerBalanceElement = document.getElementById('outerUserBalance');
            const rechargeBtn = document.getElementById('rechargeBtn');
            const outerRechargeBtn = document.getElementById('outerRechargeBtn');
            
            // Êõ¥Êñ∞È§òÈ°çÈ°ØÁ§∫
            if (balanceElement) {
                balanceElement.textContent = `${userBalance.toLocaleString()} USDT`;
                if (amount > userBalance) {
                    balanceElement.classList.add('insufficient');
                    if (rechargeBtn) rechargeBtn.style.display = 'block';
                } else {
                    balanceElement.classList.remove('insufficient');
                    if (rechargeBtn) rechargeBtn.style.display = 'none';
                }
            }
            
            if (outerBalanceElement) {
                outerBalanceElement.textContent = `${userBalance.toLocaleString()} USDT`;
            }
        }

        // È°ØÁ§∫ÂÖÖÂÄºÁïåÈù¢
        function showRecharge() {
            alert('ÂÖÖÂÄºÂäüËÉΩÂ∞áË∑≥ËΩâÂà∞ÂÖÖÂÄºÈ†ÅÈù¢\n\n‚Ä¢ ÊîØÊåÅÈäÄË°åÂç°ÂÖÖÂÄº\n‚Ä¢ ÊîØÊåÅÊï∏Â≠óË≤®Âπ£ÂÖÖÂÄº\n‚Ä¢ ÊîØÊåÅÁ¨¨‰∏âÊñπÊîØ‰ªò\n\nÂÖÖÂÄºÂæåÈ§òÈ°çÂ∞áÂç≥ÊôÇÂà∞Ë≥¨');
            
            // Ê®°Êì¨ÂÖÖÂÄºÊàêÂäü
            if (confirm('ÊòØÂê¶Ê®°Êì¨ÂÖÖÂÄº 5000 USDTÔºü')) {
                userBalance += 5000;
                updateBalanceDisplay();
                alert('ÂÖÖÂÄºÊàêÂäüÔºÅÈ§òÈ°çÂ∑≤Êõ¥Êñ∞');
            }
        }

        // Êõ¥Êñ∞ÊâÄÊúâÈ§òÈ°çÈ°ØÁ§∫
        function updateBalanceDisplay() {
            const balanceElement = document.getElementById('userBalance');
            const outerBalanceElement = document.getElementById('outerUserBalance');
            
            if (balanceElement) {
                balanceElement.textContent = `${userBalance.toLocaleString()} USDT`;
                balanceElement.classList.remove('insufficient');
            }
            
            if (outerBalanceElement) {
                outerBalanceElement.textContent = `${userBalance.toLocaleString()} USDT`;
                outerBalanceElement.classList.remove('insufficient');
            }
            
            // Èö±ËóèÂÖÖÂÄºÊåâÈàï
            const rechargeBtn = document.getElementById('rechargeBtn');
            const outerRechargeBtn = document.getElementById('outerRechargeBtn');
            const multiRechargeBtn = document.getElementById('multiRechargeBtn');
            const multiOuterRechargeBtn = document.getElementById('multiOuterRechargeBtn');
            if (rechargeBtn) rechargeBtn.style.display = 'none';
            if (outerRechargeBtn) outerRechargeBtn.style.display = 'none';
            if (multiRechargeBtn) multiRechargeBtn.style.display = 'none';
            if (multiOuterRechargeBtn) multiOuterRechargeBtn.style.display = 'none';
            
            // ÈáçÊñ∞Ê™¢Êü•È§òÈ°çÔºàÂ¶ÇÊûúÊúâËº∏ÂÖ•ÂÄºÔºâ
            const betAmount = document.getElementById('betAmount');
            const multiOptionAmount = document.getElementById('multiOptionAmount');
            if ((betAmount && betAmount.value) || (multiOptionAmount && multiOptionAmount.value)) {
                checkInnerBalance();
            }
            
            const lmsrAmount = document.getElementById('lmsrAmount');
            const multiLmsrAmount = document.getElementById('multiLmsrAmount');
            if ((lmsrAmount && lmsrAmount.value) || (multiLmsrAmount && multiLmsrAmount.value)) {
                checkLMSRBalance();
            }
        }

        // È†ÅÈù¢Âä†ËºâÊôÇÂàùÂßãÂåñÈ§òÈ°ç
        document.addEventListener('DOMContentLoaded', function() {
            updateBalanceDisplay();
        });

        // ÂâµÂª∫Ë©±È°åË°®ÂçïÊèê‰∫§
        document.getElementById('createTopicForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const formData = new FormData(e.target);
            const isPrivate = formData.get('isPrivate') === 'on';
            const pumpCondition = parseInt(formData.get('pumpCondition')) || 1000;
            
            // ËôïÁêÜÈ†≠ÂÉè - Â¶ÇÊûúÊòØÊñá‰ª∂ÂâáÈ°ØÁ§∫Êñá‰ª∂ÂêçÔºåÂê¶Ââá‰ΩøÁî®È¶ñÂ≠óÁ¨¶
            let avatar;
            const avatarFile = formData.get('avatar');
            if (avatarFile && avatarFile.name) {
                avatar = 'üì∑'; // ‰ΩøÁî®Áõ∏Ê©üemojiË°®Á§∫Â∑≤‰∏äÂÇ≥ÂúñÁâá
            } else {
                avatar = formData.get('content').charAt(0).toUpperCase();
            }
            
            const newTopic = {
                id: Date.now(),
                title: formData.get('content'),
                category: formData.get('category'),
                categoryName: e.target.category.selectedOptions[0].text,
                avatar: avatar,
                innerPool: {
                    yesAmount: 0,
                    noAmount: 0,
                    totalAmount: 0
                },
                outerPool: null,
                isOuter: false,
                endTime: formData.get('topicEndTime').split('T')[0],
                tradingEndTime: formData.get('tradingEndTime'), // PK‰∫§ÊòìÁµêÊùüÊôÇÈñì
                status: 'inner',
                description: formData.get('content'),
                isPrivate: isPrivate,
                pumpCondition: isPrivate ? null : pumpCondition, // ÁßÅÂØÜË©±È°å‰∏çË®≠ÂÆöPumpÊ¢ù‰ª∂
                outerTradingEndTime: formData.get('outerTradingEndTime') || formData.get('topicEndTime'), // È´òÁ¥öË®≠ÂÆö
                myInnerYes: 0,
                myInnerNo: 0,
                myOuterYes: 0,
                myOuterNo: 0
            };

            sampleTopics.push(newTopic);
            alert('ËØùÈ¢òÂàõÂª∫ÊàêÂäüÔºÅ');
            
            // ÈáçÁΩÆË°®Âçï
            e.target.reset();
            
            // Ë∑≥ËΩ¨Âà∞Ë©±È°åË©≥ÊÉÖ
            showTopicDetail(newTopic.id);
        });

        // Ê∏≤ÊüìÂÄã‰∫∫‰∏≠ÂøÉÊï∞ÊçÆ
        function renderProfileData() {
            // ËÆ°ÁÆóÁªüËÆ°Êï∞ÊçÆ
            let totalInvested = 0;  // Á∏ΩÊäïÂÖ•
            let totalValue = 0;     // ÊåÅÂÄâÂÉπÂÄº
            let participatedTopics = 0;  // ÂèÉËàáË©±È°åÊï∏
            let totalTradingVolume = 0;  // Á∏Ω‰∫§ÊòìÈáè

            sampleTopics.forEach(topic => {
                const myInnerYes = topic.myInnerYes || 0;
                const myInnerNo = topic.myInnerNo || 0;
                const myOuterYes = topic.myOuterYes || 0;
                const myOuterNo = topic.myOuterNo || 0;
                
                const myInnerTotal = myInnerYes + myInnerNo;
                const myOuterTotal = myOuterYes + myOuterNo;
                const myTotal = myInnerTotal + myOuterTotal;
                
                if (myTotal > 0) {
                    participatedTopics++;
                    totalInvested += myTotal;
                    
                    // Ë®àÁÆóÁï∂ÂâçÊåÅÂÄâÂÉπÂÄº
                    let currentValue = myInnerTotal; // PKÊåâÂéüÂÄºË®àÁÆó
                    
                    // Ë®àÁÆó‰∫§ÊòìÈáèÔºàÂåÖÊã¨PKÂíåTradeÁöÑÊâÄÊúâ‰∫§ÊòìÔºâ
                    totalTradingVolume += myInnerTotal; // PKÊäïÂÖ•
                    
                    if (topic.status === 'outer' && topic.outerPool && topic.outerPool.totalAmount > 0) {
                        const yesPrice = topic.outerPool.yesAmount / topic.outerPool.totalAmount;
                        const noPrice = topic.outerPool.noAmount / topic.outerPool.totalAmount;
                        const outerValue = myOuterYes * yesPrice + myOuterNo * noPrice;
                        currentValue = myInnerTotal + outerValue;
                        
                        // Trade‰∫§ÊòìÈáè‰º∞ÁÆóÔºàÂÅáË®≠‰ª£Âπ£ÊòØ‰ª•Áï∂ÂâçÂÉπÊ†ºË≤∑ÂÖ•ÁöÑÔºâ
                        const outerTradeValue = myOuterYes * yesPrice + myOuterNo * noPrice;
                        totalTradingVolume += outerTradeValue;
                        
                        // Ê®°Êì¨Ê≠∑Âè≤‰∫§ÊòìÈáèÔºàÁÇ∫‰∫ÜÈÅîÂà∞30MÁöÑÊ∞¥Âπ≥Ôºâ
                        totalTradingVolume += topic.outerPool.totalAmount * 0.1; // ÂÅáË®≠ÂèÉËàá‰∫ÜÁ∏ΩÊ±†ÁöÑ10%ÁöÑ‰∫§Êòì
                    }
                    
                    // ÁÇ∫ÊØèÂÄãË©±È°åÊ∑ªÂä†Ê®°Êì¨ÁöÑÊ≠∑Âè≤‰∫§ÊòìÈáè
                    totalTradingVolume += (topic.innerPool?.totalAmount || 0) * 2; // Ê®°Êì¨Â§öÊ¨°PK‰∫§Êòì
                    
                    totalValue += currentValue;
                }
            });

            // Ê®°Êì¨Êõ¥Â§ßÁöÑ‰∫§ÊòìÈáè‰ª•ÈÅîÂà∞ÂêàÁêÜÁöÑÊï∏ÂÄº
            totalTradingVolume = totalTradingVolume * 50000; // ÊîæÂ§ßÂÄçÊï∏‰ª•ÈÅîÂà∞30MÁ¥öÂà•

            const totalProfit = totalValue - totalInvested;

            // Ê†ºÂºèÂåñÊï∏Â≠óÈ°ØÁ§∫
            const formatNumber = (num) => {
                if (num >= 1000000) {
                    return (num / 1000000).toFixed(1) + 'M';
                } else if (num >= 1000) {
                    return (num / 1000).toFixed(1) + 'K';
                } else {
                    return num.toFixed(2);
                }
            };

            // Êõ¥Êñ∞Áµ±Ë®àÊï∏Êìö
            document.getElementById('totalAssets').textContent = `${formatNumber(totalValue)} U`;
            document.getElementById('totalProfit').textContent = totalProfit >= 0 ? 
                `+${formatNumber(totalProfit)} U` : `${formatNumber(totalProfit)} U`;
            document.getElementById('totalTopics').textContent = participatedTopics;
            document.getElementById('totalTrades').textContent = `${formatNumber(totalTradingVolume)} U`;

            // Ê∏≤ÊüìÁï∂ÂâçÊåÅÂÄâ
            renderCurrentPositions();
            
            // Ê∏≤Êüì‰∫§ÊòìÊ≠∑Âè≤
            renderTradingHistory();
        }

        // Ê∏≤ÊüìÁï∂ÂâçÊåÅÂÄâ
        function renderCurrentPositions() {
            const container = document.getElementById('currentPositions');
            container.innerHTML = '';

            const activePositions = sampleTopics.filter(topic => {
                const myInnerTotal = (topic.myInnerYes || 0) + (topic.myInnerNo || 0);
                const myOuterTotal = (topic.myOuterYes || 0) + (topic.myOuterNo || 0);
                return (myInnerTotal > 0 || myOuterTotal > 0) && topic.status !== 'ended';
            });

            if (activePositions.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìä</div>
                        <p>Êö´ÁÑ°Ê¥ªË∑ÉÊåÅ‰ªì</p>
                        <p style="font-size: 0.8rem; margin-top: 0.5rem;">ÂèÉËàáË©±È°å‰∫§ÊòìÂêéÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫</p>
                    </div>
                `;
                return;
            }

            activePositions.forEach(topic => {
                const myInnerYes = topic.myInnerYes || 0;
                const myInnerNo = topic.myInnerNo || 0;
                const myOuterYes = topic.myOuterYes || 0;
                const myOuterNo = topic.myOuterNo || 0;
                
                const myInnerTotal = myInnerYes + myInnerNo;
                const myOuterTotal = myOuterYes + myOuterNo;
                const myTotal = myInnerTotal + myOuterTotal;
                
                // Á°ÆÂÆö‰∏ªË¶ÅÊåÅ‰ªìÁ±ªÂûãÂíåÈáëÈ¢ù
                let position, positionAmount, positionType;
                if (myInnerTotal > myOuterTotal) {
                    position = myInnerYes > myInnerNo ? 'YES' : 'NO';
                    positionAmount = Math.max(myInnerYes, myInnerNo);
                    positionType = 'PK';
                } else if (myOuterTotal > 0) {
                    position = myOuterYes > myOuterNo ? 'YES' : 'NO';
                    positionAmount = Math.max(myOuterYes, myOuterNo);
                    positionType = 'Trade';
                } else {
                    position = myInnerYes > myInnerNo ? 'YES' : 'NO';
                    positionAmount = Math.max(myInnerYes, myInnerNo);
                    positionType = 'PK';
                }

                // ËÆ°ÁÆóÂΩìÂâç‰ª∑ÂÄº
                let currentValue = myInnerTotal;
                let valueClass = 'neutral';
                if (topic.status === 'outer' && topic.outerPool && topic.outerPool.totalAmount > 0) {
                    const yesPrice = topic.outerPool.yesAmount / topic.outerPool.totalAmount;
                    const noPrice = topic.outerPool.noAmount / topic.outerPool.totalAmount;
                    const outerValue = myOuterYes * yesPrice + myOuterNo * noPrice;
                    currentValue = myInnerTotal + outerValue;
                    valueClass = currentValue > myTotal ? 'positive' : currentValue < myTotal ? 'negative' : 'neutral';
                }

                const profitLoss = currentValue - myTotal;

                container.innerHTML += `
                    <div class="position-item" onclick="showTopicDetail(${topic.id})">
                        <div class="position-info">
                            <div class="position-title">${topic.title}</div>
                            <div class="position-details">
                                <span>ÊåÅ‰ªìÔºö${position} ${positionAmount} ${positionType === 'Trade' ? '‰∏™' : 'USDT'}</span>
                                <span>Áä∂ÊÄÅÔºö${positionType}</span>
                                <span>ÁªìÊùüÔºö${topic.endTime}</span>
                            </div>
                        </div>
                        <div class="position-value">
                            <div class="position-amount ${valueClass}">${currentValue.toFixed(2)} USDT</div>
                            <div class="position-status status-active">
                                ${profitLoss >= 0 ? '+' : ''}${profitLoss.toFixed(2)}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // Ê∏≤Êüì‰∫§ÊòìÊ≠∑Âè≤
        function renderTradingHistory() {
            const container = document.getElementById('tradingHistory');
            
            // Ê®°Êãü‰∫§ÊòìÊ≠∑Âè≤Êï∞ÊçÆ
            const historyData = [
                {
                    id: 1,
                    title: "ÊØîÁâπÂ∏ÅÂÉπÊ†ºÈ¢ÑÊµã",
                    position: "YES",
                    amount: 100,
                    result: "won",
                    profit: 45.5,
                    date: "2024-01-15"
                },
                {
                    id: 2,
                    title: "ÁæéÂõΩÂ§ßÈÄâÈ¢ÑÊµã",
                    position: "NO",
                    amount: 200,
                    result: "won",
                    profit: 89.2,
                    date: "2024-01-10"
                },
                {
                    id: 3,
                    title: "ÁâπÊñØÊãâËÇ°‰ª∑È¢ÑÊµã",
                    position: "YES",
                    amount: 150,
                    result: "lost",
                    profit: -150,
                    date: "2024-01-05"
                },
                {
                    id: 4,
                    title: "OpenAIÁôºÂ∏ÉÈ¢ÑÊµã",
                    position: "NO",
                    amount: 80,
                    result: "won",
                    profit: 25.8,
                    date: "2023-12-28"
                }
            ];

            container.innerHTML = '';

            historyData.forEach(trade => {
                const resultClass = trade.result === 'won' ? 'positive' : 'negative';
                const statusClass = trade.result === 'won' ? 'status-won' : 'status-lost';

                container.innerHTML += `
                    <div class="history-item">
                        <div class="history-info">
                            <div class="history-title">${trade.title}</div>
                            <div class="history-details">
                                <span>ÊåÅ‰ªìÔºö${trade.position} ${trade.amount} USDT</span>
                                <span>Êó•ÊúüÔºö${trade.date}</span>
                            </div>
                        </div>
                        <div class="history-value">
                            <div class="history-amount ${resultClass}">
                                ${trade.profit >= 0 ? '+' : ''}${trade.profit.toFixed(2)} USDT
                            </div>
                            <div class="history-status ${statusClass}">
                                ${trade.result === 'won' ? 'ÁõàÂà©' : '‰∫èÊçü'}
                            </div>
                        </div>
                    </div>
                `;
            });
        }

        // ÂàùÂßãÂåñ
        document.addEventListener('DOMContentLoaded', function() {
            renderTopics();
            
            // È¢ÑÊ∏≤ÊüìPKË©±È°å‰ª•Á¢∫‰øùÊï∏ÊìöÊ≠£Á¢∫
            renderInnerTopics();
            
            // Ê£ÄÊü•URLÂèÇÊï∞
            const urlParams = new URLSearchParams(window.location.search);
            const topicId = urlParams.get('topic');
            if (topicId) {
                showTopicDetail(parseInt(topicId));
            }
            

        });
    </script>
</body>
</html>

